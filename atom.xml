<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>696px</title>
  
  <subtitle>blog</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="demoorbug.github.io/"/>
  <updated>2021-05-07T18:17:13.741Z</updated>
  <id>demoorbug.github.io/</id>
  
  <author>
    <name>DEBUG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>pubg-react</title>
    <link href="demoorbug.github.io/2020/03/04/%E9%87%8D%E6%9E%84react%E9%A1%B9%E7%9B%AE/"/>
    <id>demoorbug.github.io/2020/03/04/重构react项目/</id>
    <published>2020-03-04T20:50:42.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<p>看到别人的一个项目不错，而且开源，react的，很多不懂，现在看能不能重构成功吧<br>项目名pubg-react<br><a id="more"></a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app pubg-react</span><br></pre></td></tr></table></figure></p><h1 id="client用到的库，介绍"><a href="#client用到的库，介绍" class="headerlink" title="client用到的库，介绍"></a>client用到的库，介绍</h1><ol><li>apollo-client</li></ol><h1 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h1><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>用的最新hapi, 安装命令 <code>yarn add @hapi/hapi</code><br>这里需要注意，新版必须使用node 12.x 以上的版本，否则就会报错<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install n -g</span><br><span class="line"></span><br><span class="line">sudo n stable</span><br><span class="line"></span><br><span class="line">PATH=<span class="string">"<span class="variable">$PATH</span>"</span> // 更新环境变量，不然还是旧版</span><br></pre></td></tr></table></figure></p><p>要在node端使用es6语法，用babel实现，安装<code>yarn add @babel/preset-env @babel/node @babel/core -D</code><br>创建.babelrc 文件：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-env"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>开发环境安装nodemon <code>yarn add nodemon -D</code><br>package.json:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"nodemon -w src --exec babel-node src/app.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// shell 里面使用babel-node 的话，要用npx babel-node</span><br><span class="line">// 注意: 先要安装@babel/node @babel/core ，不然babel-node使用的就行旧版的babel-node 6.x</span><br><span class="line">如果是生产环境，就不要使用babel-node</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/babel/example-node-server" target="_blank" rel="noopener">https://github.com/babel/example-node-server 生产环境配置</a></p><h2 id="用到的库"><a href="#用到的库" class="headerlink" title="用到的库"></a>用到的库</h2><p>Hapi.js 如果仅是用于返回 api接口，或者通过node调用其他网络接口<br>socket.io 封装了HTML5的websocket，完成一次握手，就可以畅通通讯<br>dotenv 可以轻松使用process.env. 环境变量配置项目，只要在项目目录创建.env 文件<br>pgr 是数据库连接的工具Postgres DB, 这原来是一个作者开发的啊。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;看到别人的一个项目不错，而且开源，react的，很多不懂，现在看能不能重构成功吧&lt;br&gt;项目名pubg-react&lt;br&gt;
    
    </summary>
    
      <category term="学习" scheme="demoorbug.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="react" scheme="demoorbug.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>服务端渲染</title>
    <link href="demoorbug.github.io/2019/10/19/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/"/>
    <id>demoorbug.github.io/2019/10/19/服务端渲染/</id>
    <published>2019-10-19T11:51:04.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="服务端渲染"><a href="#服务端渲染" class="headerlink" title="服务端渲染"></a>服务端渲染</h1><a id="more"></a><h2 id="开始搭建项目webpack配置"><a href="#开始搭建项目webpack配置" class="headerlink" title="开始搭建项目webpack配置"></a>开始搭建项目webpack配置</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">  target: <span class="string">'node'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置项，很有必要，如果是浏览器环境打包<code>require(&#39;path&#39;)</code>会把他打包到<code>build.js</code>中，如果是服务器环境就不会把他打包到<code>build.js</code>中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">  target: <span class="string">'node'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'build'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>__dirname</code>指服务器根目录</p><h2 id="同构"><a href="#同构" class="headerlink" title="同构"></a>同构</h2><p>一套React代码，在服务端执行一次，再在客户端执行一次</p><p>普通用的是render，服务端渲染要用hydrate, 后续会讲<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDom.hydrate(<span class="xml"><span class="tag">&lt;<span class="name">Home</span>/&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure></p><h2 id="访问静态资源"><a href="#访问静态资源" class="headerlink" title="访问静态资源"></a>访问静态资源</h2><p>利用express的一个方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(express.static(<span class="string">'public'</span>))</span><br></pre></td></tr></table></figure></p><p>以后的静态资源都会去public里面找</p><h2 id="遇到任何错误都可以在这个网站查找"><a href="#遇到任何错误都可以在这个网站查找" class="headerlink" title="遇到任何错误都可以在这个网站查找"></a>遇到任何错误都可以在这个网站查找</h2><p><a href="https://stackoverflow.com/" target="_blank" rel="noopener">https://stackoverflow.com</a></p><h2 id="自动编译"><a href="#自动编译" class="headerlink" title="自动编译"></a>自动编译</h2><p>webpack 的自动编译很简单 加一个配置项即可<code>--watch</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --config webpack.config.js --watch</span><br></pre></td></tr></table></figure></p><p>node 就要借助nodemon 自动执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm i nodemon -g</span><br></pre></td></tr></table></figure></p><p>package.json<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="comment">//supervisor //也是一个第三方模块，和nodemon功能一样，但是写法不一样，下面的写法有误，不能这么用</span></span><br><span class="line">    <span class="comment">//"start": "nodemon build &amp;&amp; node \"./build/bundle.js\"",</span></span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"nodemon --watch build --exec node \"./build/bundle.js\""</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>使用 <code>npm-run-all</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"npm-run-all --parallel dev:**"</span>,</span><br><span class="line">  <span class="string">"dev:start"</span>: <span class="string">"nodemon --watch build --exec node \"./build/bundle.js\""</span>,</span><br><span class="line">  <span class="string">"dev:build"</span>: <span class="string">"webpack --config webpack.server.js --watch"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="webpack-自动化升级"><a href="#webpack-自动化升级" class="headerlink" title="webpack 自动化升级"></a>webpack 自动化升级</h2><p><a href="https://github.com/babel/babel-upgrade" target="_blank" rel="noopener">自动化升级</a><br>以后要用到<code>stage-x</code>提案阶段的东西就必须写入对应的功能名字，然后引入该插件，也可以用<code>npx babel-upgrade --write</code>自动升级，<code>packaage.json</code>就会自动安装该阶段的插件，自己选择使用哪个 <code>proposal</code> 特性的插件, 参考自 <a href="https://segmentfault.com/a/1190000018358854" target="_blank" rel="noopener">一文读懂 babel7 的配置文件加载逻辑</a></p><blockquote><p>注意升级前的写法必须是这样</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.js?$/</span>,</span><br><span class="line">    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        presets: [<span class="string">'@babek/preset-stage-0'</span>] <span class="comment">// 这里可以是0-4</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>升级后遇到一个bug,就是引入插件会报错未找到，<code>npm i</code>之后就好了<br>新版的写法案例</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">  presets: [<span class="string">'@babel/preset-react'</span>], <span class="comment">// 这不是必须的</span></span><br><span class="line">  plugins: [<span class="string">'@babel/plugin-proposal-class-properties'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="服务端渲染中-store单例化问题"><a href="#服务端渲染中-store单例化问题" class="headerlink" title="服务端渲染中 store单例化问题"></a>服务端渲染中 store单例化问题</h2><blockquote><p>这是Vue ssr指南提到的，其实原理都一样，借鉴这篇文章的理解也是可以的<br>原文链接：<a href="https://ssr.vuejs.org/zh/structure.html" target="_blank" rel="noopener">避免状态单例</a></p></blockquote><p>当编写纯客户端(client-only)代码时，我们习惯于每次在新的上下文中对代码进行取值。但是，Node.js 服务器是一个长期运行的进程。当我们的代码进入该进程时，它将进行一次取值并留存在内存中。这意味着如果创建一个单例对象，它将在每个传入的请求之间共享。</p><p>如基本示例所示，我们为每个请求创建一个新的根 Vue 实例。这与每个用户在自己的浏览器中使用新应用程序的实例类似。如果我们在多个请求之间使用一个共享的实例，很容易导致交叉请求状态污染 (cross-request state pollution)。<br><strong>我们遇到的是store问题</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, applyMiddleware(thunk))</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></p><p>解决方法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> createStore(reducer, applyMiddleware(thunk))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getStore</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> getStore <span class="keyword">from</span> <span class="string">'./store.js'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Provider store=&#123;getStore()&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>例如我们store，初始化数据里面有Date()，这样的原始数据，就会导致问题，这个时间就只会初始化一次，而不会得到更新，所以必须使用以上方法去避免这样的问题。</p></blockquote><p>遇到一个新问题，就是如果store有Date这种实时数据的话，服务端渲染之后客户端渲染就会导致差1秒，控制台就会报错，这种问题应该如何避免呢，不渲染秒确实可以，但是如果某些场景必须使用秒呢</p><p><a href="https://gitee.com/Comet32/imooc-react-ssr/tree/master" target="_blank" rel="noopener">别人的库，已经学完，可以作为参考源文件</a></p><h2 id="报错总结"><a href="#报错总结" class="headerlink" title="报错总结"></a>报错总结</h2><blockquote><p>(node:3102) UnhandledPromiseRejectionWarning: Error: connect ECONNREFUSED 127.0.0.1:80<br>at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1117:14)</p></blockquote><p>这个错误是因为服务端渲染请求的目录不一样，服务端渲染如果请求<code>/</code>目录表示127.0.0.1:80, 然而我没有启动这个端口的服务，所以没东西，我将<code>/</code>改写为<code>http://192.168.0.2:3000/</code>之后就好了，但是不能跨域，所以访问的时候也不能用<code>localhost</code>, 解决方案，上线项目应该不会遇到这个问题把，毕竟不需要用到moke数据，直接请求服务器数据就ok了，服务器数据一般都用jsonp(开启跨域，这个我还不是很清楚)</p><blockquote><p>Warning: Expected server HTML to contain a matching \&lt;div> in\&lt;div>.</p></blockquote><p>首先这里是因为客户端代码和服务端代码不同，我如何引发这个的问题的呢，就是因为客户端多套了一层div, 而服务端没套，老师讲的客户端不套<code>div</code>直接会报一个错误，估计是新版修复了?</p><h2 id="尝试"><a href="#尝试" class="headerlink" title="尝试"></a>尝试</h2><p>本来想尝试使用async await 来实现服务端请求数据的异步操作，最后发现express(好像express也有async但是没找到怎么用)，居然不行，还是koa厉害啊，怪不得koa火了。</p><p><strong>这里遇到个问题，不知道是babel编译没有添加async还是说什么原因，要重新开一台node服务器来验证，这个服务器改的话太麻烦了，留着当一个坑</strong></p><h2 id="BASH-命令"><a href="#BASH-命令" class="headerlink" title="BASH 命令"></a>BASH 命令</h2><p><a href="https://www.jianshu.com/p/23cf8574272e" target="_blank" rel="noopener">bash命令</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;服务端渲染&quot;&gt;&lt;a href=&quot;#服务端渲染&quot; class=&quot;headerlink&quot; title=&quot;服务端渲染&quot;&gt;&lt;/a&gt;服务端渲染&lt;/h1&gt;
    
    </summary>
    
      <category term="学习" scheme="demoorbug.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="react" scheme="demoorbug.github.io/tags/react/"/>
    
      <category term="ssr" scheme="demoorbug.github.io/tags/ssr/"/>
    
      <category term="next" scheme="demoorbug.github.io/tags/next/"/>
    
  </entry>
  
  <entry>
    <title>React 新特性</title>
    <link href="demoorbug.github.io/2019/07/18/React-%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <id>demoorbug.github.io/2019/07/18/React-新特性/</id>
    <published>2019-07-18T16:47:46.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<p>项目目录<br>待填</p><a id="more"></a><h1 id="一些知识点"><a href="#一些知识点" class="headerlink" title="一些知识点"></a>一些知识点</h1><h2 id="SPA-MPA"><a href="#SPA-MPA" class="headerlink" title="SPA/MPA"></a>SPA/MPA</h2><p>单页应用/多页应用<br>MPA和SPA没有本质区别，SPA需要改造才能变为MPA,大网站都是这么搞的</p><h2 id="PWA-渐进式网络应用"><a href="#PWA-渐进式网络应用" class="headerlink" title="PWA 渐进式网络应用"></a>PWA 渐进式网络应用</h2><p>浏览器不支持pwa的时候就会退化为普通的应用，所以称之为渐进式网络应用。<br>如果浏览器支持PWA，就可以控制静态资源缓存，即便我们的设备没有联网，也可以用缓存来运行页面，提供了强大的离线访问能力，除了离线访问，还可以优化载入速度，PWA是前端近年来的革命性进化，移动端支持良好。vue官网就用了这种功能</p><h1 id="React-新特性"><a href="#React-新特性" class="headerlink" title="React 新特性"></a>React 新特性</h1><h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>定义：Context 提供了一种方式，能够让数据在组件树中传递而不必一级一级手动传递<br>API: createContext(defaultValue?)<br>解决问题：编程效率</p><p>他娘的，这么简单，就是透传，和上面定义的是一个意思，在src/ticket/Candidate.jsx中有用到，很简单、很方便。</p><p>App.js:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; createContext &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BatteryContext = createContext(); <span class="comment">//首先是创建，默认值是找不到Provider时候使用，一般是单元测试会用到</span></span><br><span class="line"><span class="keyword">const</span> OnlineContext = createContext();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;BatteryContext.Consumer&gt; <span class="comment">//可以无限嵌套，没有先后之分，注意嵌套规则即可</span></span><br><span class="line">        &#123;</span><br><span class="line">          battery =&gt; (</span><br><span class="line">            &lt;OnlineContext.Consumer&gt;</span><br><span class="line">              &#123;</span><br><span class="line">                online =&gt; &lt;h1&gt;Battery: &#123;battery&#125;, online: &#123;online ? '联网':'未联网'&#125;&lt;/h1&gt;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">// 布尔值可以这样显示 String(online)</span></span><br><span class="line">            &lt;<span class="regexp">/OnlineContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">          )</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>BatteryContext.Consumer&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Middle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;Leaf/&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    battery: <span class="number">60</span>,</span><br><span class="line">    online: <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; battery, online &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;BatteryContext.Provider value=&#123;battery&#125;&gt;</span><br><span class="line">        &lt;OnlineContext.Provider value=&#123;online&#125;&gt;</span><br><span class="line">          &lt;button</span><br><span class="line">            type=<span class="string">"button"</span></span><br><span class="line">            onClick=&#123;() =&gt; <span class="keyword">this</span>.setState(&#123;<span class="attr">battery</span>: battery - <span class="number">1</span>&#125;)&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            Press</span><br><span class="line">          &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;button</span></span><br><span class="line"><span class="regexp">            type="button"</span></span><br><span class="line"><span class="regexp">            onClick=&#123;() =&gt; this.setState(&#123;online: !online&#125;)&#125;</span></span><br><span class="line"><span class="regexp">          &gt;</span></span><br><span class="line"><span class="regexp">            Online</span></span><br><span class="line"><span class="regexp">          &lt;/</span>button&gt;</span><br><span class="line">          &lt;Middle /&gt;</span><br><span class="line">        &lt;<span class="regexp">/OnlineContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>BatteryContext.Provider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure></p><h2 id="ContextType"><a href="#ContextType" class="headerlink" title="ContextType"></a>ContextType</h2><p>结合Context代码使用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> contextType = BatteryContext</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> battery = <span class="keyword">this</span>.context</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;h1&gt;Battery: &#123;battery&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><p>一个Context确实挺方便，多个是否就无法使用了呢？<br>看到4-4节的时候老师有说，确实是只能指向一个，但是可以用useContext 解决这个问题，写法还会更简单</p><h2 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h2><p>所有的细节都在注释里面</p><p>app.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; lazy, Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "about" */</span> <span class="string">'./About.jsx'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误捕获，如果手动将about.chunk.js 右键Block request URL，就会报错，我们必须手动处理错误。</span></span><br><span class="line"><span class="comment">// 借助 ErrorBoundary，他的实现原理就是用react的生命周期钩子，componentDidCatch</span></span><br><span class="line"><span class="comment">// 不过页面还是会报错，老师的报错位置是控制台，我直接就是页面</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    hasError: <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// componentDidCatch () &#123;</span></span><br><span class="line">  <span class="comment">//   this.setState(&#123;</span></span><br><span class="line">  <span class="comment">//     hasError: true</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// ErrorBoundary的另一种写法</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromError () &#123; <span class="comment">// 一旦遇到错误，他就会返回一个新的state数据，并合并到组件的state中</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      hasError: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.hasError) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;加载错误，可能是网络请求问题&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Suspense fallback=&#123;&lt;div&gt;loading&lt;/</span>div&gt;&#125;&gt;</span><br><span class="line">          &lt;About /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure></p><p>About.jsx<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;About&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default About</span></span><br></pre></td></tr></table></figure></p><h2 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h2><p>都在上面的代码里面</p><h2 id="memo"><a href="#memo" class="headerlink" title="memo"></a>memo</h2><p>解决父组件更改,子组件重新渲染问题</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PureComponent, memo &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// memo 解决方案</span></span><br><span class="line"><span class="keyword">const</span> Foo = memo(<span class="function"><span class="keyword">function</span> <span class="title">Foo</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(props.name)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另一种解决方案PureComponent</span></span><br><span class="line"><span class="comment">// 有局限性，只有传入属性的对比，如果内部发生什么变化，就么得用了</span></span><br><span class="line"><span class="comment">// 比如传入对象就算修改，也不会更新视图。还有传入内敛callback(&lt;Foo cb=&#123;() =&gt; &#123;&#125;&#125;&gt;&lt;/Foo&gt;)，这样每次都会渲染</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// callback () &#123;&#125;</span></span><br><span class="line"><span class="comment">// &lt;Foo cb=&#123;this.callback&#125;&gt;&lt;/Foo&gt;</span></span><br><span class="line"><span class="comment">// 解决callback this指向问题 callback = () =&gt; &#123;&#125; ,这就是一个比较完美的写法了，不过又听说箭头函数优化不好。</span></span><br><span class="line"><span class="comment">// class Foo extends PureComponent &#123;</span></span><br><span class="line"><span class="comment">//   render () &#123;</span></span><br><span class="line"><span class="comment">//     console.log(this.props.name)</span></span><br><span class="line"><span class="comment">//     return null;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调解决方案</span></span><br><span class="line"><span class="comment">// class Foo extends React.Component &#123;</span></span><br><span class="line"><span class="comment">//   //　是否决定重新渲染</span></span><br><span class="line"><span class="comment">//   shouldComponentUpdate (nextProps, nextState) &#123;</span></span><br><span class="line"><span class="comment">//     if (nextProps.name === this.props.name) &#123;</span></span><br><span class="line"><span class="comment">//       return false</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     return true</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   render () &#123;</span></span><br><span class="line"><span class="comment">//     console.log(this.props.name)</span></span><br><span class="line"><span class="comment">//     return null;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    num: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;()=&gt;&#123;<span class="keyword">this</span>.setState(&#123;<span class="attr">num</span>: <span class="keyword">this</span>.state.num + <span class="number">1</span>&#125;)&#125;&#125;&gt;&#123;<span class="keyword">this</span>.state.num&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Foo name="Foo"&gt;&lt;/</span>Foo&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><h1 id="State-Hooks"><a href="#State-Hooks" class="headerlink" title="State Hooks"></a>State Hooks</h1><h1 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h1><p>所有的hooks函数都应该以use开头<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [num, setNum] = useState(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'inall'</span>)</span><br><span class="line">    <span class="keyword">return</span> props.defaultCount || <span class="number">0</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setNum(num + <span class="number">1</span>)&#125;&gt;</span><br><span class="line">        &#123;num&#125;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Effect-Hooks"><a href="#Effect-Hooks" class="headerlink" title="Effect Hooks"></a>Effect Hooks</h2><p>useEffect 代替 componentDidMount, componentDidUpdate, componentWillUnmount<br>灵活运用,就可以达到上面生命周期钩子的效果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// let num, setNum;</span></span><br><span class="line">  <span class="comment">// let Main, setMain;</span></span><br><span class="line">  <span class="keyword">let</span> [title, setNum] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> [size, setSize] = useState(&#123;</span><br><span class="line">    width: <span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">    height: <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onResize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setSize(&#123;</span><br><span class="line">      width: <span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">      height: <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = title</span><br><span class="line">  &#125;)</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, onResize, <span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">//回调清理函数</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'remove'</span>);</span><br><span class="line">      <span class="built_in">window</span>.removeEventListener(<span class="string">'resize'</span>, onResize, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []) <span class="comment">// 数组的每一项都不变,才会阻止里面的内容更改</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setNum(title + <span class="number">1</span>)&#125;&gt;</span><br><span class="line">        &#123;title&#125;, &#123;size.width&#125;, &#123;size.height&#125;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure><h2 id="Hooks-下的-Context"><a href="#Hooks-下的-Context" class="headerlink" title="Hooks 下的 Context"></a>Hooks 下的 Context</h2><p>可以说是很简单了<br>不要滥用context, 破坏组件独立性</p><p>App.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, createContext , useContext&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BatteryContext = createContext();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> title = useContext(BatteryContext)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;&#123;title&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App (props) &#123;</span></span><br><span class="line"><span class="regexp">  const [title, setNum] = useState(0)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setNum(title + 1)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        Add</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">      &lt;BatteryContext.Provider value=&#123;title&#125;&gt;</span><br><span class="line">        &lt;Foo /&gt;</span><br><span class="line">      &lt;<span class="regexp">/BatteryContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure></p><h2 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h2><p>这是掘金看到的写法，老师的写法有错，现在用会警告，而且没有视频中的效果<br>纠结了半小时，原来是要配合memo，听课没认真的后果。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'渲染'</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div title=&#123;props.title&#125;&gt;&#123;props.title&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Coo(props) &#123;</span></span><br><span class="line"><span class="regexp">  console.log('Coo');</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;&#123;props.coo&#125;&lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [title, setNum] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [coo, setCoo] = useState(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> double = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &lt;Foo title=&#123;title&#125;/&gt;, [title]);</span><br><span class="line">  <span class="keyword">const</span> douCoo = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &lt;Coo coo=&#123;coo&#125;/&gt;, [coo])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setNum(title + <span class="number">1</span>)&#125;&gt;</span><br><span class="line">        Add</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCoo(coo + 1)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        C</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">        &#123;double&#125;</span><br><span class="line">        &#123;douCoo&#125;</span><br><span class="line">        &lt;div&gt;&#123;double&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure></p><p>配合 memo 使用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useMemo, memo, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Foo = memo(<span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'渲染'</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;h1 onClick=&#123;props.onClick&#125;&gt;&#123;props.title&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App (props) &#123;</span></span><br><span class="line"><span class="regexp">  const [title, setNum] = useState(0)</span></span><br><span class="line"><span class="regexp">  const [lest, setLest] = useState(0)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const fun = useMemo(() =&gt; &#123; /</span><span class="regexp">/ 如果是一个普通的箭头函数，每次都会是一个新的句柄，只有这样才会传入固定的句柄</span></span><br><span class="line"><span class="regexp">    return () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      console.log('useMemo');</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 如果useMemo返回的是函数，可以直接用useCallback，来省略顶层的函数</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 这两种写法等价</span></span><br><span class="line"><span class="regexp">  const fun = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    console.log('useCallback')</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 更新状态, 依赖的两个变量都要写到状态里面，其实官方说，可以保证每次setState返回的同一个句柄</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ const fun = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   console.log('callback')</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   setLest((le) =&gt; le + 1)</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ &#125;, [])</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 另一种更新状态写法</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ const fun = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   console.log('callback')</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   setLest(lest + 1)</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ &#125;, [lest])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const num = useMemo(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return title * 2</span></span><br><span class="line"><span class="regexp">  &#125;, [title === 3]) /</span><span class="regexp">/ 这么写会有报错，不过可以实现</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setNum(title + 1)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        Add</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;-</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setLest(lest + <span class="number">1</span>)&#125;&gt;</span><br><span class="line">        lest</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Foo onClick=&#123;fun&#125; title=&#123;num&#125;&gt;&lt;/</span>Foo&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure></p><h2 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h2><p>class 的时候可以使用 String Ref, Callback Ref, CreateRef<br>hooks 使用 useRef</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, PureComponent,useMemo, useCallback, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为函数无法创建实例，所以必须用class来实现，原来hooks不能完全代替奥</span></span><br><span class="line"><span class="comment">// const Foo = memo(function Foo(props) &#123;</span></span><br><span class="line"><span class="comment">//   console.log('渲染');</span></span><br><span class="line"><span class="comment">//   return (</span></span><br><span class="line"><span class="comment">//     &lt;h1 onClick=&#123;props.onClick&#125;&gt;&#123;props.title&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">//   )</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用PureComponent代替memo</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  mems () &#123; <span class="comment">// 第一种使用场景</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props.title);</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'渲染'</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;h1 onClick=&#123;<span class="keyword">this</span>.props.onClick&#125;&gt;&#123;<span class="keyword">this</span>.props.title&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App (props) &#123;</span></span><br><span class="line"><span class="regexp">  const [title, setNum] = useState(0)</span></span><br><span class="line"><span class="regexp">  const [lest, setLest] = useState(0)</span></span><br><span class="line"><span class="regexp">  const contRef= useRef()</span></span><br><span class="line"><span class="regexp">  const it = useRef()</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const fun = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    console.log('callback')</span></span><br><span class="line"><span class="regexp">    setLest((le) =&gt; le + 1)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    contRef.current.mems(); /</span><span class="regexp">/ 第一种使用场景</span></span><br><span class="line"><span class="regexp">  &#125;, [contRef])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const num = useMemo(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return title * 2</span></span><br><span class="line"><span class="regexp">  &#125;, [title]) /</span><span class="regexp">/ 这么写会有报错，不过可以实现</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 如果是在App函数中声明变量，每次都会执行这个变量，就会导致无法清除it,就必须全局创建，state好像也是可以解决</span></span><br><span class="line"><span class="regexp">    it.current = setInterval(() =&gt; &#123; /</span><span class="regexp">/ Ref的第二种使用场景</span></span><br><span class="line"><span class="regexp">      setNum(title =&gt; title +1)</span></span><br><span class="line"><span class="regexp">    &#125;, 1000)</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    if (num &gt;= 10) &#123;</span></span><br><span class="line"><span class="regexp">      clearInterval(it.current)</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setNum(title + 1)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        Add</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;-</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setLest(lest + <span class="number">1</span>)&#125;&gt;</span><br><span class="line">        &#123;lest&#125;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Foo onClick=&#123;fun&#125; ref=&#123;contRef&#125; title=&#123;num&#125;&gt;&lt;/</span>Foo&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><h2 id="自定义hooks，达到状态逻辑复用"><a href="#自定义hooks，达到状态逻辑复用" class="headerlink" title="自定义hooks，达到状态逻辑复用"></a>自定义hooks，达到状态逻辑复用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useMemo, useRef, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFoo</span>(<span class="params">count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;height, width&#125; = useSize()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;h1&gt;&#123;count&#125;, &#123;height&#125;, &#123;width&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function useCount() &#123;</span></span><br><span class="line"><span class="regexp">  const [title, setNum] = useState(0)</span></span><br><span class="line"><span class="regexp">  const it = useRef()</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const num = useMemo(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return title * 2</span></span><br><span class="line"><span class="regexp">  &#125;, [title]) /</span><span class="regexp">/ 这么写会有报错，不过可以实现</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    it.current = setInterval(() =&gt; &#123; /</span><span class="regexp">/ Ref的第二种使用场景</span></span><br><span class="line"><span class="regexp">      setNum(title =&gt; title +1)</span></span><br><span class="line"><span class="regexp">    &#125;, 1000)</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    if (num &gt;= 10) &#123;</span></span><br><span class="line"><span class="regexp">      clearInterval(it.current)</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp">  return [title, setNum, num]</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function useSize() &#123;</span></span><br><span class="line"><span class="regexp">  const [size, setSize] = useState(&#123;</span></span><br><span class="line"><span class="regexp">    width: document.documentElement.clientWidth,</span></span><br><span class="line"><span class="regexp">    height: document.documentElement.clientHeight</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ const onResize = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   setSize(&#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/     width: document.documentElement.clientWidth,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/     height: document.documentElement.clientHeight</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/   &#125;)</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ &#125;</span></span><br><span class="line"><span class="regexp">  const onResize = useCallback(() =&gt; &#123; /</span><span class="regexp">/ 老师也是一笔带过，没有细讲为什么要用useCallback(), 我也记不起来了。算一个坑吧</span></span><br><span class="line"><span class="regexp">    setSize(&#123;</span></span><br><span class="line"><span class="regexp">      width: document.documentElement.clientWidth,</span></span><br><span class="line"><span class="regexp">      height: document.documentElement.clientHeight</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    window.addEventListener('resize', onResize, false)</span></span><br><span class="line"><span class="regexp">    return () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      window.removeEventListener('resize', onResize, false)</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;, [onResize])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return size</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App (props) &#123;</span></span><br><span class="line"><span class="regexp">  const [title, setNum, num] = useCount()</span></span><br><span class="line"><span class="regexp">  const Counter = useFoo(num)</span></span><br><span class="line"><span class="regexp">  const size = useSize()</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setNum(title + 1)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        Add,&#123;size.width&#125;,&#123;size.height&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">      &#123;Counter&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><h2 id="hooks-使用法则"><a href="#hooks-使用法则" class="headerlink" title="hooks 使用法则"></a>hooks 使用法则</h2><p>顶层调用hooks函数：<br>不能在循环语句，条件语句或者是嵌套函数中调用hooks函数<br>仅在函数组件和自定义hooks函数中，调用hooks函数</p><h2 id="hooks使用问题"><a href="#hooks使用问题" class="headerlink" title="hooks使用问题"></a>hooks使用问题</h2><h3 id="生命周期的问题："><a href="#生命周期的问题：" class="headerlink" title="生命周期的问题："></a>生命周期的问题：</h3><p>getDerivedStateFromProps 可以用hooks代替<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    ovflive: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromProps(props) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.num &gt; <span class="number">10</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ovflive: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hooks写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [num, setNum] = useState(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">if</span> (props.num &gt; <span class="number">10</span>) &#123;</span><br><span class="line">    setNum(<span class="literal">true</span>) <span class="comment">// 不用担心性能问题，这个setNum是在React操作dom之前完成的</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h3><p>hooks 代替 memo</p><h3 id="componentDidMount-componentDidUpdate-componentWillUnmount"><a href="#componentDidMount-componentDidUpdate-componentWillUnmount" class="headerlink" title="componentDidMount componentDidUpdate componentWillUnmount"></a>componentDidMount componentDidUpdate componentWillUnmount</h3><p>hooks 写法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// componentDidMount</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// componentWillUnmount</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">let</span> renderCounter = useRef(<span class="number">0</span>)</span><br><span class="line">  renderCounter.current++;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (renderCounter &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// componentDidUpdate</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="getSnapshotBeforeUpdate-componentDidCatch-getDerivedStateFromError"><a href="#getSnapshotBeforeUpdate-componentDidCatch-getDerivedStateFromError" class="headerlink" title="getSnapshotBeforeUpdate componentDidCatch getDerivedStateFromError"></a>getSnapshotBeforeUpdate componentDidCatch getDerivedStateFromError</h3><p>目前hooks无法实现，函数组件目前还无法取代类组件</p><h3 id="类实例成员如何映射到hooks"><a href="#类实例成员如何映射到hooks" class="headerlink" title="类实例成员如何映射到hooks"></a>类实例成员如何映射到hooks</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  it = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> it = useRef(<span class="number">0</span>) <span class="comment">// 初始值不能传入函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="hooks如何获取历史props和state"><a href="#hooks如何获取历史props和state" class="headerlink" title="hooks如何获取历史props和state"></a>hooks如何获取历史props和state</h3><p>了解了了解了，如果不用useRef每次组件重新渲染值都会初始化为0，只有用useRef值才能保持不变，还有就是useEffect的优先级比较低，怎么比喻呢。，写下来把(0表示最先，依次)<br>次序有问题，下面做了修改<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>) <span class="comment">// 0</span></span><br><span class="line">  <span class="keyword">const</span> prevCountRef = useRef() <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 2</span></span><br><span class="line">    prevCountRef.current = count <span class="comment">// 保存上一次的count值，因为ref不受重新渲染的影响，因此可以从下一次渲染中取出count</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> prevCount = prevCountRef.current <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;Now: &#123;count&#125;, before: &#123;prevCount&#125;&lt;/h1&gt; <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上面的次序有问题，这里重新更改, useEffect 居然这么晚执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>) <span class="comment">// 0</span></span><br><span class="line">  <span class="keyword">const</span> prevCountRef = useRef() <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 2</span></span><br><span class="line">    prevCountRef.current = count</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> prevCount = prevCountRef.current <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;Now: &#123;count&#125;, before: &#123;prevCount&#125;&lt;/h1&gt; <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="如何强制更新一个hooks组件"><a href="#如何强制更新一个hooks组件" class="headerlink" title="如何强制更新一个hooks组件"></a>如何强制更新一个hooks组件</h3><p>class中有一个forceUpdate, 不过hooks 我们可以用其他方法其代替</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [updater, setUpdater] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">forceUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setUpdater(<span class="function"><span class="params">updater</span> =&gt;</span> updater + <span class="number">1</span>) <span class="comment">// 更新updater 就是间接更新了hooks组件</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> prevCountRef = useRef()</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    prevCountRef.current = count</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> prevCount = prevCountRef.current</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;Now: &#123;count&#125;, before: &#123;prevCount&#125;&lt;/h1&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>Redux 三大原则<br>单一数据源<br>状态不可变<br>纯函数修改数据</p><h3 id="实现的一个todolist应用。很简单，样式以及源码全部在train-ticket的src-TodoListSoundCode目录下"><a href="#实现的一个todolist应用。很简单，样式以及源码全部在train-ticket的src-TodoListSoundCode目录下" class="headerlink" title="实现的一个todolist应用。很简单，样式以及源码全部在train-ticket的src/TodoListSoundCode目录下"></a>实现的一个todolist应用。很简单，样式以及源码全部在train-ticket的src/TodoListSoundCode目录下</h3><p>这里放上app.js代码部分，方便查阅<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useCallback, useRef, useEffect, memo &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> idSeq = <span class="built_in">Date</span>.now()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Control = memo(<span class="function"><span class="keyword">function</span> <span class="title">Control</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; addTodo &#125; = props</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123; <span class="comment">// 没有像任何子组件传递，所以就没有必要包裹callback</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newText = inputRef.current.value.trim()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newText.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    addTodo(&#123;</span><br><span class="line">      id: ++idSeq,</span><br><span class="line">      text: newText,</span><br><span class="line">      complate: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    inputRef.current.value = <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"control"</span>&gt;</span><br><span class="line">      &lt;h1&gt;todos&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;form onSubmit=&#123;onSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          type="text"</span></span><br><span class="line"><span class="regexp">          ref=&#123;inputRef&#125;</span></span><br><span class="line"><span class="regexp">          className="new-todo"</span></span><br><span class="line"><span class="regexp">          placeholder="what needs to be done?"</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoItem = memo(<span class="function"><span class="keyword">function</span> <span class="title">TodoItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    todo: &#123;</span><br><span class="line">      id,</span><br><span class="line">      text,</span><br><span class="line">      complate</span><br><span class="line">    &#125;,</span><br><span class="line">    toggleTodo,</span><br><span class="line">    removeTodo</span><br><span class="line">  &#125; = props</span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    toggleTodo(id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> onRemove = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    removeTodo(id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'0'</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;li className=<span class="string">"todo-item"</span>&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"checkbox"</span></span><br><span class="line">        onChange=&#123;onChange&#125;</span><br><span class="line">        checked=&#123;complate&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label className=&#123;complate ? <span class="string">'complate'</span> : <span class="string">''</span>&#125;&gt;&#123;text&#125;,&#123;<span class="built_in">String</span>(complate)&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onRemove&#125;&gt;&amp;#xd7;&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Todos = memo(function Todos(props) &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; todos, toggleTodo, removeTodo &#125; = props</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &#123;</span></span><br><span class="line"><span class="regexp">        todos.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return &lt;TodoItem</span></span><br><span class="line"><span class="regexp">            key=&#123;todo.id&#125;</span></span><br><span class="line"><span class="regexp">            todo=&#123;todo&#125;</span></span><br><span class="line"><span class="regexp">            toggleTodo=&#123;toggleTodo&#125;</span></span><br><span class="line"><span class="regexp">            removeTodo=&#123;removeTodo&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">const LS_KEY = '$-todos_';</span></span><br><span class="line"><span class="regexp">function TodoList() &#123;</span></span><br><span class="line"><span class="regexp">  const [todos, setTodos] = useState([])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const addTodo = useCallback((todo) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setTodos(todos =&gt; [...todos, todo])</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  const removeTodo = useCallback((id) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setTodos(todos =&gt; todos.filter(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return todo.id !== id</span></span><br><span class="line"><span class="regexp">    &#125;))</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  const toggleTodo = useCallback((id) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setTodos(todos =&gt; todos.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return todo.id === id</span></span><br><span class="line"><span class="regexp">        ? &#123;</span></span><br><span class="line"><span class="regexp">          ...todo,</span></span><br><span class="line"><span class="regexp">          complate: !todo.complate</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        : todo;</span></span><br><span class="line"><span class="regexp">    &#125;))</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 下面两个副作用都是来实现本地数据存储的</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const todos = JSON.parse(localStorage.getItem(LS_KEY) || '[]')</span></span><br><span class="line"><span class="regexp">    setTodos(todos)</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    localStorage.setItem(LS_KEY, JSON.stringify(todos))</span></span><br><span class="line"><span class="regexp">  &#125;, [todos])</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div className="todo-list"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Control</span></span><br><span class="line"><span class="regexp">        addTodo=&#123;addTodo&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">      &lt;Todos</span><br><span class="line">        removeTodo=&#123;removeTodo&#125;</span><br><span class="line">        toggleTodo=&#123;toggleTodo&#125;</span><br><span class="line">        todos=&#123;todos&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure></p><h3 id="Dispatch-与-Action"><a href="#Dispatch-与-Action" class="headerlink" title="Dispatch 与 Action"></a>Dispatch 与 Action</h3><p>这不就是我苦苦寻找的vuex里面的解构为什么可以…dispatch的原因了吗，帅呆了奥，原来是这么写一个函数的<br>addTodo = (payload) =&gt; dispatch(createAdd(payload))<br>把传入的对象转换为下面这种格式，然后通过解构的方式传递给组件，帅<br>{<br>   addTodo: dispatch Function<br>}<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useCallback, useRef, useEffect, memo &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createAdd,</span><br><span class="line">  createSet,</span><br><span class="line">  createRemove,</span><br><span class="line">  createToggle</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> idSeq = <span class="built_in">Date</span>.now()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这不就是我苦苦寻找的vuex里面的解构为什么可以...dispatch的原因了吗，帅呆了奥，原来是这么写一个函数的</span></span><br><span class="line"><span class="comment">// addTodo = (payload) =&gt; dispatch(createAdd(payload))</span></span><br><span class="line"><span class="comment">// 把传入的对象转换为下面这种格式，然后通过解构的方式传递给组件，帅</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//    addTodo: dispatch Function</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ret = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> actionCreators) &#123;</span><br><span class="line">    ret[key] = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> actionCreator = actionCreators[key]</span><br><span class="line">      <span class="keyword">const</span> action = actionCreator(...args)</span><br><span class="line">      dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Control = memo(<span class="function"><span class="keyword">function</span> <span class="title">Control</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; addTodos &#125; = props</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123; <span class="comment">// 没有像任何子组件传递，所以就没有必要包裹callback</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newText = inputRef.current.value.trim()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newText.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    addTodos(&#123;</span><br><span class="line">      id: ++idSeq,</span><br><span class="line">      text: newText,</span><br><span class="line">      complate: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    inputRef.current.value = <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"control"</span>&gt;</span><br><span class="line">      &lt;h1&gt;todos&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;form onSubmit=&#123;onSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          type="text"</span></span><br><span class="line"><span class="regexp">          ref=&#123;inputRef&#125;</span></span><br><span class="line"><span class="regexp">          className="new-todo"</span></span><br><span class="line"><span class="regexp">          placeholder="what needs to be done?"</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoItem = memo(<span class="function"><span class="keyword">function</span> <span class="title">TodoItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    todo: &#123;</span><br><span class="line">      id,</span><br><span class="line">      text,</span><br><span class="line">      complate</span><br><span class="line">    &#125;,</span><br><span class="line">    remove,</span><br><span class="line">    toggle</span><br><span class="line">  &#125; = props</span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    toggle(id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> onRemove = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    remove(id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;li className=<span class="string">"todo-item"</span>&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"checkbox"</span></span><br><span class="line">        onChange=&#123;onChange&#125;</span><br><span class="line">        checked=&#123;complate&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;label className=&#123;complate ? <span class="string">'complate'</span> : <span class="string">''</span>&#125;&gt;&#123;text&#125;,&#123;<span class="built_in">String</span>(complate)&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onRemove&#125;&gt;&amp;#xd7;&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Todos = memo(function Todos(props) &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; todos, remove, toggle &#125; = props</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &#123;</span></span><br><span class="line"><span class="regexp">        todos.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return &lt;TodoItem</span></span><br><span class="line"><span class="regexp">            key=&#123;todo.id&#125;</span></span><br><span class="line"><span class="regexp">            todo=&#123;todo&#125;</span></span><br><span class="line"><span class="regexp">            remove=&#123;remove&#125;</span></span><br><span class="line"><span class="regexp">            toggle=&#123;toggle&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp">const LS_KEY = '$-todos_';</span></span><br><span class="line"><span class="regexp">function TodoList() &#123;</span></span><br><span class="line"><span class="regexp">  const [todos, setTodos] = useState([])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const dispatch = useCallback((action) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; type, payload &#125; = action</span></span><br><span class="line"><span class="regexp">    switch (type) &#123;</span></span><br><span class="line"><span class="regexp">      case 'set':</span></span><br><span class="line"><span class="regexp">        setTodos(payload)</span></span><br><span class="line"><span class="regexp">        break;</span></span><br><span class="line"><span class="regexp">      case 'add':</span></span><br><span class="line"><span class="regexp">        setTodos(todos =&gt; [...todos, payload])</span></span><br><span class="line"><span class="regexp">        break;</span></span><br><span class="line"><span class="regexp">      case 'remove':</span></span><br><span class="line"><span class="regexp">        setTodos(todos =&gt; todos.filter(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return todo.id !== payload</span></span><br><span class="line"><span class="regexp">        &#125;))</span></span><br><span class="line"><span class="regexp">        break;</span></span><br><span class="line"><span class="regexp">      case 'toggle':</span></span><br><span class="line"><span class="regexp">        setTodos(todos =&gt; todos.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return todo.id === payload</span></span><br><span class="line"><span class="regexp">            ? &#123;</span></span><br><span class="line"><span class="regexp">              ...todo,</span></span><br><span class="line"><span class="regexp">              complate: !todo.complate</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">            : todo;</span></span><br><span class="line"><span class="regexp">        &#125;))</span></span><br><span class="line"><span class="regexp">        break;</span></span><br><span class="line"><span class="regexp">      default:</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const todos = JSON.parse(localStorage.getItem(LS_KEY) || '[]')</span></span><br><span class="line"><span class="regexp">    dispatch(createSet(todos))</span></span><br><span class="line"><span class="regexp">  &#125;, [dispatch])</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    localStorage.setItem(LS_KEY, JSON.stringify(todos))</span></span><br><span class="line"><span class="regexp">  &#125;, [todos])</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div className="todo-list"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Control</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">          ...bindActionCreators(&#123;</span></span><br><span class="line"><span class="regexp">            addTodos: createAdd</span></span><br><span class="line"><span class="regexp">          &#125;, dispatch)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">      &lt;Todos</span><br><span class="line">        &#123;</span><br><span class="line">          ...bindActionCreators(&#123;</span><br><span class="line">            remove: createRemove,</span><br><span class="line">            toggle: createToggle</span><br><span class="line">          &#125;, dispatch)</span><br><span class="line">        &#125;</span><br><span class="line">        todos=&#123;todos&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure></p><h3 id="reducer-这边问题很多啊"><a href="#reducer-这边问题很多啊" class="headerlink" title="reducer 这边问题很多啊"></a>reducer 这边问题很多啊</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useCallback, useRef, useEffect, memo &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createAdd,</span><br><span class="line">  createSet,</span><br><span class="line">  createRemove,</span><br><span class="line">  createToggle</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> idSeq = <span class="built_in">Date</span>.now()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这不就是我苦苦寻找的vuex里面的解构为什么可以...dispatch的原因了吗，帅呆了奥，原来是这么写一个函数的</span></span><br><span class="line"><span class="comment">// addTodo = (payload) =&gt; dispatch(createAdd(payload))</span></span><br><span class="line"><span class="comment">// 把传入的对象转换为下面这种格式，然后通过解构的方式传递给组件，帅</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//    addTodo: dispatch Function</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ret = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> actionCreators) &#123;</span><br><span class="line">    ret[key] = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> actionCreator = actionCreators[key]</span><br><span class="line">      <span class="keyword">const</span> action = actionCreator(...args)</span><br><span class="line">      dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Control = memo(<span class="function"><span class="keyword">function</span> <span class="title">Control</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; addTodos &#125; = props</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123; <span class="comment">// 没有像任何子组件传递，所以就没有必要包裹callback</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newText = inputRef.current.value.trim()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newText.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    addTodos(&#123;</span><br><span class="line">      id: ++idSeq,</span><br><span class="line">      text: newText,</span><br><span class="line">      complate: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    inputRef.current.value = <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"control"</span>&gt;</span><br><span class="line">      &lt;h1&gt;todos&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;form onSubmit=&#123;onSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input</span></span><br><span class="line"><span class="regexp">          type="text"</span></span><br><span class="line"><span class="regexp">          ref=&#123;inputRef&#125;</span></span><br><span class="line"><span class="regexp">          className="new-todo"</span></span><br><span class="line"><span class="regexp">          placeholder="what needs to be done?"</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoItem = memo(<span class="function"><span class="keyword">function</span> <span class="title">TodoItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    todo: &#123;</span><br><span class="line">      id,</span><br><span class="line">      text,</span><br><span class="line">      complate</span><br><span class="line">    &#125;,</span><br><span class="line">    remove,</span><br><span class="line">    toggle</span><br><span class="line">  &#125; = props</span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    toggle(id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> onRemove = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    remove(id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;li className=<span class="string">"todo-item"</span>&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"checkbox"</span></span><br><span class="line">        onChange=&#123;onChange&#125;</span><br><span class="line">        checked=&#123;complate&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;label className=&#123;complate ? <span class="string">'complate'</span> : <span class="string">''</span>&#125;&gt;&#123;text&#125;,&#123;<span class="built_in">String</span>(complate)&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onRemove&#125;&gt;&amp;#xd7;&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Todos = memo(function Todos(props) &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; todos, remove, toggle &#125; = props</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &#123;</span></span><br><span class="line"><span class="regexp">        todos.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return &lt;TodoItem</span></span><br><span class="line"><span class="regexp">            key=&#123;todo.id&#125;</span></span><br><span class="line"><span class="regexp">            todo=&#123;todo&#125;</span></span><br><span class="line"><span class="regexp">            remove=&#123;remove&#125;</span></span><br><span class="line"><span class="regexp">            toggle=&#123;toggle&#125;</span></span><br><span class="line"><span class="regexp">            /</span>&gt;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function reducer(state, action) &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; type, payload &#125; = action;</span></span><br><span class="line"><span class="regexp">  const &#123; todos, incrementCount &#125; = state</span></span><br><span class="line"><span class="regexp">  switch (type) &#123;</span></span><br><span class="line"><span class="regexp">    case 'set':</span></span><br><span class="line"><span class="regexp">      return &#123;</span></span><br><span class="line"><span class="regexp">        ...state,</span></span><br><span class="line"><span class="regexp">        todos: payload,</span></span><br><span class="line"><span class="regexp">        incrementCount: incrementCount + 1</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    case 'add':</span></span><br><span class="line"><span class="regexp">      return &#123;</span></span><br><span class="line"><span class="regexp">        ...state,</span></span><br><span class="line"><span class="regexp">        todos: [...todos, payload],</span></span><br><span class="line"><span class="regexp">        incrementCount: incrementCount + 1</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    case 'remove':</span></span><br><span class="line"><span class="regexp">      return &#123;</span></span><br><span class="line"><span class="regexp">        ...state,</span></span><br><span class="line"><span class="regexp">        todos: todos.filter(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return todo.id !== payload</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    case 'toggle':</span></span><br><span class="line"><span class="regexp">      return &#123;</span></span><br><span class="line"><span class="regexp">        ...state,</span></span><br><span class="line"><span class="regexp">        todos: todos.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          return todo.id === payload</span></span><br><span class="line"><span class="regexp">          ? &#123;</span></span><br><span class="line"><span class="regexp">            ...todo,</span></span><br><span class="line"><span class="regexp">            complate: !todo.complate</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">          : todo;</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    default:</span></span><br><span class="line"><span class="regexp">      return state</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const LS_KEY = '$-todos_';</span></span><br><span class="line"><span class="regexp">function TodoList() &#123;</span></span><br><span class="line"><span class="regexp">  const [todos, setTodos] = useState([])</span></span><br><span class="line"><span class="regexp">  const [incrementCount, setIncrementCount] = useState(0)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  const dispatch = useCallback((action) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const state = &#123;</span></span><br><span class="line"><span class="regexp">      todos,</span></span><br><span class="line"><span class="regexp">      incrementCount</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    const setters = &#123;</span></span><br><span class="line"><span class="regexp">      todos: setTodos,</span></span><br><span class="line"><span class="regexp">      incrementCount: setIncrementCount</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    const newState = reducer(state, action)</span></span><br><span class="line"><span class="regexp">    for (var key in newState) &#123;</span></span><br><span class="line"><span class="regexp">      setters[key](newState[key])</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;, [todos, incrementCount])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const todos = JSON.parse(localStorage.getItem(LS_KEY) || '[]')</span></span><br><span class="line"><span class="regexp">    dispatch(createSet(todos))</span></span><br><span class="line"><span class="regexp">  &#125;, [])</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    localStorage.setItem(LS_KEY, JSON.stringify(todos))</span></span><br><span class="line"><span class="regexp">  &#125;, [todos])</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div className="todo-list"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Control</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">          ...bindActionCreators(&#123;</span></span><br><span class="line"><span class="regexp">            addTodos: createAdd</span></span><br><span class="line"><span class="regexp">          &#125;, dispatch)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;Todos</span><br><span class="line">        &#123;</span><br><span class="line">          ...bindActionCreators(&#123;</span><br><span class="line">            remove: createRemove,</span><br><span class="line">            toggle: createToggle</span><br><span class="line">          &#125;, dispatch)</span><br><span class="line">        &#125;</span><br><span class="line">        todos=&#123;todos&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure><p>以上代码这一块编辑器提示必须依赖dispatch，否则就删除数组，但是依赖后就会出现bug，代码会进入无限循环，莫名其妙，不过老师后面的异步actions好像是可以避免这个问题，但是我没有跟进，直接进入了PWA应用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> todos = <span class="built_in">JSON</span>.parse(localStorage.getItem(LS_KEY) || <span class="string">'[]'</span>)</span><br><span class="line">  dispatch(createSet(todos))</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure></p><h2 id="PWA-Progressive-Web-App"><a href="#PWA-Progressive-Web-App" class="headerlink" title="PWA (Progressive Web App)"></a>PWA (Progressive Web App)</h2><p>渐进式网络应用</p><h3 id="Service-Worker-服务器工作线程"><a href="#Service-Worker-服务器工作线程" class="headerlink" title="Service Worker 服务器工作线程"></a>Service Worker 服务器工作线程</h3><p>常驻内存运行<br>代理网络请求<br>依赖HttpS</p><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>优化回调地狱<br>async/await 语法同步化</p><h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><p>比XMLHttpRequest更简洁<br>Promise风格</p><h3 id="cache-API"><a href="#cache-API" class="headerlink" title="cache API"></a>cache API</h3><p>支持资源的缓存系统<br>缓存(css/scritp/image)<br>依赖Service Worker代理网络请求</p><h3 id="Notification-API"><a href="#Notification-API" class="headerlink" title="Notification API"></a>Notification API</h3><p>消息推送<br>依赖用户授权<br>适合在Service Worker中推送</p><h2 id="删除除serviceWorker-js以外的所有文件"><a href="#删除除serviceWorker-js以外的所有文件" class="headerlink" title="删除除serviceWorker.js以外的所有文件"></a>删除除serviceWorker.js以外的所有文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls | grep -v serviceWorker.js | xargs rm</span><br></pre></td></tr></table></figure><p>这句代码也太帅了？从来没用过哎</p><h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><p><strong>生成26个字母表</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> alphabet = <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">26</span>), (eie, index) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode(<span class="number">65</span> + index)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><strong>通过data来进行元素的锚跳转</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-cate</span>=<span class="string">"X"</span>&gt;</span>X<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.querySelector(<span class="string">`[data-cate='X']`</span>)</span></span><br><span class="line"><span class="undefined">  .scrollIntoView()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><strong>传参如果是对象可以解构：</strong><br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bash = &#123;</span><br><span class="line">  name,</span><br><span class="line">  bash,</span><br><span class="line">  hello</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;div &#123;...bash&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p><strong>icon小图标的&amp;#x在js中要替换为’\u’</strong></p><p><strong>delete操作符居然可以这样用-</strong><br>in运算符：<br>src/query/Bottom.jsx<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toggle = useCallback(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newCheckedMap = &#123;...checkedMap&#125;</span><br><span class="line">  <span class="keyword">if</span> (value <span class="keyword">in</span> checkedMap) &#123;</span><br><span class="line">    <span class="keyword">delete</span> newCheckedMap[value]</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    newCheckedMap[value] = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  update(newCheckedMap)</span><br><span class="line">&#125;, [checkedMap, update])</span><br></pre></td></tr></table></figure></p><p><strong>今天用到了<code>Object.assign()</code></strong><br>目前根据代码推断，作用应该等同于:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;<span class="attr">name</span>:<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;...data, <span class="attr">msg</span>: <span class="string">"helo"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.assign(data, &#123;</span><br><span class="line">  msg: <span class="string">"helo"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><strong>Candidate.jsx中还写了个选项卡，很简单，很简单</strong></p><h2 id="没有用过的css"><a href="#没有用过的css" class="headerlink" title="没有用过的css"></a>没有用过的css</h2><p><strong>实现的效果就是拖动到顶部的时候会变成固定定位，下一个同样属性的元素划过会替换掉。蛮神奇的</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attribute">position</span>: sticky;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>readonly</strong><br>input的一个属性，加了后不能填写，初步理解</p><h2 id="日期组件很顶，以后可以用到估计"><a href="#日期组件很顶，以后可以用到估计" class="headerlink" title="日期组件很顶，以后可以用到估计"></a>日期组件很顶，以后可以用到估计</h2><p>common/DeteSelector.jsx</p><p>这个日期选择组件实在是帅的一批，react居然要拆这么细的组件，日期组件原来这么简单，感觉下一次做就不会有所畏惧了，结尾老师说的注意点，什么鬼，听不明白，hide？</p><h2 id="开发中所用到的npm安装的模块总结"><a href="#开发中所用到的npm安装的模块总结" class="headerlink" title="开发中所用到的npm安装的模块总结"></a>开发中所用到的npm安装的模块总结</h2><p><strong>prop-types 校验传入属性值的类型</strong><br>具体在common/header.jsx 文件中使用<br>classnames 动态类、没有这个的话可以这么写<br>没有：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&#123;[<span class="string">'city-selector'</span>, (!show) &amp;&amp; <span class="string">'hidden'</span>].filter(<span class="built_in">Boolean</span>).join(<span class="string">' '</span>)&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p><strong>用classnames</strong><br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">'classnames'</span></span><br><span class="line">&lt;div className=&#123;classnames(<span class="string">'city-selector'</span>, &#123;</span><br><span class="line">  hidden: !show</span><br><span class="line">  &#125;)&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p><strong>day.js</strong> 仅2K大小，和Moment.js一样的api，nice啊，虽然没有用过Monment</p><p><strong>urijs</strong><br>解析用get提交的url数据，这个居然也要库，怎么什么都要库啊，自己写不行吗。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> URI <span class="keyword">from</span> <span class="string">'urijs'</span></span><br><span class="line"><span class="keyword">const</span> &#123;dispatch&#125; = props</span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> queries = URI.parseQuery(<span class="built_in">window</span>.location.search)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      <span class="keyword">from</span>,</span><br><span class="line">      to,</span><br><span class="line">      date,</span><br><span class="line">      highSpeed</span><br><span class="line">    &#125; = queries</span><br><span class="line">    dispatch(setFrom(<span class="keyword">from</span>))</span><br><span class="line">    dispatch(setTo(to))</span><br><span class="line">    dispatch(setDeparDate(h0(dayjs(date).valueOf())))</span><br><span class="line">    dispatch(setHighSpeed(highSpeed === <span class="string">'true'</span>))</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure></p><p><strong>left-pad</strong> 这个模块就11行代码，我真的服了，现在有现成的支持,String.padStart()<br>这几集的视频没了，只能自己看源码，还行吧，挺简单的，里面操作滚动条技巧还挺厉害的，掌握原理了，我自己写还真写不出来，艾，基础太薄弱了。fuck<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(index: <span class="built_in">number</span>).padStart(<span class="number">2</span>, <span class="string">'0'</span>)</span><br></pre></td></tr></table></figure></p><h2 id="webpack-的-MPA-多页网页设置"><a href="#webpack-的-MPA-多页网页设置" class="headerlink" title="webpack 的 MPA 多页网页设置"></a>webpack 的 MPA 多页网页设置</h2><p>9-2 节必须更改config/webpack.config.js下的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  <span class="comment">/* 142 */</span> filename: isEnvProduction</span><br><span class="line">  <span class="comment">/* 143 */</span> ? <span class="string">'static/js/[name].[chunkhash:8].js'</span></span><br><span class="line">  <span class="comment">/* 144 */</span> : isEnvDevelopment &amp;&amp; <span class="string">'static/js/build.js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>更改为: ‘static/js/[name].js’<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  <span class="comment">/* 142 */</span> filename: isEnvProduction</span><br><span class="line">  <span class="comment">/* 143 */</span> ? <span class="string">'static/js/[name].[chunkhash:8].js'</span></span><br><span class="line">  <span class="comment">/* 144 */</span> : isEnvDevelopment &amp;&amp; <span class="string">'static/js/[name].js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="应该补充的知识"><a href="#应该补充的知识" class="headerlink" title="应该补充的知识"></a>应该补充的知识</h2><p><strong>给组件传自定义dom</strong><br>这块还不知道其他用法，比如传多个dom。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Detail(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">&#123; props.children &#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Detail&gt;</span><br><span class="line">      // 这里可以自己定义</span><br><span class="line">      &lt;span&gt;&lt;/span&gt;</span><br><span class="line">    &lt;/Detail&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>for of 以及 object.keys() 的使用</strong><br>以前还专门记过，他娘的，怎么就忘了呢<br>src/order/actions.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> passengers = [</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">0</span>, <span class="attr">ticketType</span>: <span class="string">'abult'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">child</span>: <span class="string">''</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> passenger <span class="keyword">of</span> passengers) &#123;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(passenger)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> keys) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!passenger[key]) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (passenger.ticketType === <span class="string">'adult'</span>) &#123;</span><br><span class="line">    adultFound = passenger.id</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>总体来说还是可以的，hooks比想象的要简单要好用的多</p><p>12.1 代码规范和格式化，git提交格式化，使用Prettier增强eslist的格式化能力<br>12.2 代码部署以及PWA应用所需的，serviceWorker.js 的应用</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;项目目录&lt;br&gt;待填&lt;/p&gt;
    
    </summary>
    
      <category term="学习" scheme="demoorbug.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="react" scheme="demoorbug.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript</title>
    <link href="demoorbug.github.io/2019/06/11/TypeScript/"/>
    <id>demoorbug.github.io/2019/06/11/TypeScript/</id>
    <published>2019-06-11T20:59:54.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScript 学习<br><a href="https://github.com/DemoorBug/Typescript-axios" target="_blank" rel="noopener">库地址</a><br><a id="more"></a></p><p>换一套课程，上一个就是按照官方文档来的</p><h1 id="2-4基础类型"><a href="#2-4基础类型" class="headerlink" title="2-4基础类型"></a>2-4基础类型</h1><p>undefined 和 null是所有类型的子类型</p><p>比如：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p><p>跳过检查<code>any</code><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> strOrnum: <span class="built_in">any</span> = <span class="string">'num'</span></span><br><span class="line">strOrnum = <span class="number">213</span></span><br></pre></td></tr></table></figure></p><p>联合类型<code>|</code><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> strOrnum: <span class="built_in">number</span> | <span class="built_in">string</span> = <span class="string">'num'</span></span><br><span class="line">strOrnum = <span class="number">2123</span></span><br></pre></td></tr></table></figure></p><p>数字数组<code>number[]</code><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrOfNumbers: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">arrOfNumbers.push(<span class="number">5</span>)</span><br><span class="line">arrOfNumbers.push(<span class="string">'6'</span>) <span class="comment">//报错，必须是数字</span></span><br></pre></td></tr></table></figure></p><p>类数组<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="comment">//arguments 就是一个类数组</span></span><br><span class="line">  <span class="comment">// 可以用arguments.length</span></span><br><span class="line">  <span class="comment">// 但是没有数组的方法</span></span><br><span class="line">  <span class="keyword">let</span> arr: <span class="built_in">any</span>[] = <span class="built_in">arguments</span></span><br><span class="line">  <span class="comment">//这样会报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>元组<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user: [<span class="built_in">string</span>, <span class="built_in">number</span>] = [<span class="string">'viking'</span>, <span class="number">123</span>]</span><br></pre></td></tr></table></figure></p><p><strong>interface 接口</strong></p><blockquote><p>对对象的形状(shape)进行描述<br>对类(class) 进行抽象<br>Duck typing (鸭子类型)</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> viking: Person = &#123;</span><br><span class="line">  name: <span class="string">'viking'</span>,</span><br><span class="line">  age: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可选属性<code>?</code><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>只读属性<code>readonly</code><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  readonly id: <span class="built_in">number</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// readonly 是加在前面</span></span><br><span class="line"><span class="keyword">let</span> obj: Person = &#123;</span><br><span class="line">  id: <span class="number">0</span>,</span><br><span class="line">  name: <span class="string">'string'</span>,</span><br><span class="line">  age: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.id = <span class="number">2</span> <span class="comment">// 报错，不可修改</span></span><br></pre></td></tr></table></figure></p><blockquote><p>const 和 readonly的区别是，const是用在变量上面，readonly是用在属性上面</p></blockquote><p><strong>函数</strong><br>函数的构成，输入，和返回</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x:<span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = add(<span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>可选参数<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x:<span class="built_in">number</span>, y: <span class="built_in">number</span>, z?: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> z === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可选参数，必须是最后一个，不能更改顺序</span></span><br></pre></td></tr></table></figure></p><p>函数表达式<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x:<span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> add2: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span>, z?: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = add</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出现的`=&gt;`不是ES6的箭头函数，而是ts提供的写法</span></span><br></pre></td></tr></table></figure></p><p><strong>类 class</strong><br>类(Class): 定义了一切事物的抽象特点<br>对象(Object): 类的实例<br>面向对象(OOP): 三大特性: 封装、继承、多态<br>封装: 数据操作细节隐藏，仅暴露对外的接口，外界调用端不需要知道细节，就可以用对外提供的接口来访问对象<br>继承: 子类继承父类，子类除了拥有父类的所有特性外，还有一些更加具体的特性<br>多态: 是由继承而产生的相关的不同的类，对同一个方法呢可以有不同的响应，比如猫和狗都继承自动物,但是他们分别实现了自己吃的方法，此时针对某一个实例，我们无需了解他是猫还是狗，我们可以直接调用吃方法，程序就会自动判断出如何正确执行吃方法</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">nam: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = nam</span><br><span class="line">  &#125;</span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;this.name&#125;</span> is runing`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">const</span> snake = <span class="keyword">new</span> Animal(<span class="string">'snake'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Dog <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">  bark() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;this.name&#125;</span> is barking`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> xiaobao = <span class="keyword">new</span> Dog(<span class="string">'xiaobao'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(xiaobao.run());</span><br><span class="line"><span class="built_in">console</span>.log(xiaobao.bark());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写run</span></span><br><span class="line"><span class="keyword">class</span> Cat <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">  run () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Meow, '</span> + <span class="keyword">super</span>.run()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> maomao = <span class="keyword">new</span> Cat(<span class="string">'maomao'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(maomao.run());</span><br><span class="line"></span><br><span class="line"><span class="comment">//多态：我们不用关注调用run的时候他是猫还是狗，系统会自动判断执行正确方法</span></span><br></pre></td></tr></table></figure><p>类里面用到的修饰符</p><p>默认是 <code>public</code><br>有些属性或方法，不愿意对外访问就要用到<br><code>private</code> 只能在类里面访问，子类都不能访问<br>如果希望子类可以访问，就要用到<br><code>protected</code><br>如果想让属性只能访问不能修改，可以用<br><code>readonly</code><br>静态属性(ES6也有？),不用实例也可以访问<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  <span class="keyword">static</span> categoies: <span class="built_in">string</span>[] = [<span class="string">'mammal'</span>,<span class="string">'bird'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>静态方法<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal &#123;</span><br><span class="line">  <span class="keyword">static</span> isAnimal(a) &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="keyword">instanceof</span> Animal</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> snake = <span class="keyword">new</span> Animal(<span class="string">'li'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Animal.isAnimal(snake));</span><br></pre></td></tr></table></figure></p><p><strong>类和接口</strong><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Radio &#123;</span><br><span class="line">  switchRadio(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> RadioWithBattery <span class="keyword">extends</span> Radio &#123;</span><br><span class="line">  checkBatteryStatus(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Car <span class="keyword">implements</span> Radio &#123;</span><br><span class="line">  switchRadio() &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Cellphone <span class="keyword">implements</span> RadioWithBattery &#123;</span><br><span class="line">  switchRadio() &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  checkBatteryStatus() &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>interface 接口<br>对对象的形状(shape)进行描述<br>对类(class)进行抽象<br>Duck Typing(鸭子类型)</p><blockquote><p>鸭子类型：只要你走起来像鸭子,叫起来像鸭子，我就不管你是什么东西，我就可以用它来约束各种概念上毫不相关内容</p></blockquote><p><strong>枚举</strong><br>数字枚举<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Direction &#123;</span><br><span class="line">  Up,</span><br><span class="line">  Down,</span><br><span class="line">  Left,</span><br><span class="line">  Right</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>常量枚举<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> Direction &#123;</span><br><span class="line">  Up,</span><br><span class="line">  Down,</span><br><span class="line">  Left,</span><br><span class="line">  Right</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>枚举分两种，只有常量值可以常量枚举，计算值不能使用常量枚举不可以加const，上面讲的都是常量值，计算值后面用到了讲</p><p><strong>泛型(最难的部分)</strong><br>动机，要解决什么问题(太NICE了，比那个好多了)<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params">num:<span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sr = name(<span class="number">123</span>);</span><br><span class="line"><span class="comment">// 如果我们要传入字符串、布尔、复杂类型，就要使用到any，那样就会导致sr常量就会丧失类型，泛型就是解决这种问题的</span></span><br></pre></td></tr></table></figure></p><p>泛型: 是指在定义函数接口或类的时候，我们不预先指定具体类型，而是在使用的时候再指定类型的一种特征<br>老师讲的很通透，感觉挺简单？<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">names</span>&lt;<span class="title">T</span>&gt;(<span class="params">num:T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sr = names(<span class="string">'123'</span>)</span><br><span class="line"><span class="comment">// 现在不管我们传入什么，ts类型推断都会帮我们推断出常量的类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">names</span>&lt;<span class="title">T</span>, <span class="title">U</span>&gt;(<span class="params">params:[T, U]</span>): [<span class="title">U</span>, <span class="title">T</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [params[<span class="number">1</span>], params[<span class="number">0</span>]]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sr = names([<span class="string">'number'</span>, <span class="number">123</span>]) <span class="comment">//类型推断 [number, string]</span></span><br></pre></td></tr></table></figure></p><p>更深入的用法<br>只能传入数组<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echoWithArr</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T[]</span>): <span class="title">T</span>[] </span>&#123;</span><br><span class="line">  arg.length</span><br><span class="line">  <span class="keyword">return</span> arg</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = echoWithArr([<span class="number">1</span>, <span class="number">2</span>]) <span class="comment">//只能传入数组</span></span><br></pre></td></tr></table></figure></p><p>这种方法就可以传入带length属性的类型参数<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Length &#123;</span><br><span class="line">  length: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echoWithArr</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Length</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  arg.length</span><br><span class="line">  <span class="keyword">return</span> arg</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> str = echoWithArr(<span class="string">'str'</span>)</span><br><span class="line"><span class="keyword">const</span> obj = echoWithArr(&#123;length: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> arr2 = echoWithArr([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure></p><p>在类里面使用泛型<br>为什么要用到<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Queue &#123;</span><br><span class="line">  <span class="keyword">private</span> data = []</span><br><span class="line">  push(item) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.push(item)</span><br><span class="line">  &#125;</span><br><span class="line">  pop() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.shift()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> Queue()</span><br><span class="line">queue.push(<span class="number">1</span>)</span><br><span class="line">queue.push(<span class="string">'srt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(queue.pop().toFixed());</span><br><span class="line"><span class="built_in">console</span>.log(queue.pop().toFixed());</span><br><span class="line"><span class="comment">// 这里就会报错，因为第二个值是string，string没有toFixed方法</span></span><br><span class="line"><span class="comment">// 简单修改</span></span><br><span class="line"><span class="keyword">class</span> Queue &#123;</span><br><span class="line">  <span class="keyword">private</span> data = []</span><br><span class="line">  push(item: <span class="built_in">number</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.push(item)</span><br><span class="line">  &#125;</span><br><span class="line">  pop(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.shift()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这样也可以，如果需求传入更多参数，会变得很麻烦</span></span><br></pre></td></tr></table></figure></p><p>使用泛型类<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Queue&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> data = []</span><br><span class="line">  push (item: T) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.push(item)</span><br><span class="line">  &#125;</span><br><span class="line">  pop(): T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data.shift()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> Queue&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line">queue.push(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(queue.pop().toFixed());</span><br></pre></td></tr></table></figure></p><p>interface 泛型<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> KeyPair&lt;T, U&gt; &#123;</span><br><span class="line">  key: T;</span><br><span class="line">  value: U;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> kp1: KeyPair&lt;<span class="built_in">number</span>, <span class="built_in">string</span>&gt; = &#123;</span><br><span class="line">  key: <span class="number">123</span>,</span><br><span class="line">  value: <span class="string">'str'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>泛型数组<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="keyword">let</span> arr: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure></p><p>泛型描述函数<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IPlus &#123;</span><br><span class="line">  (a: <span class="built_in">number</span>, b: <span class="built_in">number</span>): <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params">a:<span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a: IPlus = plus</span><br></pre></td></tr></table></figure></p><p>泛型interface 结合泛型描述函数<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IPlus&lt;T&gt; &#123;</span><br><span class="line">  (a: T, b: T): T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params">a:<span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a: IPlus&lt;<span class="built_in">number</span>&gt; = plus</span><br></pre></td></tr></table></figure></p><p><strong>类型别名</strong><br>// type aliases<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PlusType = <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x: <span class="built_in">number</span> y:<span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sum2: PlusType = sum</span><br></pre></td></tr></table></figure></p><p>如果一个函数要接受参数比较复杂，比如联合类型接收一个函数，就要用到类型别名<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NameResolver = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">string</span></span><br><span class="line"><span class="keyword">type</span> NameOrResolver = <span class="built_in">string</span> | NameResolver</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">n: NameOrResolver</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> n()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>类型断言</strong><br>// type assertion<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ls</span>(<span class="params">s: <span class="built_in">number</span> | <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// s.length 这样会报错，因为联合类型number没有length</span></span><br><span class="line">  (s <span class="keyword">as</span> <span class="built_in">string</span>).length</span><br><span class="line">  <span class="comment">//这样就ok了</span></span><br><span class="line">  (&lt;<span class="built_in">string</span>&gt;s).length</span><br><span class="line">  <span class="comment">// 好像也没有比as简单。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>声明文件</strong><br>后缀为.d.ts的文件ts都会解析<br>如果用到jQuery的话，直接写会报错，要声明<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">var</span> jQuery: <span class="function">(<span class="params">selector: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">any</span></span><br></pre></td></tr></table></figure></p><p>tsconfig.json 配置文件<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"include"</span> : [<span class="string">"**/*"</span>]</span><br><span class="line">&#125;</span><br><span class="line">// 这个字段就是告诉编译器，帮我们编译当前文件夹下的所有文件</span><br></pre></td></tr></table></figure></p><p>官方也为我们准备好了声明文件<br>比如<code>@type/jquery</code>就是jquery的声明文件</p><p><a href="https://microsoft.github.io/TypeSearch/" target="_blank" rel="noopener">查看声明文件的一个网址</a></p><p><strong>React + typescript</strong><br><strong>ts组件，太好用了</strong><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IHelloProps &#123;</span><br><span class="line">  message?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// const Hello = (props: IHelloProps) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   return &lt;h2&gt;&#123;props.message&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// React.FC是React.FunctionComponent的别名</span></span><br><span class="line"><span class="comment">// React.FC 内置了很多方法，很有用，目前就讲了defaultProps</span></span><br><span class="line"><span class="comment">// ts可以直接替代以前的propTypes(类型检查)</span></span><br><span class="line"><span class="keyword">const</span> Hello: React.FC&lt;IHelloProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;h2&gt;&#123;props.message&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Hello.defaultProps = &#123;</span></span><br><span class="line"><span class="regexp">  message: 'Hello word'</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Hello</span></span><br></pre></td></tr></table></figure></p><p><strong>自定义hook</strong><br>必须use开头</p><p>高阶组件HOC就是一个函数，接受一个组件作为参数，返回一个新的组件</p><h1 id="项目开始"><a href="#项目开始" class="headerlink" title="项目开始"></a>项目开始</h1><p>安装命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app q --TypeScript //未来会弃用，使用下面的命令</span><br><span class="line">npx create-react-app q --template typescript</span><br></pre></td></tr></table></figure></p><p>安装了classnames 插件，还要安装附属的typescript<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add classnames -S</span><br><span class="line">yarn add @types/classnames -S</span><br></pre></td></tr></table></figure></p><p>代码方面倒是挺简单，样式是直接复制的<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NativeButtonProps = BaseButtonProps &amp; React.ButtonHTMLAttributes&lt;HTMLElement&gt;</span><br><span class="line"><span class="keyword">type</span> AnchorButtonProps = BaseButtonProps &amp; React.AnchorHTMLAttributes&lt;HTMLElement&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ButtonProps = Partial&lt;NativeButtonProps &amp; AnchorButtonProps&gt;;</span><br><span class="line"><span class="comment">// ButtonHTMLAttributes，AnchorHTMLAttributes button和a元素所有的附加属性，写起来还</span></span><br><span class="line"><span class="comment">// 会有代码提示, 用起来效果很NICE</span></span><br><span class="line"><span class="comment">// 此块代码的位置在项目的Button组件里面 q/src/components/Button/button.tsx:24</span></span><br><span class="line"><span class="comment">// Partial&lt;T&gt; 把里面的属性全部变成可选属性，难道以前的属性不是可选吗？(经测试，以前的属性都是可选的，所以这个算是多余代码，没必要。当然老师的意思估计是了解把)</span></span><br><span class="line"><span class="comment">// 为什么不直接一行解决？例如：</span></span><br><span class="line"><span class="comment">// type AllButtonProps = Partial&lt;BaseButtonProps &amp; React.ButtonHTMLAttributes&lt;HTMLElement&gt; &amp; React.AnchorHTMLAttributes&lt;HTMLElement&gt;&gt;</span></span><br><span class="line"><span class="comment">// 可以一行解决，还要写这么多，估计是好理解，确实</span></span><br></pre></td></tr></table></figure></p><p><strong>测试</strong><br>测试框架有很多，这次用到的是一个后起之秀<code>JEST</code></p><p>create react app 用的就是这个测试工具<br>已经内置了jest测试工具<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx jest jest.test.js //用于测试</span><br><span class="line">npx jest jest.test.js --watch //一直运行，保存一次运行一次</span><br></pre></td></tr></table></figure></p><p>ReactTestUtils 可搭配测试框架使用，比如jest，<br>官网推荐使用React Testing Library 也算是后起之秀<br>也可以使用Enzyme</p><p>create react app 3.0已经内置了React Testing Library了</p><p>三种文件会被自动认为是测试文件</p><ul><li>在<strong>tests</strong>文件夹下面的.js，.ts文件</li><li>使用.test.js结尾的文件</li><li>使用.spec.js结尾的文件</li></ul><p><strong>jest dom</strong><br>增加新的dom断言,这个库也已经内置了</p><p>插曲：设置npm代理(不上代理，总感觉很慢)，同时yarn没有任何设置，但是执行命令也是走的代理，挺奇怪的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> proxy http://127.0.0.1:10809</span><br><span class="line">npm config <span class="built_in">set</span> https-proxy http://127.0.0.1:10809</span><br><span class="line">// 第二句不设置也行，暂时没出问题，但是还是设置上为好</span><br><span class="line">// 而且要配置,不然sudo执行命令的适合，不会使用代理</span><br><span class="line">sudo npm config <span class="built_in">set</span> proxy http://127.0.0.1:10809</span><br><span class="line">sudo npm config <span class="built_in">set</span> https-proxy http://127.0.0.1:10809</span><br><span class="line">// 删除代理</span><br><span class="line">npm config delete proxy</span><br><span class="line">npm config delete https-proxy</span><br><span class="line">// 同理sudo也要删除一遍</span><br></pre></td></tr></table></figure></p><p>上次看的是jest测试，还是结合react的测试更有趣，让我知道了用处<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; render, fireEvent &#125; <span class="keyword">from</span> <span class="string">'@testing-library/react'</span></span><br><span class="line"><span class="keyword">import</span> Button, &#123; ButtonProps, ButtonSize, ButtonType&#125;  <span class="keyword">from</span> <span class="string">'./button'</span></span><br><span class="line"><span class="comment">// jest.fn() 创建出一个被监控的模拟函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultProps = &#123;</span><br><span class="line">  onClick: jest.fn()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这里用 ButtonProps 是因为会有代码提示，判断什么类型很方便</span></span><br><span class="line"><span class="keyword">const</span> testProps: ButtonProps = &#123;</span><br><span class="line">  btnType: ButtonType.Primary,</span><br><span class="line">  size: ButtonSize.Large,</span><br><span class="line">  className: <span class="string">'names'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> disabledProps: ButtonProps = &#123;</span><br><span class="line">  disabled: <span class="literal">true</span>,</span><br><span class="line">  onClick: jest.fn()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 分类测试</span></span><br><span class="line">describe(<span class="string">'test Button component'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// test 简写也可以是it</span></span><br><span class="line">  it(<span class="string">'should render the correct default button'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = render(&lt;Button &#123;...defaultProps&#125;&gt;Nice&lt;<span class="regexp">/Button&gt;)</span></span><br><span class="line"><span class="regexp">    const element = wrapper.getByText('Nice') /</span><span class="regexp">/测试文本</span></span><br><span class="line"><span class="regexp">    expect(element).toBeInTheDocument() /</span><span class="regexp">/判断组件是否在文档中</span></span><br><span class="line"><span class="regexp">    expect(element.tagName).toEqual('BUTTON') /</span><span class="regexp">/判断元素是否为BUTTON</span></span><br><span class="line"><span class="regexp">    expect(element).toHaveClass('btn btn-default') /</span><span class="regexp">/判断class 是否含有btn btn-default</span></span><br><span class="line"><span class="regexp">    fireEvent.click(element) /</span><span class="regexp">/ 模拟点击</span></span><br><span class="line"><span class="regexp">    expect(defaultProps.onClick).toHaveBeenCalled() /</span><span class="regexp">/ 判断是否处罚点击事件</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp">  it('should render the correct component based on different props', () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;Nice&lt;/</span>Button&gt;)</span><br><span class="line">    <span class="keyword">const</span> element = wrapper.getByText(<span class="string">'Nice'</span>)</span><br><span class="line">    expect(element).toBeInTheDocument()</span><br><span class="line">    expect(element).toHaveClass(<span class="string">'btn-primary btn-lg names'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  it(<span class="string">'should render a link when btnType equals link and href is provided'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = render(&lt;Button btnType=&#123;ButtonType.Link&#125; href=<span class="string">"http//www.google.com"</span>&gt;Link&lt;<span class="regexp">/Button&gt;)</span></span><br><span class="line"><span class="regexp">    const element = wrapper.getByText('Link')</span></span><br><span class="line"><span class="regexp">    expect(element).toBeInTheDocument()</span></span><br><span class="line"><span class="regexp">    expect(element.tagName).toEqual('A')</span></span><br><span class="line"><span class="regexp">    expect(element).toHaveClass('btn btn-link')</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp">  it('should render disabled button when disabled set to true', () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const wrapper = render(&lt;Button &#123;...disabledProps&#125;&gt;Nice&lt;/</span>Button&gt;)</span><br><span class="line">    <span class="keyword">const</span> element = wrapper.getByText(<span class="string">'Nice'</span>) <span class="keyword">as</span> HTMLButtonElement <span class="comment">// 返回一个HTMLElement，但是我们要用到disabled，而且我们认为必返回Button，所以我们可以使用类型断言，把他变成一个button</span></span><br><span class="line">    expect(element).toBeInTheDocument()</span><br><span class="line">    expect(element.disabled).toBeTruthy()</span><br><span class="line">    fireEvent.click(element)</span><br><span class="line">    expect(disabledProps.onClick).not.toHaveBeenCalled() <span class="comment">// 因为是disabled属性，所以这里用到了not，表示没有被点击</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>——————————————————————————————————————</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i typescript -g</span><br><span class="line">tsc -V</span><br></pre></td></tr></table></figure><h1 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h1><p>布尔值<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isDone: <span class="built_in">boolean</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>数字<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> decLiteral: <span class="built_in">number</span> = <span class="number">20</span></span><br></pre></td></tr></table></figure></p><p>字符串<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="built_in">string</span> = <span class="string">'bob'</span></span><br><span class="line">name = <span class="string">'smith'</span></span><br></pre></td></tr></table></figure></p><p>数组<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这两种写法等价</span></span><br><span class="line"><span class="keyword">let</span> list: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> list: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure></p><p>元组 Tuple<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: [<span class="built_in">string</span>, <span class="built_in">number</span>]</span><br><span class="line">x= [<span class="string">'hello'</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure></p><p>枚举<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Color &#123;</span><br><span class="line">  Red,</span><br><span class="line">  Green,</span><br><span class="line">  Blue</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// let c: Color = Color[2]</span></span><br><span class="line"><span class="keyword">let</span> c: <span class="built_in">string</span> = Color[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c)</span><br></pre></td></tr></table></figure></p><p>any<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notSure: <span class="built_in">any</span> = <span class="number">4</span></span><br><span class="line">notSure = <span class="string">'maybe a string instead'</span></span><br><span class="line">notSure = <span class="literal">false</span></span><br></pre></td></tr></table></figure></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list: <span class="built_in">any</span>[] = [<span class="number">1</span>, <span class="literal">true</span>, <span class="string">'free'</span>]</span><br><span class="line">list[<span class="number">1</span>] = <span class="number">100</span></span><br></pre></td></tr></table></figure><p>void</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warnUser</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123; <span class="comment">//没有返回值的函数</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'This i my waring message'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>null 和 undefined<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> n: <span class="literal">null</span> = <span class="literal">null</span></span><br></pre></td></tr></table></figure></p><p>never 永远不存在<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> error(<span class="string">'something faild'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>object<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">o: object | <span class="literal">null</span></span>) : <span class="title">void</span></span>;</span><br><span class="line"><span class="comment">//原始类型 非原始类型</span></span><br><span class="line">create(o: &#123;prop: <span class="number">0</span>&#125;)</span><br><span class="line">create(o: <span class="literal">null</span>)</span><br><span class="line"><span class="comment">//基础类型 不行</span></span><br><span class="line">create(o: <span class="number">42</span>)</span><br><span class="line">create(o: <span class="string">'string'</span>)</span><br><span class="line">create(o: <span class="literal">false</span>)</span><br><span class="line">create(o: <span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure></p><p>类型断言<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue: <span class="built_in">any</span> = <span class="string">'string'</span></span><br><span class="line"><span class="comment">// let strLength: number = (&lt;string&gt;someValue).length</span></span><br><span class="line"><span class="keyword">let</span> strLength: <span class="built_in">number</span> = (someValue <span class="keyword">as</span> <span class="built_in">string</span>).length</span><br></pre></td></tr></table></figure></p><hr><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="number">3</span></span><br><span class="line">num = <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>编译<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tsc greeter.ts // 这么是不会报错的</span><br><span class="line">tsc greeter.ts --strictNullChecks //这么编译就会出错，就要用到联合类型，就不会报错了</span><br></pre></td></tr></table></figure></p><p>联合类型<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> | <span class="literal">null</span> = <span class="number">3</span></span><br><span class="line">num = <span class="literal">null</span></span><br></pre></td></tr></table></figure></p><h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Square &#123;</span><br><span class="line">  color: <span class="built_in">string</span></span><br><span class="line">  area: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可选参数<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> SquareConfig &#123;</span><br><span class="line">  color: <span class="built_in">string</span></span><br><span class="line">  width?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>完整实例<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Square &#123;</span><br><span class="line">  color: <span class="built_in">string</span></span><br><span class="line">  area: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> SquareConfig &#123;</span><br><span class="line">  color?: <span class="built_in">string</span></span><br><span class="line">  width?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSquear</span>(<span class="params">config: SquareConfig</span>): <span class="title">Square</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> newSquear = &#123; color: <span class="string">'white'</span>, area: <span class="number">100</span> &#125;</span><br><span class="line">  <span class="keyword">if</span> (config.color) &#123;</span><br><span class="line">    newSquear.color = config.color</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (config.width) &#123;</span><br><span class="line">    newSquear.area = config.width</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newSquear</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(createSquear(&#123;color: <span class="string">'red'</span>&#125;))</span><br></pre></td></tr></table></figure></p><p>只读属性,创建完成之后就不能再改变了<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Point &#123;</span><br><span class="line">  readonly x: <span class="built_in">number</span></span><br><span class="line">  readonly y: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1: Point = &#123; x: <span class="number">10</span>, y: <span class="number">20</span> &#125;</span><br><span class="line"></span><br><span class="line">p1.x = <span class="number">2</span> <span class="comment">// 报错，尝试对一个只读属性修改</span></span><br></pre></td></tr></table></figure></p><p>泛型只读数组<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;<span class="built_in">number</span>&gt; = a</span><br><span class="line">ro[<span class="number">0</span>] = <span class="number">12</span> <span class="comment">// 编译报错</span></span><br><span class="line">a = ro <span class="keyword">as</span> <span class="built_in">number</span>[] <span class="comment">// 这样可以，类型断言</span></span><br></pre></td></tr></table></figure></p><p>额外属性检查<br>索引签名<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这段代码要和上面的完整实例结合使用</span></span><br><span class="line"><span class="keyword">interface</span> SquareConfig &#123;</span><br><span class="line">  color?: <span class="built_in">string</span></span><br><span class="line">  width?: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">  [propName: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">// 索引签名</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(createSquear(&#123;color: <span class="string">'red'</span>, colorus: <span class="string">'names'</span>&#125;))</span><br></pre></td></tr></table></figure></p><p>函数类型接口<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> SearchFunc &#123;</span><br><span class="line">  (source: <span class="built_in">string</span>, subString: <span class="built_in">string</span>): <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">src, sub</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = src.search(sub)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不使用接口实现</span></span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">source: <span class="built_in">string</span>, subString: <span class="built_in">string</span></span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = src.search(sub)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>索引签名<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> StringArray &#123;</span><br><span class="line">  [index: <span class="built_in">number</span>]: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray: StringArray</span><br><span class="line"></span><br><span class="line">myArray = [<span class="string">'Bob'</span>, <span class="string">'Fred'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myStr: <span class="built_in">string</span> = myArray[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></p><h1 id="遇到的问题，搞不懂，先记录下来"><a href="#遇到的问题，搞不懂，先记录下来" class="headerlink" title="遇到的问题，搞不懂，先记录下来"></a>遇到的问题，搞不懂，先记录下来</h1><p>同时拥有string和number类型的索引签名，number索引返回值必须是string索引返回的子类型，因为当用一个数字索引时，js实际会在索引到对象之前将其转换为字符串</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Dog <span class="keyword">extends</span> Animal &#123;</span><br><span class="line">  breed: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error: indexing with a numeric string might get you a completely separate type of Animal!</span></span><br><span class="line"><span class="keyword">interface</span> NotOkay &#123;</span><br><span class="line">  [x: <span class="built_in">number</span>]: Animal;</span><br><span class="line">Numeric index <span class="keyword">type</span> <span class="string">'Animal'</span> is not assignable to <span class="built_in">string</span> index <span class="keyword">type</span> <span class="string">'Dog'</span>.</span><br><span class="line">  [x: <span class="built_in">string</span>]: Dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;TypeScript 学习&lt;br&gt;&lt;a href=&quot;https://github.com/DemoorBug/Typescript-axios&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;库地址&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="学习" scheme="demoorbug.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="TypeScript" scheme="demoorbug.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>React-learn</title>
    <link href="demoorbug.github.io/2019/06/04/React-learn/"/>
    <id>demoorbug.github.io/2019/06/04/React-learn/</id>
    <published>2019-06-04T22:52:20.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React学习笔记"><a href="#React学习笔记" class="headerlink" title="React学习笔记"></a>React学习笔记</h1><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;React学习笔记&quot;&gt;&lt;a href=&quot;#React学习笔记&quot; class=&quot;headerlink&quot; title=&quot;React学习笔记&quot;&gt;&lt;/a&gt;React学习笔记&lt;/h1&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="demoorbug.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="React" scheme="demoorbug.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>算法与数据解构初识</title>
    <link href="demoorbug.github.io/2019/05/26/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%84%E5%88%9D%E8%AF%86/"/>
    <id>demoorbug.github.io/2019/05/26/算法与数据解构初识/</id>
    <published>2019-05-26T19:22:57.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="算法与数据解构初始"><a href="#算法与数据解构初始" class="headerlink" title="算法与数据解构初始"></a>算法与数据解构初始</h1><p>jest 做测试，一些简单的测试，原因是有大量的js代码，如果逐个复制到浏览器，操作麻烦，而且不方便，测试可以提供工作效率<br><a id="more"></a><br>字符串，数组，正则都属于基本类型，排序，递归属于常见的算法，这个顺序是由简单到难的一个顺序</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;算法与数据解构初始&quot;&gt;&lt;a href=&quot;#算法与数据解构初始&quot; class=&quot;headerlink&quot; title=&quot;算法与数据解构初始&quot;&gt;&lt;/a&gt;算法与数据解构初始&lt;/h1&gt;&lt;p&gt;jest 做测试，一些简单的测试，原因是有大量的js代码，如果逐个复制到浏览器，操作麻烦，而且不方便，测试可以提供工作效率&lt;br&gt;
    
    </summary>
    
      <category term="算法" scheme="demoorbug.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="javascript" scheme="demoorbug.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>HTTP 协议</title>
    <link href="demoorbug.github.io/2019/05/18/HTTP-%E5%8D%8F%E8%AE%AE/"/>
    <id>demoorbug.github.io/2019/05/18/HTTP-协议/</id>
    <published>2019-05-18T16:12:59.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>get 获取数据<br>post 创建数据<br>put 更新数据<br>delete 删除<br>应该这么做，实际上不按照方法去实现，<br>语义存在的意义，就是希望别人用的时候，一眼就看有看出来干什么的， </p><h1 id="HTTP-CODE"><a href="#HTTP-CODE" class="headerlink" title="HTTP CODE"></a>HTTP CODE</h1><p>100-199之间代表操作要持续进行，接下来要做一些其他事情才会返回给你<br>200-299 代表操作成功<br>300-399 代表操作重定向，有别的方式获取数据<br>400-499 发送请求有问题，401发送请求的时候没有认证，没有权限获取资源的内容<br>500-599 服务器出现问题</p><h1 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h1><p>curl -v <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;get 获取数据&lt;br&gt;post 创建数据&lt;br&gt;put 更新数据&lt;br&gt;delete 删除&lt;br&gt;应该这么做，实际上不按照方法去实现，&lt;br&gt;语义存在的意义，就是希望别人用的时候，一眼就看有看出来干什么的， &lt;/p&gt;
&lt;h1 id=&quot;H
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>koa2 + vue2.5 + mongodb 开发记录</title>
    <link href="demoorbug.github.io/2019/05/06/koa2-vue2-5-mongodb-%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"/>
    <id>demoorbug.github.io/2019/05/06/koa2-vue2-5-mongodb-开发记录/</id>
    <published>2019-05-06T02:12:05.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="后端环境搭建"><a href="#后端环境搭建" class="headerlink" title="后端环境搭建"></a>后端环境搭建</h1><h2 id="node使用import语法"><a href="#node使用import语法" class="headerlink" title="node使用import语法"></a>node使用import语法</h2><p>@vue/cli 耦合，他会使用<code>babel.config.js</code>，而不会使用<code>.babelrc</code>，而且在<code>babel.config.js</code> 中配置会报错，所以要package.json 里面这样写<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">script: &#123;</span><br><span class="line">  <span class="string">"start-koa"</span>: <span class="string">"nodemon --exec babel-node server/index.js --config-file ./.babelrc"</span>,</span><br><span class="line">  <span class="string">"build-koa"</span>: <span class="string">"babel src --out-dir dist"</span>,</span><br><span class="line">  <span class="string">"serve-koa"</span>: <span class="string">"node dist/server.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><a id="more"></a><p>–config-file [path] 指定配置文件<br>要安装的包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@babel/cli</span><br><span class="line">@babel/core</span><br><span class="line">@babel/node          //新版本抽离出来了</span><br><span class="line">@babel/preset-env    </span><br><span class="line">nodemon</span><br></pre></td></tr></table></figure></p><p>.babelrc<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"@babel/preset-env"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;后端环境搭建&quot;&gt;&lt;a href=&quot;#后端环境搭建&quot; class=&quot;headerlink&quot; title=&quot;后端环境搭建&quot;&gt;&lt;/a&gt;后端环境搭建&lt;/h1&gt;&lt;h2 id=&quot;node使用import语法&quot;&gt;&lt;a href=&quot;#node使用import语法&quot; class=&quot;headerlink&quot; title=&quot;node使用import语法&quot;&gt;&lt;/a&gt;node使用import语法&lt;/h2&gt;&lt;p&gt;@vue/cli 耦合，他会使用&lt;code&gt;babel.config.js&lt;/code&gt;，而不会使用&lt;code&gt;.babelrc&lt;/code&gt;，而且在&lt;code&gt;babel.config.js&lt;/code&gt; 中配置会报错，所以要package.json 里面这样写&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;script: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;start-koa&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;nodemon --exec babel-node server/index.js --config-file ./.babelrc&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;build-koa&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;babel src --out-dir dist&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;serve-koa&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;node dist/server.js&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>面试问题</title>
    <link href="demoorbug.github.io/2019/04/19/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/"/>
    <id>demoorbug.github.io/2019/04/19/面试问题/</id>
    <published>2019-04-19T23:38:13.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="记录一些学习过程中遇到的面试问题"><a href="#记录一些学习过程中遇到的面试问题" class="headerlink" title="记录一些学习过程中遇到的面试问题"></a>记录一些学习过程中遇到的面试问题</h1><a id="more"></a><h1 id="暂存死区"><a href="#暂存死区" class="headerlink" title="暂存死区"></a>暂存死区</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> monkey = <span class="string">'我是美猴王'</span>;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(monkey); <span class="comment">//按道理应该取外面的let，但是输出'monkey is not defined'</span></span><br><span class="line">  <span class="keyword">let</span> monkey = <span class="string">'我觉得还能抢救一下'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(monkey);</span><br></pre></td></tr></table></figure><p>ES6中规定，如果块级作用域中存在let，const声明的变量，这个变量一开始就会形成一个封闭的作用域，即使向上的作用域中存在同名的变量，也是拿不到的</p><h1 id="生成十给按钮，每个按点击的时候弹出-1-10"><a href="#生成十给按钮，每个按点击的时候弹出-1-10" class="headerlink" title="生成十给按钮，每个按点击的时候弹出 1-10"></a>生成十给按钮，每个按点击的时候弹出 1-10</h1><p>ES5<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">    btn.innerText = i;</span><br><span class="line">    btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      alert(i)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(btn);</span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ES6<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> btn = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">  btn.innerText = i;</span><br><span class="line">  btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(i)</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(btn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;记录一些学习过程中遇到的面试问题&quot;&gt;&lt;a href=&quot;#记录一些学习过程中遇到的面试问题&quot; class=&quot;headerlink&quot; title=&quot;记录一些学习过程中遇到的面试问题&quot;&gt;&lt;/a&gt;记录一些学习过程中遇到的面试问题&lt;/h1&gt;
    
    </summary>
    
      <category term="面试" scheme="demoorbug.github.io/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="node" scheme="demoorbug.github.io/tags/node/"/>
    
      <category term="js" scheme="demoorbug.github.io/tags/js/"/>
    
      <category term="html" scheme="demoorbug.github.io/tags/html/"/>
    
      <category term="css" scheme="demoorbug.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>移动webapp</title>
    <link href="demoorbug.github.io/2019/04/12/%E7%A7%BB%E5%8A%A8webapp/"/>
    <id>demoorbug.github.io/2019/04/12/移动webapp/</id>
    <published>2019-04-12T18:47:45.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="移动webapp开发"><a href="#移动webapp开发" class="headerlink" title="移动webapp开发"></a>移动webapp开发</h1><a id="more"></a><h1 id="视口"><a href="#视口" class="headerlink" title="视口"></a>视口</h1><h2 id="viewport-标签的介绍"><a href="#viewport-标签的介绍" class="headerlink" title="viewport 标签的介绍"></a>viewport 标签的介绍</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mate</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>width=device-width 视口宽，自适应<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mate</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"height"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>很少用height，基本不用<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mate</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>initial-scale=1 缩放比<br>相当于设置width=device-width，但是用的时候都得写，因为个浏览器有bug<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mate</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>不允许用户缩放<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mate</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"maximum-scale=1, minimum-scale=1"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>最大缩放比，和最小缩放比</p><p>标准写法<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1, minimum-scale=1"</span>&gt;</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure></p><h2 id="获取视口宽度"><a href="#获取视口宽度" class="headerlink" title="获取视口宽度"></a>获取视口宽度</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.innerWidth);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.documentElement.clientWidth);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.documentElement.getBoundingClientRect().width);</span><br><span class="line"><span class="comment">// 兼容个浏览器写法</span></span><br><span class="line"><span class="keyword">var</span> width = <span class="built_in">document</span>.documentElement.clientWidth || <span class="built_in">window</span>.innerWidth</span><br><span class="line"><span class="comment">// dpr</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.devicePixelRatio);</span><br></pre></td></tr></table></figure><h1 id="Flex-布局，弹性布局"><a href="#Flex-布局，弹性布局" class="headerlink" title="Flex 布局，弹性布局"></a>Flex 布局，弹性布局</h1><p>这个box就为flex的container容器<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex | inline-flex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="flex布局属性"><a href="#flex布局属性" class="headerlink" title="flex布局属性"></a>flex布局属性</h2><h3 id="flex-direction-决定主轴方向"><a href="#flex-direction-决定主轴方向" class="headerlink" title="flex-direction 决定主轴方向"></a><code>flex-direction</code> 决定主轴方向</h3><p><code>row</code>: 默认值<br><code>row-reverse</code>: 主轴为水平方向，起点在右端<br><code>column</code>: 主轴水平方向变为垂直方向，起点在上<br><code>column-reverse</code>: 主轴为垂直方向，起点在下</p><h3 id="flex-wrap-换行"><a href="#flex-wrap-换行" class="headerlink" title="flex-wrap 换行"></a><code>flex-wrap</code> 换行</h3><p>一条轴线排不下，是否换行<br><code>nowrap</code>: 不换行，默认值<br><code>wrap</code>: 换行<br><code>wrap-reverse</code>: 相反换行</p><h3 id="flex-flow-简写，上面两种属性的简写"><a href="#flex-flow-简写，上面两种属性的简写" class="headerlink" title="flex-flow 简写，上面两种属性的简写"></a><code>flex-flow</code> 简写，上面两种属性的简写</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  flex-flow: row nowrap; //默认值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="justify-content-属性定义了项目在主轴上的对齐方式-常用"><a href="#justify-content-属性定义了项目在主轴上的对齐方式-常用" class="headerlink" title="justify-content 属性定义了项目在主轴上的对齐方式   常用"></a><code>justify-content</code> 属性定义了项目在主轴上的对齐方式   常用</h3><p><code>flex-start</code>: 默认值<br><code>flex-end</code>: 右对齐<br><code>center</code>: 居中<br><code>space-between</code>: 两端对齐<br><code>space-around</code>: 每个项目两侧间隔相等</p><h3 id="align-items-交叉轴对齐方式"><a href="#align-items-交叉轴对齐方式" class="headerlink" title="align-items 交叉轴对齐方式"></a><code>align-items</code> 交叉轴对齐方式</h3><p><code>flex-start</code>: 不是默认值<br><code>flex-end</code>: 交叉轴终点对其<br><code>center</code>: 中点对齐<br><code>baseline</code>: 项目的第一行文字的基线对其<br><code>stretch</code>: 默认值，项目未设置高度或设为auto，将沾满整个容器的高度</p><h3 id="align-content-多根轴线对齐方式-多行-，如果项目只有一根轴线，则不起作用"><a href="#align-content-多根轴线对齐方式-多行-，如果项目只有一根轴线，则不起作用" class="headerlink" title="align-content 多根轴线对齐方式(多行)，如果项目只有一根轴线，则不起作用"></a><code>align-content</code> 多根轴线对齐方式(多行)，如果项目只有一根轴线，则不起作用</h3><p>属性值和<code>justify-content</code>一致, 默认值为<code>stretch</code></p><h2 id="项目属性"><a href="#项目属性" class="headerlink" title="项目属性"></a>项目属性</h2><p>###　<code>order</code> 属性定义项目的排列顺序，数值越小，排列越靠前，默认为0<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  <span class="attribute">order</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="flex-grow-默认值为0，类似于，栅格系统，不过更灵活"><a href="#flex-grow-默认值为0，类似于，栅格系统，不过更灵活" class="headerlink" title="flex-grow 默认值为0，类似于，栅格系统，不过更灵活"></a><code>flex-grow</code> 默认值为0，类似于，栅格系统，不过更灵活</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-2</span> &#123;</span><br><span class="line">  flex-grow: 2;  //2的值就占用项目.item-1的二倍</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果有固定宽度，则减去这个固定宽度，等分其他空间<br>如果两个值都为1，则总共有两份，大家都占用了2/1空间，</p><h3 id="flex-shrink-默认值为1，属性定位缩小比例，和flex-grow是相反的"><a href="#flex-shrink-默认值为1，属性定位缩小比例，和flex-grow是相反的" class="headerlink" title="flex-shrink 默认值为1，属性定位缩小比例，和flex-grow是相反的"></a><code>flex-shrink</code> 默认值为1，属性定位缩小比例，和<code>flex-grow</code>是相反的</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  flex-shrink: 0; //不缩放该项目</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="flex-basis-默认值为auto-项目占据的主轴空间，如果有width属性，就会覆盖width属性-浏览器根据这个属性，计算主轴是否有多余空间"><a href="#flex-basis-默认值为auto-项目占据的主轴空间，如果有width属性，就会覆盖width属性-浏览器根据这个属性，计算主轴是否有多余空间" class="headerlink" title="flex-basis 默认值为auto,项目占据的主轴空间，如果有width属性，就会覆盖width属性, 浏览器根据这个属性，计算主轴是否有多余空间"></a><code>flex-basis</code> 默认值为auto,项目占据的主轴空间，如果有width属性，就会覆盖width属性, 浏览器根据这个属性，计算主轴是否有多余空间</h3><h3 id="flex-是前面3给的简写，不算order"><a href="#flex-是前面3给的简写，不算order" class="headerlink" title="flex 是前面3给的简写，不算order"></a><code>flex</code> 是前面3给的简写，不算<code>order</code></h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  flex: 1; //相当于flex: 1 1 auto; 相当于 flex: auto</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="align-self-默认auto-表示继承align-items-可覆盖align-items-如果没有父元素，则等同于stretch"><a href="#align-self-默认auto-表示继承align-items-可覆盖align-items-如果没有父元素，则等同于stretch" class="headerlink" title="align-self 默认auto, 表示继承align-items, 可覆盖align-items, 如果没有父元素，则等同于stretch"></a><code>align-self</code> 默认auto, 表示继承align-items, 可覆盖align-items, 如果没有父元素，则等同于stretch</h3><p>属性都可以借鉴<code>align-items</code></p><h1 id="媒体查询"><a href="#媒体查询" class="headerlink" title="媒体查询"></a>媒体查询</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">900px</span>) &#123;&#125;</span><br></pre></td></tr></table></figure><p><code>screen</code> 屏幕类型，除了屏幕打印设备和阅读设备</p><h2 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h2><p>all(default)<br>screen / print(打印预览，可以做简历) /speech(阅读设备，残障人士使用)<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> all and (min-width=<span class="number">900px</span>) &#123;&#125;</span><br></pre></td></tr></table></figure></p><p><code>all</code>因为是默认值，可以不写<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> (min-width=<span class="number">900px</span>) &#123;&#125;</span><br></pre></td></tr></table></figure></p><h2 id="媒体查询中的逻辑"><a href="#媒体查询中的逻辑" class="headerlink" title="媒体查询中的逻辑"></a>媒体查询中的逻辑</h2><p>与(and)<br>或(,)<br>非(not)</p><p>或写法：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (min-width=<span class="number">1024px</span>), (max-width:<span class="number">900px</span>) &#123;&#125;</span><br></pre></td></tr></table></figure></p><p>值得注意的是，或(,)之后的算是个体，也就是说，我们使用了默认值all的写法</p><p>非写法：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> not screen and (min-width=<span class="number">1024px</span>), (max-width:<span class="number">900px</span>) &#123;&#125;</span><br></pre></td></tr></table></figure></p><p>同理，只是前半段，或之后算一个整体</p><h2 id="媒体特征表达"><a href="#媒体特征表达" class="headerlink" title="媒体特征表达"></a>媒体特征表达</h2><p><code>max-width, min-width, width</code><br>设备像素比<br>dpr<br><code>-webkit-device-pixel-ratio: 2,-webkit-max-device-pixel-ratio: 2,-webkit-min-device-pixel-ratio: 2</code></p><p><code>orientation</code><br>有两个值：<code>landscape</code> 横屏(宽比高大)，<code>portrait</code> 竖屏<br>后面还有值，几乎不用，了解即可，这里就没有记录，要看的就是3-19 媒体查询-基础(2).vep</p><h2 id="媒体查询策略"><a href="#媒体查询策略" class="headerlink" title="媒体查询策略"></a>媒体查询策略</h2><p>设置断点<br>xs: &lt; 576px<br>sm: 576px ~ 768px<br>md: 768px ~ 992px<br>lg: 992px ~ 1200px<br>xl: &gt; 1200px</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="keyword">medio</span> screen and (max-width=<span class="number">576px</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">medio</span> screen and (min-width=<span class="number">577px</span>) and (max=<span class="number">768px</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">medio</span> screen and (min-width=<span class="number">769px</span>) and (max=<span class="number">992px</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">medio</span> screen and (min-width=<span class="number">993px</span>) and (max=<span class="number">1200px</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">medio</span> screen and (min-width=<span class="number">1201px</span>) &#123;&#125;</span><br></pre></td></tr></table></figure><h1 id="移动端单位问题"><a href="#移动端单位问题" class="headerlink" title="移动端单位问题"></a>移动端单位问题</h1><h2 id="em的技巧"><a href="#em的技巧" class="headerlink" title="em的技巧"></a>em的技巧</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.font</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  text-indent: 2em; //这个em就会继承当前元素字体的大小，也就是2个字节，很方便啊</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="rem主流"><a href="#rem主流" class="headerlink" title="rem主流"></a>rem主流</h2><p>这么写，内容就可以根据宽度自适应变化，666，公式就是：<br>(当前页面宽度/375) * 20 这个比例，为什么是这个比例呢<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"screen"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    html &#123;</span></span><br><span class="line"><span class="undefined">      font-size: 20px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">width</span>: 2<span class="selector-class">.5rem</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">height</span>: 2<span class="selector-class">.5rem</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background</span>: <span class="selector-id">#222</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.documentElement.style.fontSize = (<span class="built_in">document</span>.documentElement.clientWidth / <span class="number">375</span>)* <span class="number">20</span> +<span class="string">'px'</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="响应开发，因为都懂，就记一些不懂的吧"><a href="#响应开发，因为都懂，就记一些不懂的吧" class="headerlink" title="响应开发，因为都懂，就记一些不懂的吧"></a>响应开发，因为都懂，就记一些不懂的吧</h1><h2 id="img图片的处理"><a href="#img图片的处理" class="headerlink" title="img图片的处理"></a>img图片的处理</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block; <span class="comment">/*因为默认是inline-block;*/</span></span><br><span class="line">  <span class="comment">/*但是这样解决会造，一行显示换行问题*/</span></span><br><span class="line">  <span class="comment">/*最优解决*/</span></span><br><span class="line">  <span class="attribute">vertical-align</span>: top; <span class="comment">/*这个属性居然没用过，而且所有浏览器都支持*/</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上选一即可</p><h1 id="通用适配"><a href="#通用适配" class="headerlink" title="通用适配"></a>通用适配</h1><p>设计稿750px为例<br>750px 1rem = 750 / 18.75 = 40<br>js动态去设置font-size<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// document.documentElement.getBoundingClientRect().width</span></span><br><span class="line"><span class="comment">// window.innerWidth</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="string">'use str'</span></span><br><span class="line">  setRemUnit()</span><br><span class="line">  <span class="built_in">window</span>.onresize = setRemUnit;</span><br><span class="line">  <span class="comment">// window.addEventListener('resize', setRemUnit); 都可以</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setRemUnit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> docEl = <span class="built_in">document</span>.documentElement;</span><br><span class="line">    <span class="keyword">var</span> ratio = <span class="number">18.75</span>;</span><br><span class="line">    <span class="keyword">var</span> viewWidth = docEl.getBoundingClientRect().width || <span class="built_in">window</span>.innerWidth; <span class="comment">//兼容处理</span></span><br><span class="line">    docEl.style.fontSize = viewWidth / ratio + <span class="string">'px'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><h1 id="通用适配解决方案，解决1px边框显示过’粗’问题"><a href="#通用适配解决方案，解决1px边框显示过’粗’问题" class="headerlink" title="通用适配解决方案，解决1px边框显示过’粗’问题"></a>通用适配解决方案，解决1px边框显示过’粗’问题</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="string">'use str'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取dpr</span></span><br><span class="line">  <span class="keyword">var</span> docEl = <span class="built_in">document</span>.documentElement,</span><br><span class="line">    viewportEl = <span class="built_in">document</span>.querySelector(<span class="string">'meta[name="viewport"]'</span>),</span><br><span class="line">    dpr = <span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>,</span><br><span class="line">    maxWidth = <span class="number">540</span>,</span><br><span class="line">    minWidth = <span class="number">320</span>;</span><br><span class="line"></span><br><span class="line">  dpr = dpr &gt;= <span class="number">3</span> ? <span class="number">3</span> : (dpr &gt;= <span class="number">2</span> ? <span class="number">2</span> : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  docEl.setAttribute(<span class="string">'data-dpr'</span>, dpr);<span class="comment">// 自己设置dpr，后面有用处</span></span><br><span class="line">  docEl.setAttribute(<span class="string">'max-width'</span>, maxWidth);</span><br><span class="line">  docEl.setAttribute(<span class="string">'min-width'</span>, minWidth);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> scale = <span class="number">1</span>/dpr,</span><br><span class="line">      content = <span class="string">'width=device-width, initial-scale='</span>+ scale +<span class="string">', maximum-scale='</span>+ scale +<span class="string">', minimum-scale='</span>+ scale +<span class="string">', user-scalable=no'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (viewportEl) &#123;</span><br><span class="line">    viewportEl.setAttribute(<span class="string">'content'</span>, content)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    viewportEl = <span class="built_in">document</span>.createElement(<span class="string">'meta'</span>);</span><br><span class="line">    viewportEl.setAttribute(<span class="string">'name'</span>, <span class="string">'viewport'</span>);</span><br><span class="line">    viewportEl.setAttribute(<span class="string">'content'</span>, content);</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(viewportEl)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  setRemUnit()</span><br><span class="line">  <span class="built_in">window</span>.onresize = setRemUnit;</span><br><span class="line">  <span class="comment">// window.addEventListener('resize', setRemUnit); 都可以</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setRemUnit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// var docEl = document.documentElement;</span></span><br><span class="line">    <span class="keyword">var</span> ratio = <span class="number">18.75</span>;</span><br><span class="line">    <span class="keyword">var</span> viewWidth = docEl.getBoundingClientRect().width || <span class="built_in">window</span>.innerWidth; <span class="comment">//兼容处理</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置最大最小值，页面过大后不设置fontSize</span></span><br><span class="line">    <span class="keyword">if</span> (maxWidth &amp;&amp; (viewWidth / dpr &gt; maxWidth)) &#123;</span><br><span class="line">      viewWidth = maxWidth * dpr;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (maxWidth &amp;&amp; (viewWidth / dpr &lt; minWidth))&#123;</span><br><span class="line">      viewWidth = minWidth * dpr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    docEl.style.fontSize = viewWidth / ratio + <span class="string">'px'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h1 id="移动端事件"><a href="#移动端事件" class="headerlink" title="移动端事件"></a>移动端事件</h1><p>触摸事件，手势事件，传感器事件，主要讲的是触摸事件，其他两个兼容性堪忧，而且手势事件也可以用触摸事件代替，传感器事件就是手机倾斜什么的，但是兼容性不ok</p><p>触摸事件可以非为两种：<br><code>touch</code> 事件，最早出现的，兼容性ok<br><code>pointer</code> 事件 ，这个是微软出的，比较友好，但是呢实现的厂商不多，兼容性不好，但是很有意义，把鼠标事件和触摸事件统一为指针事件，不论是pc端还是移动端，只用使用<code>pointer</code>事件就ok了</p><h2 id="touch-事件"><a href="#touch-事件" class="headerlink" title="touch 事件"></a>touch 事件</h2><p><code>ontouchstart</code>  触摸开始执行<br><code>ontouchmove</code>   移动执行<br><code>ontouchend</code>    触摸结束执行<br><code>ontouchcancel</code>  不常用，发生触摸中断的时候执行，当我们点击的时候，突然来电话，界面跳转，称之为触摸中断。系统级事件</p><p><code>document.ontouchstart = function () {}</code> 这种写法不推荐，如果要兼容IE8浏览器及一下，还是用这种</p><p><code>document.addEventListener(&#39;touchstart&#39;, function(){}, false)</code> 推荐写法，IE9及以上兼容。第三个参数表示冒泡，true表示捕获</p><h2 id="touch-事件event-对象"><a href="#touch-事件event-对象" class="headerlink" title="touch 事件event 对象"></a>touch 事件event 对象</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ev)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>以上对象属性含义:<br><code>altKey: false</code> 触摸的时候是否有按住alt键，手机哪来的alt键<br>以下三个和冒泡有关<br><code>bubbles: true</code>  目前是否是冒泡<br><code>cacelBubble: false</code> 目前是否取消冒泡<br><code>cancelable: true</code> 是否可以取消冒泡<br>以下就讲了一下主要用到的，其他就不讲了<br><code>type</code> 知道当前什么事件，和pc端事件一样<br><code>target</code> 当前元素，什么元素响应你的<br><code>changeTouches</code> 捕获发生变化的手指，触摸列表，类数组(没有数组的方法),一般情况下都使用这个，其中一个原因是<code>ontouchend</code>事件以下两种捕获不到东西<br><code>targetTouches</code> 捕获到物体上的手指<br><code>touches</code> 捕获到屏幕上所有手指头</p><p>常用<code>changeTouches</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> touch = ev.changeTouches[<span class="number">0</span>] <span class="comment">//一般都是单指</span></span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p><p><code>changeTouches</code>里面的属性：<br><code>clientX:</code> 可视区范围内的坐标<br><code>clientY:</code> 可视区范围内的坐标<br><code>pageX</code> 有滚动条的时候，也会把滚动条的距离算上，而不仅仅是可视区域<br><code>pageY</code><br><code>radiusX</code> 指头的触摸大小半径<br><code>radiusY</code></p><h2 id="这里讲到了拖动，我没有做，明天补上，今晚记一些技巧"><a href="#这里讲到了拖动，我没有做，明天补上，今晚记一些技巧" class="headerlink" title="这里讲到了拖动，我没有做，明天补上，今晚记一些技巧"></a>这里讲到了拖动，我没有做，明天补上，今晚记一些技巧</h2><p>chrome的a点击有个高亮，当时自己还是百度了好久，我晕<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-tap-highlight-color</span>: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>还有就是用transform的时候用translate3d，会开启设备的GPU加速<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.backtop</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(x, y, 0); <span class="comment">/*会开启GPU加速*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>补：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"screen"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    html &#123;</span></span><br><span class="line"><span class="undefined">      height: 2000px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.top</span> &#123;</span></span><br><span class="line"><span class="undefined">      height: 20px;</span></span><br><span class="line"><span class="undefined">      width: 20px;</span></span><br><span class="line"><span class="undefined">      position: fixed;</span></span><br><span class="line"><span class="undefined">      bottom: 20px;</span></span><br><span class="line"><span class="undefined">      right: 20px;</span></span><br><span class="line"><span class="undefined">      border-radius: 50%;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background</span>: <span class="selector-tag">rgba</span>(0,0,0,<span class="selector-class">.3</span>);</span></span><br><span class="line"><span class="css">      <span class="comment">/*transition: all .3s;*/</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"top"</span> <span class="attr">id</span>=<span class="string">"top"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    122</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> docEl = <span class="built_in">document</span>.documentElement;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> topN = <span class="built_in">document</span>.getElementById(<span class="string">'top'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> coordinate = &#123;</span></span><br><span class="line"><span class="undefined">      pageX: 0,</span></span><br><span class="line"><span class="undefined">      pageY: 0</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> page = &#123;</span></span><br><span class="line"><span class="undefined">      pageX: 0,</span></span><br><span class="line"><span class="undefined">      pageY: 0</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> isTouchMove = <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    topN.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> changedTouches = ev.changedTouches[<span class="number">0</span>]</span></span><br><span class="line"><span class="undefined">      coordinate.pageX = changedTouches.pageX;</span></span><br><span class="line"><span class="undefined">      coordinate.pageY = changedTouches.pageY;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="javascript">    topN.addEventListener(<span class="string">'touchmove'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">      ev.preventDefault()</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      isTouchMove = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> changedTouches = ev.changedTouches[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> x = changedTouches.pageX - coordinate.pageX + page.pageX;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> y = changedTouches.pageY - coordinate.pageY + page.pageY;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      ev.target.style.transform = <span class="string">'translate3d('</span>+ x +<span class="string">'px,'</span>+ y +<span class="string">'px,0)'</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="javascript">    topN.addEventListener(<span class="string">'touchend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (!isTouchMove) &#123;<span class="keyword">return</span>&#125;;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'touch'</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> changedTouches = ev.changedTouches[<span class="number">0</span>]</span></span><br><span class="line"><span class="undefined">      page.pageX += changedTouches.pageX - coordinate.pageX;</span></span><br><span class="line"><span class="undefined">      page.pageY += changedTouches.pageY - coordinate.pageY;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      isTouchMove = <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="移动端调试"><a href="#移动端调试" class="headerlink" title="移动端调试"></a>移动端调试</h1><h2 id="Vorlon-js"><a href="#Vorlon-js" class="headerlink" title="Vorlon.js"></a>Vorlon.js</h2><h2 id="多端同步工具Browsersync"><a href="#多端同步工具Browsersync" class="headerlink" title="多端同步工具Browsersync"></a>多端同步工具Browsersync</h2><h2 id="终端检测，navigator"><a href="#终端检测，navigator" class="headerlink" title="终端检测，navigator"></a>终端检测，navigator</h2><p>最好后端来做，但是前端也是可以做的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> isMobile = navigator.userAgent.match(<span class="regexp">/android|iphone|ipad|ipod/i</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isMobile) &#123;</span><br><span class="line">  location.href = <span class="string">'https://m.imooc.com'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  location.href = <span class="string">'https://www.imooc.com'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以根据这段代码，加载各端自己的代码，比如响应式开发</p><h1 id="移动开发常见问题"><a href="#移动开发常见问题" class="headerlink" title="移动开发常见问题"></a>移动开发常见问题</h1><p>解决html5标签兼容问题引入<br><code>html5shiv.js</code></p><h2 id="css3-兼容问题"><a href="#css3-兼容问题" class="headerlink" title="css3 兼容问题"></a>css3 兼容问题</h2><p>用<code>modernizr.js</code> 这个库来兼容，写两套样式</p><h2 id="click-300毫秒延迟解决"><a href="#click-300毫秒延迟解决" class="headerlink" title="click 300毫秒延迟解决"></a>click 300毫秒延迟解决</h2><p>原因是手机端的double click双击造成的，<br>解决办法<code>fastclick</code>,很多浏览器已经解决就是给<code>viewport</code>添加<code>width=device-width</code></p><h2 id="文字溢出问题"><a href="#文字溢出问题" class="headerlink" title="文字溢出问题"></a>文字溢出问题</h2><p>普通解决方法不能配合<code>flex</code> 布局，必须给元素套一层<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"screen"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.text-ellipsis</span> &#123;</span></span><br><span class="line"><span class="undefined">    overflow: hidden;</span></span><br><span class="line"><span class="undefined">    text-overflow: ellipsis;</span></span><br><span class="line"><span class="undefined">    white-space: normal;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.flex</span> &#123;</span></span><br><span class="line"><span class="undefined">    display: flex;</span></span><br><span class="line"><span class="undefined">    justify-content: center;</span></span><br><span class="line"><span class="undefined">    align-items: center;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-ellipsis flex"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>文字<span class="tag">&lt;/<span class="name">span</span>&gt;</span> //套一层就好了</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>多行文字溢出问题解决<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"screen"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.flex</span> &#123;</span></span><br><span class="line"><span class="undefined">    display: flex;</span></span><br><span class="line"><span class="undefined">    justify-content: center;</span></span><br><span class="line"><span class="undefined">    align-items: center;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.multiline-ellipsis</span> &#123;</span></span><br><span class="line"><span class="undefined">    overflow: hidden;</span></span><br><span class="line"><span class="undefined">    text-overflow: ellipsis;</span></span><br><span class="line"><span class="undefined">    display: -webkit-box;</span></span><br><span class="line"><span class="undefined">    -webkit-line-clamp: 3; 这个就可以控制显示几行文字</span></span><br><span class="line"><span class="undefined">    -webkit-box-orient: vertical;</span></span><br><span class="line"><span class="undefined">    white-space: normal !important;</span></span><br><span class="line"><span class="undefined">    word-wrap: break-word;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"multiline-ellipsis flex"</span>&gt;</span></span><br><span class="line">  文字</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="javascript兼容"><a href="#javascript兼容" class="headerlink" title="javascript兼容"></a>javascript兼容</h2><p>做特性检测，不要做浏览器检测<br>这个是fastclick.js的特性检测做法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">'addEventListener'</span> <span class="keyword">in</span> <span class="built_in">document</span>) &#123; <span class="comment">//这个是fastclick.js的特性检测做法</span></span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    FastClick.attach(<span class="built_in">document</span>.body)</span><br><span class="line">  &#125;, <span class="literal">false</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>特性检测就很简单，就是判断以下，要加<code>window</code>的原因是因为如果没有该元素就会报错，未定义，而挂载到<code>window</code>上，他就会报<code>undefined</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (requestAnimateionFrom) &#123; <span class="comment">//错误写法，如果不存在就会变成一个没有声明的变量</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.requestAnimateionFrom) &#123; <span class="comment">//正确做法</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>前缀<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> requestAnimationFrame = <span class="built_in">window</span>.requestAnimateionFrom || <span class="built_in">window</span>.webkitRequestAnimationFrame || <span class="built_in">window</span>.mozRequestAnimationFrame || <span class="built_in">window</span>.msRequestAnimationFrame || <span class="built_in">window</span>.oRequestAnimationFrame || <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;setTimeout(fn, <span class="number">16</span>)&#125;;</span><br></pre></td></tr></table></figure></p><h2 id="移动端动画"><a href="#移动端动画" class="headerlink" title="移动端动画"></a>移动端动画</h2><p>优先使用 <code>requestAnimateionFrom</code>, 请求动画帧<br>css3使用<code>transition</code>, <code>animation</code></p><p><code>canvas</code> 要配合<code>setTimeout</code>,<code>setInterval</code>做动画，不能用css3，而DOM动画，就可以用提到的所有</p><h2 id="水平居中和垂直居中"><a href="#水平居中和垂直居中" class="headerlink" title="水平居中和垂直居中"></a>水平居中和垂直居中</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">水平居中：</span><br><span class="line">`text-align: center` 有固定宽度就可以使用</span><br><span class="line">`margin: 0 auto` 针对块级容器，有固定宽度</span><br><span class="line">`position+margin-left/translate` 以前仅用到了`margin`来解决，不过`translate`可以解决没有固定宽度，也可以实现</span><br><span class="line">`flex`终极解决方案</span><br><span class="line">垂直居中</span><br><span class="line">`line-height` 有固定高度可以使用，仅仅只能用于单行文字，其实配合</span><br><span class="line">`position+margin-top/translate` 同理</span><br><span class="line">`flex`终极解决方案</span><br><span class="line"></span><br><span class="line">## Zepto</span><br><span class="line">这里面虽然都很基础，和jQuery都差不多，不过还是能学到东西的，比如`window.onload`和`$(document).ready(function ()&#123;&#125;)`的区别，前者是页面全部加载完成，包括图片，js，css，dom,后者则是dom加载完毕，肯定是dom加载完毕更高效啊</span><br></pre></td></tr></table></figure><p>还有事件的命名空间，<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).on(<span class="string">'click.muke'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'click'</span>);</span><br><span class="line">  $(<span class="keyword">this</span>).off(<span class="string">'.muke'</span>) <span class="comment">//大概是这么写的？</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>这样就仅仅会取消一个，以前老师教的是创建一个变量<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ev;</span><br><span class="line">$(<span class="built_in">document</span>).on(<span class="string">'click'</span>, ev = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'click'</span>);</span><br><span class="line">  $(<span class="keyword">this</span>).off(ev)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="按需加载，我觉得还是另一个老师讲的细，这里就不深究了，看那个老师的就ok，这个参考一下就好"><a href="#按需加载，我觉得还是另一个老师讲的细，这里就不深究了，看那个老师的就ok，这个参考一下就好" class="headerlink" title="按需加载，我觉得还是另一个老师讲的细，这里就不深究了，看那个老师的就ok，这个参考一下就好"></a>按需加载，我觉得还是另一个老师讲的细，这里就不深究了，看那个老师的就ok，这个参考一下就好</h2><h1 id="实战开始-这里就直接上vue项目了"><a href="#实战开始-这里就直接上vue项目了" class="headerlink" title="实战开始,这里就直接上vue项目了"></a>实战开始,这里就直接上vue项目了</h1><p>页面最大宽度640，最小宽度320<br>设计稿为 375px 的页面，扩大两倍到750px，做标注，同时等比放大1.5倍生成宽度位1125的设计稿，在这里面切图</p><p>项目初始化完毕了，很简单，懒加载，重定向什么的</p><p>全局的样式都写在<code>assets/less</code>目录，这样便于管理，而且可以全局引入，其他页面都不用引入</p><p><strong>固定定位，以前的手机兼容不好，最好使用绝对定位来模拟</strong></p><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>src/<br>– assets 全局文件<br>– base 基础组件<br>– components 公共组件<br>– views 所有页面放的位置，一个文件夹代表一块，index为默认出口<br>– App.vue<br>– main.js<br>– router.js<br>– store.js<br><strong>基础组件和业务逻辑毫无瓜葛</strong><br>也就是说base里面的组件都可以扩展，slot插槽</p><h2 id="用到的插件统计"><a href="#用到的插件统计" class="headerlink" title="用到的插件统计"></a>用到的插件统计</h2><p><code>fastclick</code> 解决移动端300点击延迟<br><code>Vue-Awesome-Swiper</code> vue 封装的 swiper插件，轮播<br><code>jsonp</code> 获取jsonp数据<br><code>vue-lazyload</code> 延迟加载</p><h2 id="开发vue项目用到的技巧"><a href="#开发vue项目用到的技巧" class="headerlink" title="开发vue项目用到的技巧"></a>开发vue项目用到的技巧</h2><p>header 部分公共化<br>使用slot插槽，$slots判断是否使用了该插槽，没使用就隐藏<br>这里遇到个问题，定位问题如果前面元素不显示就会导致，最后一个元素无法右对齐，所以呢，有两种方案，第一种就是把第一个元素不用v-if判断，一直显示，另一种是用css3选择器完成，不过我觉得没必要，用到的选择器~ , 不过呢，我觉得这种方法很笨，不会用<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- navbar.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mine-navbar"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mine-navbar-left"</span> <span class="attr">v-if</span>=<span class="string">"$slots.left"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mine-navbar-center"</span> <span class="attr">v-if</span>=<span class="string">"$slots.center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mine-navbar-right"</span> <span class="attr">v-if</span>=<span class="string">"$slots.right"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"mine-navbar-title"</span> <span class="attr">v-if</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"mine-navbar-text ellipsis"</span> <span class="attr">v-text</span>=<span class="string">"title"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">@<span class="keyword">import</span> <span class="string">'~assets/less/_mixins.less'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.mine-navbar</span> &#123;</span></span><br><span class="line"><span class="undefined">  display: flex;</span></span><br><span class="line"><span class="undefined">  justify-content: space-between;</span></span><br><span class="line"><span class="undefined">  align-items: center;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">height</span>: @<span class="keyword">navbar</span>-<span class="keyword">height</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="undefined">  &amp;-left &#123;</span></span><br><span class="line"><span class="undefined">    margin-left: 20/@r;</span></span><br><span class="line"><span class="undefined">    ~ .mine-navbar-right &#123;  //新增代码</span></span><br><span class="line"><span class="undefined">      position: static;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  &amp;-center &#123;</span></span><br><span class="line"><span class="undefined">    flex: 1;</span></span><br><span class="line"><span class="undefined">    margin: 0 20/@r;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    ~ .mine-navbar-right &#123;  //新增代码</span></span><br><span class="line"><span class="undefined">      position: static;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  &amp;-right &#123;</span></span><br><span class="line"><span class="undefined">    position: absolute;   //新增代码</span></span><br><span class="line"><span class="undefined">    right: 0;</span></span><br><span class="line"><span class="undefined">    display: flex;    //用了绝对定位父元素的flex就会失效，所以要搞这个</span></span><br><span class="line"><span class="undefined">    justify-content: center;</span></span><br><span class="line"><span class="undefined">    align-items: center;</span></span><br><span class="line"><span class="undefined">    height: 100%;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    margin-right: 20/@r;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  &amp;-title &#123;</span></span><br><span class="line"><span class="undefined">    position: absolute;</span></span><br><span class="line"><span class="undefined">    left: 20%;</span></span><br><span class="line"><span class="undefined">    right: 20%;</span></span><br><span class="line"><span class="undefined">    text-align: center;</span></span><br><span class="line"><span class="undefined">    display: flex;</span></span><br><span class="line"><span class="undefined">    align-items: center;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  &amp;-text &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.ellipsis</span>();</span></span><br><span class="line"><span class="undefined">    font-size: 18px;</span></span><br><span class="line"><span class="undefined">    width: 100%;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">line-height</span>: 1<span class="selector-class">.5</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>使用插槽</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 差点忘记了，这里不能用:title.加：后面调用的就是表达式了 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">me-navbar</span> <span class="attr">title</span>=<span class="string">"哈哈哈"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont"</span> <span class="attr">slot</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"iconfont"</span> <span class="attr">slot</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">me-navbar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MeNavbar <span class="keyword">from</span> <span class="string">'navbar.vue'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> defult &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'homeHeader'</span>,</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    MeNavbar</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="props-接收效验"><a href="#props-接收效验" class="headerlink" title="props 接收效验"></a>props 接收效验</h3><p>不过我觉得把，我自己写好像没必要效验，又不是团队开发，就算是团队开发，这个东西不给别人用就没必要效验？估计是我现在还没有接触到，所以还是写一下吧，逼格？嗯，目前为止<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  direction: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">'horizontal'</span>,</span><br><span class="line">    validator (value) &#123; <span class="comment">// value就可以接收到传入的参数</span></span><br><span class="line">      <span class="comment">// 如果返回true代表成功效验，flase失败</span></span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">      <span class="string">'horizontal'</span>,</span><br><span class="line">      <span class="string">'vertical'</span></span><br><span class="line">      ].includes(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;移动webapp开发&quot;&gt;&lt;a href=&quot;#移动webapp开发&quot; class=&quot;headerlink&quot; title=&quot;移动webapp开发&quot;&gt;&lt;/a&gt;移动webapp开发&lt;/h1&gt;
    
    </summary>
    
      <category term="移动开发" scheme="demoorbug.github.io/categories/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="html5" scheme="demoorbug.github.io/tags/html5/"/>
    
      <category term="css3" scheme="demoorbug.github.io/tags/css3/"/>
    
  </entry>
  
  <entry>
    <title>开发中的技巧及问题</title>
    <link href="demoorbug.github.io/2019/03/22/%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E6%8A%80%E5%B7%A7%E5%8F%8A%E9%97%AE%E9%A2%98/"/>
    <id>demoorbug.github.io/2019/03/22/开发中的技巧及问题/</id>
    <published>2019-03-22T23:57:31.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="开发网站记录"><a href="#开发网站记录" class="headerlink" title="开发网站记录"></a>开发网站记录</h1><a id="more"></a><p>若时光往复，我仍爱你如初</p><p>#组件化开发<br>css不换行<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="下拉菜单的方式有3种"><a href="#下拉菜单的方式有3种" class="headerlink" title="下拉菜单的方式有3种"></a>下拉菜单的方式有3种</h2><p>第一种是用js改变添加css，这样导致页面的回流，和重绘问题，性能低下</p><p>第二种是用js添加class类来完成操作，相对来说不错，</p><p>第三种是最优的，就是用<code>:hover</code> 伪类来解决，不过<code>IE6</code>不支持</p><h1 id="分离下拉菜单，组件化开发"><a href="#分离下拉菜单，组件化开发" class="headerlink" title="分离下拉菜单，组件化开发"></a>分离下拉菜单，组件化开发</h1><p>这种组件化开发思想确实很不错，可以节省很多代码结构，把类似的结构提出来，弄一个公共的样式<br>老师将的思路很清晰<br><a href="https://github.com/DemoorBug/lx/blob/master/组件化开发/站点导航/dropdown.html" target="_blank" rel="noopener">本节代码</a></p><p>可复用<code>html</code><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dropdown menu"</span> <span class="attr">data-dropdown</span>=<span class="string">"menu"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle link"</span>&gt;</span></span><br><span class="line">    我的慕陶<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"dropdown-arrow"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-layer dropdown-left"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>复用<code>css</code><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dropdown</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-toggle</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-arrow</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-layer</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-left</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dropdown-right</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>封装可服用<code>javascript</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dropdown</span>(<span class="params">elem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $elem = $(elem)</span><br><span class="line">    $elem.hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>)</span><br><span class="line">      $<span class="keyword">this</span>.addClass($<span class="keyword">this</span>.data(<span class="string">'dropdown'</span>)+<span class="string">'-active'</span>);</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>)</span><br><span class="line">      $<span class="keyword">this</span>.removeClass($<span class="keyword">this</span>.data(<span class="string">'dropdown'</span>)+<span class="string">'-active'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.extend(&#123;</span><br><span class="line">    dropdown: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        dropdown(<span class="keyword">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)(jQuery);</span><br><span class="line"></span><br><span class="line">$(<span class="string">'.dropdown'</span>).dropdown()</span><br></pre></td></tr></table></figure></p><h1 id="下拉图标问题"><a href="#下拉图标问题" class="headerlink" title="下拉图标问题"></a>下拉图标问题</h1><p>用图片的方式至少会增加1次http请求</p><p>第二种方式就是把图片转化为<code>base64</code>，<code>IE6-7</code>不支持,编码后比原图大，不能缓存</p><p>纯<code>CSS</code>箭头，兼容<code>IE6</code><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">arrow-down</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#535b62</span>;</span><br><span class="line">  <span class="attribute">border-left-color</span>: transform;</span><br><span class="line">  <span class="attribute">border-left-color</span>: transform;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>不过呢，<code>IE6</code> 不兼容<code>transform</code><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">arrow-down</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#535b62</span>;</span><br><span class="line">  <span class="attribute">border-right-color</span>: transform;</span><br><span class="line">  <span class="attribute">_border-right-color</span>: <span class="number">#fff</span>; <span class="comment">/* 兼容IE6写法。_只有IE6会识别 */</span></span><br><span class="line">  <span class="attribute">border-left-color</span>: transform;</span><br><span class="line">  <span class="attribute">_border-left-color</span>: <span class="number">#fff</span>; <span class="comment">/* 兼容IE6写法。_只有IE6会识别 */</span></span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="用字体图标的技巧"><a href="#用字体图标的技巧" class="headerlink" title="用字体图标的技巧"></a>用字体图标的技巧</h2><p>因为是字体的问题，所以会继承父级的<code>line-height</code>所以我们把字体图片的，<code>line-height: 1</code>就可以解决这个问题，还用旋转图标的样式因为是<code>css3</code>的原因，所以直接用<code>css3</code>的查找方式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[class*='-active']</span> <span class="selector-class">.dropdown-arrow</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(180deg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动画呢，我基本都是单独写，因为感觉<code>all</code>老师说不高效，不过写一个利于以后的修改<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.transition</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all .<span class="number">3s</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="隐藏和显示"><a href="#隐藏和显示" class="headerlink" title="隐藏和显示"></a>隐藏和显示</h1><p><a href="">本节代码</a><br><code>trigger()</code>这个jquery方法居然还可以传递事件，我服了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.box'</span>).trigger(<span class="string">'hide'</span>);</span><br></pre></td></tr></table></figure></p><p>给那个元素绑定的就监听那个元素<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.box'</span>).on(<span class="string">'hide'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.type)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><code>is()</code> 这个返回true，或者false<br><code>:hidden</code> 匹配隐藏元素<br><code>:visible</code> 匹配显示元素<br>初始化(防止多次点击),老师不知道为什么还给hidden添加data，我觉得没必要，难道不监听事件就不会绑定吗？应该不是，毕竟是链式调用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anim = &#123;</span><br><span class="line">  init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($elem.is(<span class="string">':hidden'</span>)) &#123;</span><br><span class="line">      $elem.data(<span class="string">'start'</span>, <span class="string">'hide'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $elem.data(<span class="string">'start'</span>, <span class="string">'show'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($elem.data(<span class="string">'start'</span>) === hide) <span class="keyword">return</span>;</span><br><span class="line">    $elem.data(<span class="string">'start'</span>, <span class="string">'hide'</span>).trigger(<span class="string">'hide'</span>);</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过事件监听的方式实现回调函数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anim = &#123;</span><br><span class="line">  hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">    $elem.trigger(<span class="string">'hide'</span>); <span class="comment">//第一个事件</span></span><br><span class="line">    $elem.hide();</span><br><span class="line">    $elem.trigger(<span class="string">'hidden'</span>); <span class="comment">//隐藏完之后传递的事件</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">'.hide'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  anim.hide($(<span class="string">'.box'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">'.box'</span>).on(<span class="string">'hide hidden'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(e.type ==== <span class="string">'hide'</span>) &#123;</span><br><span class="line">    <span class="comment">//执行的第一个回调函数</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(e.type === <span class="string">'hidden'</span>) &#123;</span><br><span class="line">    <span class="comment">//执行的第二个回调函数</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="css3-隐藏和显示"><a href="#css3-隐藏和显示" class="headerlink" title="css3 隐藏和显示"></a>css3 隐藏和显示</h1><p><code>one()</code> 给匹配元素绑定一次事件<br><code>off()</code> 删除事件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//多次点击无效</span></span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'show'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'shown'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//触发事件show</span></span><br><span class="line">  $elem.data(<span class="string">'start'</span>, <span class="string">'show'</span>).trigger(<span class="string">'show'</span>)</span><br><span class="line">  <span class="comment">//开始隐藏</span></span><br><span class="line">  $elem.show()</span><br><span class="line">  <span class="comment">//css3的动画原理呢，就是给个延迟，不然就没有动画效果了</span></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $elem.removeClass(<span class="string">'fadeOut'</span>)</span><br><span class="line">  &#125;, <span class="number">20</span>)</span><br><span class="line">  <span class="comment">//监听transition 完成后触发该事件，抛出事件，外面就可以监听到，从而执行回调函数</span></span><br><span class="line">  $elem.off(<span class="string">'transitionend'</span>).one(<span class="string">'transitionend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $elem.data(<span class="string">'start'</span>, <span class="string">'shown'</span>).trigger(<span class="string">'shown'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p><p>隐藏略有不同<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'hide'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'hidden'</span>) <span class="keyword">return</span>;</span><br><span class="line">  $elem.data(<span class="string">'start'</span>, <span class="string">'hide'</span>).trigger(<span class="string">'hide'</span>)</span><br><span class="line">  <span class="comment">//因为是隐藏，所以先去掉class，执行css3动画</span></span><br><span class="line">  $elem.addClass(<span class="string">'fadeOut'</span>)</span><br><span class="line">  <span class="comment">//transition完成后，执行该事件，隐藏该元素</span></span><br><span class="line">  $elem.off(<span class="string">'transitionend'</span>).one(<span class="string">'transitionend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $elem.hide()</span><br><span class="line">    $elem.data(<span class="string">'start'</span>, <span class="string">'hidden'</span>).trigger(<span class="string">'hidden'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="老师还讲到了浏览器对transitionend各浏览器的各种写法，以及兼容"><a href="#老师还讲到了浏览器对transitionend各浏览器的各种写法，以及兼容" class="headerlink" title="老师还讲到了浏览器对transitionend各浏览器的各种写法，以及兼容"></a>老师还讲到了浏览器对<code>transitionend</code>各浏览器的各种写法，以及兼容</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//各大浏览器的兼容，firefox和chrome一样</span></span><br><span class="line">  <span class="keyword">var</span> transitionEndEventName = &#123;</span><br><span class="line">    transition: <span class="string">'transitionend'</span>,</span><br><span class="line">    MozTransition: <span class="string">'transitionend'</span>,</span><br><span class="line">    WebkitTransition: <span class="string">'webkitTransitionEnd'</span>,</span><br><span class="line">    OTransition: <span class="string">'oTransitionEnd otransitionend'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> transitionEnd = <span class="string">''</span>,</span><br><span class="line">      isSupport = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> transitionEndEventName) &#123;</span><br><span class="line">    <span class="comment">//不存在就返回undefined</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.body.style[name] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      transitionEnd = transitionEndEventName[name]</span><br><span class="line">      isSupport = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//如果全局存在window.mt就直接用，不存在则创建空对象</span></span><br><span class="line">  <span class="built_in">window</span>.mt = <span class="built_in">window</span>.mt || &#123;&#125;;</span><br><span class="line">  <span class="built_in">window</span>.mt.transiton = &#123;</span><br><span class="line">    end: transitionEnd,</span><br><span class="line">    isSupport: isSupport</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure><p>调用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.mt.transition.end);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.mt.transition.isSupport);</span><br></pre></td></tr></table></figure></p><h1 id="酷，下拉呀，淡入淡出，左右动画，全部都是通用的，直接修改css即可"><a href="#酷，下拉呀，淡入淡出，左右动画，全部都是通用的，直接修改css即可" class="headerlink" title="酷，下拉呀，淡入淡出，左右动画，全部都是通用的，直接修改css即可"></a>酷，下拉呀，淡入淡出，左右动画，全部都是通用的，直接修改css即可</h1><h1 id="js切换，封装的时候有一个技巧"><a href="#js切换，封装的时候有一个技巧" class="headerlink" title="js切换，封装的时候有一个技巧"></a>js切换，封装的时候有一个技巧</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$elem.stop().fadeIn(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//居然可以这么写。。。。</span></span><br><span class="line">$elem.stop()[<span class="string">'fadeIn'</span>](<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>#封装，taiquanle<br><code>proxy()</code> 这东西不但可以传参，还可以修改this指向，用处多多<br><code>extend()</code> 可以合并对象，还可以绑定jQuery方法<br>这里干货满满<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认配置</span></span><br><span class="line"><span class="keyword">var</span> defaults = &#123;</span><br><span class="line">  css3: <span class="literal">true</span>,</span><br><span class="line">  js: <span class="literal">true</span>,</span><br><span class="line">  animate: <span class="string">'fade'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showhide</span>(<span class="params">$elem, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mode = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">//传进来的参数和默认的对比，合并</span></span><br><span class="line">  options = $.extend(&#123;&#125;, defaults, options)</span><br><span class="line">  <span class="comment">//这里的transition.isSupport 是检测浏览器是否兼容css3，和js，transitionend的各浏览器兼容写法</span></span><br><span class="line">  <span class="keyword">if</span> (options.css3 &amp;&amp; transition.isSupport) &#123;</span><br><span class="line">    <span class="comment">//如果css3为true，而且浏览器兼容，就直接使用css3动画</span></span><br><span class="line">    mode = css3[options.animate]</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.js) &#123;</span><br><span class="line">    <span class="comment">//不兼容css3，或者css3为false，js为true就用js动画</span></span><br><span class="line">    mode = js[options.animate]</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//以上两种都不行，则执行基础隐藏显示，没有动画</span></span><br><span class="line">    mode = slide</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//初始化</span></span><br><span class="line">  mode.init($elem)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">//返回两个方法，给外界调用</span></span><br><span class="line">    show: $.proxy(mode.show, <span class="keyword">this</span>, $elem),</span><br><span class="line">    hide: $.proxy(mode.hide, <span class="keyword">this</span>, $elem)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>因为是自制行环境，所以还要将该方法暴露出去<br>普通暴露<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.mt = <span class="built_in">window</span>.mt || &#123;&#125;,</span><br><span class="line"><span class="built_in">window</span>.mt.showhide = showhide</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面的是调用形式</span></span><br><span class="line"><span class="keyword">var</span> showHide = <span class="built_in">window</span>.mt.showhide($box, &#123;</span><br><span class="line">  animate: <span class="string">'slideUpDown'</span></span><br><span class="line">&#125;)</span><br><span class="line">showHide.show($box)</span><br><span class="line">showHide.hide($box)</span><br></pre></td></tr></table></figure></p><p>jQuery暴露<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">  showHide: <span class="function"><span class="keyword">function</span> (<span class="params">option</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//mode 这个很巧妙，没用值就执行if里面的语句，赋值，第二次进入就没问题了，老师很爱用data，巧妙</span></span><br><span class="line">      <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">          mode = $(<span class="keyword">this</span>).data(<span class="string">'showHide'</span>);</span><br><span class="line">      <span class="keyword">if</span> (!mode) &#123;</span><br><span class="line">        <span class="comment">//判断参数是否为对象，因为接收参数不仅接受配置，还接收调用的方法</span></span><br><span class="line">        $<span class="keyword">this</span>.data(<span class="string">'showHide'</span>, mode = showhide($<span class="keyword">this</span>, <span class="keyword">typeof</span> option === <span class="string">'object'</span> &amp;&amp; option))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//传进来的参数和showhide暴露的方法对比，如果不是暴露的方法就退出，是的话就执行</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> mode[option] === <span class="string">'function'</span>) &#123;</span><br><span class="line">        mode[option]();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h1 id="用构造函数的方式重写dropdown"><a href="#用构造函数的方式重写dropdown" class="headerlink" title="用构造函数的方式重写dropdown"></a>用构造函数的方式重写dropdown</h1><p>为什么不这样写的原因<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dropdown</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.show = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.hide =<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//每次实例化，都会在堆内存中开辟空间，来存放函数本体</span></span><br><span class="line"><span class="keyword">var</span> dropdown = <span class="keyword">new</span> Dropdown();</span><br><span class="line"><span class="keyword">var</span> dropdown2 = <span class="keyword">new</span> Dropdown();</span><br><span class="line"><span class="keyword">var</span> dropdown3 = <span class="keyword">new</span> Dropdown();</span><br></pre></td></tr></table></figure></p><p>解决this指针的几种办法<br>1: <code>$.proxy()</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$elem.hover($.proxy(<span class="keyword">this</span>.show, <span class="keyword">this</span>), $.proxy(<span class="keyword">this</span>.hide, <span class="keyword">this</span>))</span><br></pre></td></tr></table></figure></p><p>2: 定义_this<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line"><span class="keyword">this</span>.$elem.hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  _this.show()</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  _this.hide()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>3: ES6 Module<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$elem.hover(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="keyword">this</span>.show()&#125;, () =&gt; &#123;<span class="keyword">this</span>.hide()&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h1><p>是从匹配元素的DOM结构向上冒泡<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-cn"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="单例化"><a href="#单例化" class="headerlink" title="单例化"></a>单例化</h1><p>抛出一个方法，执行的时候每次都会创建该实例，浪费内存，所以单例化<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">  dropdown: <span class="function"><span class="keyword">function</span>(<span class="params">option</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//单例化，就是给该DOM元素绑定data属性，一旦赋值，就不会继续创建</span></span><br><span class="line">      <span class="keyword">var</span> dropdown = $(<span class="keyword">this</span>).data(<span class="string">'dropdown'</span>),</span><br><span class="line">        options = $.extend(&#123;&#125;, Dropdown.DEFAULTS, <span class="keyword">typeof</span> option === <span class="string">'object'</span> &amp;&amp; option);</span><br><span class="line">      <span class="comment">//判断是否data赋值</span></span><br><span class="line">      <span class="keyword">if</span> (!dropdown) &#123;</span><br><span class="line">        <span class="comment">//这里面写法还真是省位置。</span></span><br><span class="line">        $(<span class="keyword">this</span>).data(<span class="string">'dropdown'</span>, dropdown = <span class="keyword">new</span> Dropdown(<span class="keyword">this</span>, options))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//判断是否为方法，有可能使用组件的人，传进来一个别的值，不是我们要抛出的事件，那就会返回undefined</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> dropdown[option] === <span class="string">'function'</span>) &#123;</span><br><span class="line">        dropdown[option]()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="动画条算是完成了，很nice，很全面，很完美，总结一下"><a href="#动画条算是完成了，很nice，很全面，很完美，总结一下" class="headerlink" title="动画条算是完成了，很nice，很全面，很完美，总结一下"></a>动画条算是完成了，很nice，很全面，很完美，总结一下</h1><h2 id="transition-js-解决兼容问题"><a href="#transition-js-解决兼容问题" class="headerlink" title="transition.js 解决兼容问题"></a><code>transition.js</code> 解决兼容问题</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> transitionEndEventName = &#123;</span><br><span class="line">    transition: <span class="string">'transitionend'</span>,</span><br><span class="line">    MozTransition: <span class="string">'transitionend'</span>,</span><br><span class="line">    WebkitTransition: <span class="string">'webkitTransitionEnd'</span>,</span><br><span class="line">    OTransition: <span class="string">'oTransitionEnd otransitionend'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> transitionEnd = <span class="string">''</span>,</span><br><span class="line">      isSupport = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> transitionEndEventName) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.body.style[name] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      transitionEnd = transitionEndEventName[name]</span><br><span class="line">      isSupport = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.mt = <span class="built_in">window</span>.mt || &#123;&#125;;</span><br><span class="line">  <span class="built_in">window</span>.mt.transiton = &#123;</span><br><span class="line">    end: transitionEnd,</span><br><span class="line">    isSupport: isSupport</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure><p>抛出了两个方法，<code>mt.transition.end</code> 为判断各浏览器之间<code>transitionend</code>的兼容问题<br><code>mt.transition.isSupport</code> 判断浏览器是否支持CSS3属性，不支持返回false</p><h2 id="index-js-动画逻辑"><a href="#index-js-动画逻辑" class="headerlink" title="index.js 动画逻辑"></a><code>index.js</code> 动画逻辑</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> transition = <span class="built_in">window</span>.mt.transiton</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">$elem, hiddenCallback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($elem.is(<span class="string">':hidden'</span>)) &#123;</span><br><span class="line">    $elem.data(<span class="string">'start'</span>, <span class="string">'hidden'</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> hiddenCallback === <span class="string">'function'</span>) &#123;</span><br><span class="line">      hiddenCallback();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $elem.data(<span class="string">'start'</span>, <span class="string">'shown'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">$elem, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'show'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'shown'</span>) <span class="keyword">return</span>;</span><br><span class="line">  $elem.data(<span class="string">'start'</span>, <span class="string">'show'</span>).trigger(<span class="string">'show'</span>)</span><br><span class="line">  callback()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hide</span>(<span class="params">$elem, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'hide'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> ($elem.data(<span class="string">'start'</span>) === <span class="string">'hidden'</span>) <span class="keyword">return</span>;</span><br><span class="line">  $elem.data(<span class="string">'start'</span>, <span class="string">'hide'</span>).trigger(<span class="string">'hide'</span>)</span><br><span class="line">  callback()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> slide = &#123;</span><br><span class="line">  init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($elem.is(<span class="string">':hidden'</span>)) &#123;</span><br><span class="line">      $elem.data(<span class="string">'start'</span>, <span class="string">'hide'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $elem.data(<span class="string">'start'</span>, <span class="string">'show'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">    show($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.show()</span><br><span class="line">      $elem.trigger(<span class="string">'shown'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">    hide($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.hide()</span><br><span class="line">      $elem.trigger(<span class="string">'hidden'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> css3 = &#123;</span><br><span class="line">  _init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem, className</span>) </span>&#123;</span><br><span class="line">    $elem.addClass(<span class="string">'transition'</span>)</span><br><span class="line">    init($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.addClass(className)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  _show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem, className</span>) </span>&#123;</span><br><span class="line">    show($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.show()</span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.removeClass(className)</span><br><span class="line">      &#125;, <span class="number">20</span>)</span><br><span class="line">      $elem.off(transition.end).one(transition.end, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.data(<span class="string">'start'</span>, <span class="string">'shown'</span>).trigger(<span class="string">'shown'</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  _hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem, className</span>) </span>&#123;</span><br><span class="line">    hide($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.addClass(className)</span><br><span class="line">      $elem.off(transition.end).one(transition.end, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.hide()</span><br><span class="line">        $elem.data(<span class="string">'start'</span>, <span class="string">'hidden'</span>).trigger(<span class="string">'hidden'</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  fade: &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      css3._init($elem, <span class="string">'fadeOut'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      css3._show($elem, <span class="string">'fadeOut'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      css3._hide($elem, <span class="string">'fadeOut'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  slideUpDown: &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      $elem.height($elem.height())</span><br><span class="line">      css3._init($elem, <span class="string">'slideUpDown'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      css3._show($elem, <span class="string">'slideUpDown'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      css3._hide($elem, <span class="string">'slideUpDown'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> js = &#123;</span><br><span class="line">  _hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem, mode</span>) </span>&#123;</span><br><span class="line">    hide($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.stop()[mode](<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.data(<span class="string">'start'</span>, <span class="string">'hidden'</span>).trigger(<span class="string">'hidden'</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  _show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem, mode</span>) </span>&#123;</span><br><span class="line">    show($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.stop()[mode](<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.data(<span class="string">'start'</span>, <span class="string">'shown'</span>).trigger(<span class="string">'shown'</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  _customInit: <span class="function"><span class="keyword">function</span>(<span class="params">$elem, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> style = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> ops <span class="keyword">in</span> options) &#123;</span><br><span class="line">      style[ops] = $elem.css(ops);</span><br><span class="line">    &#125;</span><br><span class="line">    $elem.data(<span class="string">'style'</span>, style)</span><br><span class="line">    init($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $elem.css(options)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  fade: &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      init($elem)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      js._show($elem, <span class="string">'fadeIn'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      js._hide($elem, <span class="string">'fadeOut'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  slideUpDown: &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      init($elem)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      js._show($elem, <span class="string">'slideDown'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      js._hide($elem, <span class="string">'slideUp'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  slideRight: &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      js._customInit($elem, &#123;</span><br><span class="line">        <span class="string">'width'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'padding-left'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'padding-right'</span>: <span class="number">0</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      $elem.show()</span><br><span class="line">      show($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.stop().animate($elem.data(<span class="string">'style'</span>), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          $elem.data(<span class="string">'start'</span>, <span class="string">'shown'</span>).trigger(<span class="string">'shown'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params">$elem</span>) </span>&#123;</span><br><span class="line">      hide($elem, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $elem.stop().animate(&#123;</span><br><span class="line">          <span class="string">'width'</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">'padding-left'</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">'padding-right'</span>: <span class="number">0</span></span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          $elem.hide()</span><br><span class="line">          $elem.data(<span class="string">'start'</span>, <span class="string">'hidden'</span>).trigger(<span class="string">'hidden'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> defaults = &#123;</span><br><span class="line">  css3: <span class="literal">true</span>,</span><br><span class="line">  js: <span class="literal">true</span>,</span><br><span class="line">  animate: <span class="string">'slideUpDown'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我日了狗了，_这东西还得转译，不然后面语法全错<br>这里没什么好讲的，都很简单，通俗易懂。_约定俗成内部使用</p><p>上面是js和css3动画，这里就是判断浏览器使用哪种动画<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showhide</span>(<span class="params">$elem, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mode = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">//合并传进来的配置，和我们默认配置</span></span><br><span class="line">  options = $.extend(&#123;&#125;, defaults, options)</span><br><span class="line">  <span class="comment">//判断配置中是否开启css3, 如果开启判断浏览器是否兼容css3</span></span><br><span class="line">  <span class="keyword">if</span> (options.css3 &amp;&amp; transition.isSupport) &#123;</span><br><span class="line">    mode = css3[options.animate]</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.js) &#123; <span class="comment">//如果不兼容则查看配置是否开启js，如果开启则使用</span></span><br><span class="line">    mode = js[options.animate]</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">//最后的情况就是使用最简单的方式，没有动画</span></span><br><span class="line">    mode = slide</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//每个定义的属性都有一个自己的init初始化方法</span></span><br><span class="line">  mode.init($elem)</span><br><span class="line">  <span class="comment">//返回两个show，和hide方法，便于调用</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    show: $.proxy(mode.show, <span class="keyword">this</span>, $elem),</span><br><span class="line">    hide: $.proxy(mode.hide, <span class="keyword">this</span>, $elem)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>接下来就是把该方法暴露出去，供外部使用，因为上面的所有方法都是定义在自制行函数里面<br>jQuery方式暴露<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">  showHide: <span class="function"><span class="keyword">function</span>(<span class="params">option</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//因为有可能返回的是一个集合，所以这里使用each便利，很nice</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">        mode = $(<span class="keyword">this</span>).data(<span class="string">'showHide'</span>);</span><br><span class="line">      <span class="comment">//单例化，上面有讲</span></span><br><span class="line">      <span class="keyword">if</span> (!mode) &#123;</span><br><span class="line">        $<span class="keyword">this</span>.data(<span class="string">'showHide'</span>, mode = showhide($<span class="keyword">this</span>, <span class="keyword">typeof</span> option === <span class="string">'object'</span> &amp;&amp; option))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//抛出方法调用方式$('.dropdown').showHide(&#123;options&#125;)</span></span><br><span class="line">      <span class="comment">//抛出方法调用方式$('.dropdown').showHide('show')</span></span><br><span class="line">      <span class="comment">//抛出方法调用方式$('.dropdown').showHide('hide')</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> mode[option] === <span class="string">'function'</span>) &#123;</span><br><span class="line">        mode[option]();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>其他抛出方式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.mt = <span class="built_in">window</span>.mt || &#123;&#125;,</span><br><span class="line"><span class="built_in">window</span>.mt.showhide = showhide</span><br><span class="line"><span class="comment">// 调用方式 有几个就要调用几次，还是jQuery的方式方便</span></span><br><span class="line"><span class="keyword">var</span> showHide = <span class="built_in">window</span>.mt.showhide($box, &#123;</span><br><span class="line">animate: <span class="string">'slideUpDown'</span></span><br><span class="line">&#125;)</span><br><span class="line">showHide.show($box)</span><br><span class="line">showHide.hide($box)</span><br></pre></td></tr></table></figure></p><h1 id="anim-js-重写dropdown动画"><a href="#anim-js-重写dropdown动画" class="headerlink" title="anim.js 重写dropdown动画"></a><code>anim.js</code> 重写dropdown动画</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Dropdown</span>(<span class="params">elem, option</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.$elem = $(elem)</span><br><span class="line">    <span class="comment">//这里我本来写的$('.dropdown-layer') 直接获取所有了，自己还没找到。。</span></span><br><span class="line">    <span class="keyword">this</span>.$layer = <span class="keyword">this</span>.$elem.find(<span class="string">'.dropdown-layer'</span>)</span><br><span class="line">    <span class="comment">//这里的class我们自己写了，这里样式变通用了，而且也可以控制动画</span></span><br><span class="line">    <span class="keyword">this</span>.activeClass = option.active + <span class="string">'-active'</span></span><br><span class="line">    <span class="comment">//全局绑定option</span></span><br><span class="line">    <span class="keyword">this</span>.option = option</span><br><span class="line">    <span class="comment">//把很多代码放到初始化代码里面，我们称之为初始化，其实就是进来加载的代码，这下终于懂了</span></span><br><span class="line">    <span class="keyword">this</span>.init()</span><br><span class="line">  &#125;</span><br><span class="line">  Dropdown.prototype = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//因为是ES5的方式写代码，外面最好获取一下this，很方便</span></span><br><span class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">//这里就调用了`index.js` 初始化操作，顺带传参</span></span><br><span class="line">      <span class="keyword">this</span>.$layer.showHide(<span class="keyword">this</span>.option)</span><br><span class="line">      <span class="comment">//老师还配置了多个事件触发的方式</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.option.event === <span class="string">'click'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.$elem.on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">          <span class="comment">//这里是我自己拓展的，就是展开一个标签后，关闭另一个标签</span></span><br><span class="line">          <span class="comment">//以前是查错了，就说怎么老是不对，查父元素肯定是显示的呀。。</span></span><br><span class="line">          <span class="comment">//_this.$elem.siblings().is(':visible') 。。错误的写法</span></span><br><span class="line">          _this.$allelem = _this.$elem.siblings().find(<span class="string">'.dropdown-layer:visible'</span>)</span><br><span class="line">          <span class="keyword">if</span> (_this.$allelem) &#123;</span><br><span class="line">            <span class="comment">//哈哈哈，很不错，这个呢就是根据打开元素关闭标签</span></span><br><span class="line">            _this.Allhide()</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//这里click，的点击判断，如果显示了再点击就是隐藏，老师没写，我加的，还行把</span></span><br><span class="line">          <span class="keyword">if</span> (_this.$layer.is(<span class="string">':hidden'</span>)) &#123;</span><br><span class="line">            <span class="comment">//吓我一跳，这里是调用的自己的show，我就说吗</span></span><br><span class="line">            _this.show();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            _this.hide();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//阻止冒泡，不然会触发document的click事件</span></span><br><span class="line">          e.stopPropagation();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//别的地方点击隐藏元素</span></span><br><span class="line">        $(<span class="built_in">document</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          _this.hide()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//hover 方式的动画</span></span><br><span class="line">        <span class="comment">//这里的$.proxy() 这给东西不但可以改变this指向，还可以传参(第三个参数)</span></span><br><span class="line">        <span class="keyword">this</span>.$elem.hover($.proxy(<span class="keyword">this</span>.show, <span class="keyword">this</span>), $.proxy(<span class="keyword">this</span>.hide, <span class="keyword">this</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">//老师加了给延迟，duowan用的就是这个方法，还要17173， 不知道谁炒谁的</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.option.delay) &#123;</span><br><span class="line">        <span class="keyword">this</span>.time = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          _this.$elem.addClass(_this.activeClass);</span><br><span class="line">          _this.$layer.showHide(<span class="string">'show'</span>)</span><br><span class="line">        &#125;, <span class="keyword">this</span>.option.delay)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//添加class</span></span><br><span class="line">        <span class="keyword">this</span>.$elem.addClass(<span class="keyword">this</span>.activeClass);</span><br><span class="line">        <span class="comment">//这里也是调用的`index.js`抛出的方法</span></span><br><span class="line">        <span class="keyword">this</span>.$layer.showHide(<span class="string">'show'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.option.delay) &#123;</span><br><span class="line">        clearTimeout(<span class="keyword">this</span>.time)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//和show一个原理</span></span><br><span class="line">      <span class="keyword">this</span>.$elem.removeClass(<span class="keyword">this</span>.activeClass);</span><br><span class="line">      <span class="keyword">this</span>.$layer.showHide(<span class="string">'hide'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    Allhide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//写click事件多出来的方法</span></span><br><span class="line">      <span class="keyword">this</span>.$elem.siblings().removeClass(<span class="keyword">this</span>.activeClass);</span><br><span class="line">      <span class="keyword">this</span>.$allelem.showHide(<span class="string">'hide'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//function 就是对象，所以可以这么写</span></span><br><span class="line">  Dropdown.DEFAULTS = &#123;</span><br><span class="line">    event: <span class="string">'hover'</span>,</span><br><span class="line">    css3: <span class="literal">true</span>,</span><br><span class="line">    js: <span class="literal">true</span>,</span><br><span class="line">    animate: <span class="string">'slideUpDown'</span>,</span><br><span class="line">    active: <span class="string">'menu'</span>,</span><br><span class="line">    delay: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// window.mt.Dropdown = Dropdown</span></span><br><span class="line">  $.fn.extend(&#123;</span><br><span class="line">    dropdown: <span class="function"><span class="keyword">function</span>(<span class="params">option</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> dropdown = $(<span class="keyword">this</span>).data(<span class="string">'dropdown'</span>),</span><br><span class="line">          options = $.extend(&#123;&#125;, Dropdown.DEFAULTS, <span class="keyword">typeof</span> option === <span class="string">'object'</span> &amp;&amp; option);</span><br><span class="line">        <span class="comment">//单例化</span></span><br><span class="line">        <span class="keyword">if</span> (!dropdown) &#123;</span><br><span class="line">          <span class="comment">//这里不但给dropdown重置值，还给data-dropdown设置值，巧妙。</span></span><br><span class="line">          $(<span class="keyword">this</span>).data(<span class="string">'dropdown'</span>, dropdown = <span class="keyword">new</span> Dropdown(<span class="keyword">this</span>, options))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//传入字符串这里处理，如果是暴露的方法就执行相应逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> dropdown[option] === <span class="string">'function'</span>) &#123;</span><br><span class="line">          dropdown[option]()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)(jQuery)</span><br></pre></td></tr></table></figure><h2 id="接下来就是调用了"><a href="#接下来就是调用了" class="headerlink" title="接下来就是调用了"></a>接下来就是调用了</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.dropdown'</span>).dropdown(&#123;  <span class="comment">//anim.js暴露出来的方法没有使用，这里就仅仅只是传参</span></span><br><span class="line">  animate: <span class="string">'fade'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里通过我们index.js中抛出的事件，达到我们执行回调的方法，老师还在`anim.js`中接收，</span></span><br><span class="line"><span class="comment">//然后抛给`.dropdown`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//简单写一下，如果遇到问题，可以加到`anim.js`的init初始化方法中</span></span><br><span class="line"><span class="comment">//this.$layer.on('show shown hide hidden', function(e) &#123;</span></span><br><span class="line"><span class="comment">//  _this.$elem.trigger(e.type)</span></span><br><span class="line"><span class="comment">//&#125;)</span></span><br><span class="line"><span class="comment">//我觉得吧，可以写，但没必要，让代码更复杂了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//按需加载</span></span><br><span class="line">$(<span class="string">'.dropdown-layer'</span>).on(<span class="string">'show'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> html =<span class="string">''</span>,</span><br><span class="line">      $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">      load = $(<span class="keyword">this</span>).data(<span class="string">'load'</span>)</span><br><span class="line">  <span class="comment">//判断`data-load`是否有值，没有则直接返回，不是我们按需加载的对象</span></span><br><span class="line">  <span class="keyword">if</span> (!load) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">//判断是否有`data-loader` 有就表示获取过值了，不执行该方法</span></span><br><span class="line">  <span class="keyword">if</span> (!$(<span class="keyword">this</span>).data(<span class="string">'loader'</span>)) &#123;</span><br><span class="line">    <span class="comment">//异步操作，但是天猫不是用的异步。直接加载了给js文件，不清楚</span></span><br><span class="line">    $.getJSON(<span class="string">'test/'</span>+load, <span class="function"><span class="keyword">function</span>(<span class="params">json, textStatus</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//通过json结构便利赋值</span></span><br><span class="line">      $.each(json, <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//html模板</span></span><br><span class="line">        html += <span class="string">`&lt;li&gt;&lt;a href="###" target="_blank" class="menu-item"&gt;<span class="subst">$&#123;json[index].title&#125;</span>&lt;/a&gt;&lt;/li&gt;`</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//赋值</span></span><br><span class="line">      $<span class="keyword">this</span>.html(html)</span><br><span class="line">      <span class="comment">// 添加`data-loader`状态，防止多次获取</span></span><br><span class="line">      $<span class="keyword">this</span>.data(<span class="string">'loader'</span>, <span class="literal">true</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>html 结构<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"menu nav-site-service dropdown fl"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"###"</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle link transition"</span>&gt;</span>联系客服<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"dropdown-arrow iconfont transition"</span>&gt;</span>&amp;#xe798;<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-layer dropdown-right"</span> <span class="attr">data-load</span>=<span class="string">"dropdown.json"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;li&gt;&lt;a href="###" target="_blank" class="menu-item"&gt;买家客服&lt;/a&gt;&lt;/li&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;li&gt;&lt;a href="###" target="_blank" class="menu-item"&gt;卖家客服&lt;/a&gt;&lt;/li&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="搜索功能组件化"><a href="#搜索功能组件化" class="headerlink" title="搜索功能组件化"></a>搜索功能组件化</h1><p><code>trim()</code> 这是js原生的，去除字符串两边的空白</p><h1 id="搜索框自动完成"><a href="#搜索框自动完成" class="headerlink" title="搜索框自动完成"></a>搜索框自动完成</h1><p><code>onkeyup</code>事件 keyup 兼容好，但是必须做一些约束，比如鼠标粘贴复制不会触发，键盘的一些上下键还可以触发</p><p><code>oninput</code>事件 不兼容IE6,7,8,但是好用。。。</p><p>异步的方式就是为了避免回调<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//回调</span></span><br><span class="line">$inputbox.on(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    <span class="comment">//这里的接口是请求，淘宝的数据，因为我们没数据</span></span><br><span class="line">    url: <span class="string">"https://suggest.taobao.com/sug?code=utf-8&amp;q="</span>+$inputbox.val()+<span class="string">"&amp;_ksTS=1553601277970_353&amp;callback=jsonp354&amp;k=1&amp;area=c2c&amp;bucketid=12"</span>,</span><br><span class="line">    dataType: <span class="string">"jsonp"</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//异步</span></span><br><span class="line">$inputbox.on(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = <span class="string">"https://suggest.taobao.com/sug?code=utf-8&amp;q="</span>+$inputbox.val()+<span class="string">"&amp;_ksTS=1553601277970_353&amp;callback=jsonp354&amp;k=1&amp;area=c2c&amp;bucketid=12"</span>;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    <span class="comment">//这里的接口是请求，淘宝的数据，因为我们没数据</span></span><br><span class="line">    url: url,</span><br><span class="line">    timeout: <span class="number">1</span>, <span class="comment">//超时</span></span><br><span class="line">    dataType: <span class="string">"jsonp"</span>, <span class="comment">//跨域</span></span><br><span class="line">  &#125;).done(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;).fail(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;).always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Why'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>如果页面不是UTF8,是别的，输入内容提交就会出错乱码<br><code>encodeURIComponent()</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">"https://suggest.taobao.com/sug?code=utf-8&amp;_ksTS=1553601277970_353&amp;callback=jsonp354&amp;k=1&amp;area=c2c&amp;bucketid=12&amp;q="</span> + <span class="built_in">encodeURIComponent</span>($inputbox.val());</span><br></pre></td></tr></table></figure></p><p>正则去除文本中的<code>&lt;b&gt;</code>标签:<code>过&lt;b&gt;生日&lt;/b&gt;的&lt;b&gt;礼物&lt;/b&gt;</code>变成纯文本<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeHtmlTags</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/&lt;(?:[^&gt;'"]|"[^"]*"|'[^']*')*&gt;/g</span>, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="search-js-代码都写了注释，逻辑通了都很简单，EZ，接下来是改写下面的操作，应该是封装把"><a href="#search-js-代码都写了注释，逻辑通了都很简单，EZ，接下来是改写下面的操作，应该是封装把" class="headerlink" title="search.js 代码都写了注释，逻辑通了都很简单，EZ，接下来是改写下面的操作，应该是封装把"></a><code>search.js</code> 代码都写了注释，逻辑通了都很简单，EZ，接下来是改写下面的操作，应该是封装把</h2><p>搜索框完成，没有键盘上下键盘的绑定，其他功能齐全<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> $search = $(<span class="string">'.search'</span>),</span><br><span class="line">      $form = $search.find(<span class="string">'.search-form'</span>),</span><br><span class="line">      $inputbox = $search.find(<span class="string">'.search-inputbox'</span>),</span><br><span class="line">      $btn = $search.find(<span class="string">'.search-btn'</span>),</span><br><span class="line">      $layer = $search.find(<span class="string">'.search-layer'</span>);</span><br><span class="line">  <span class="comment">//验证操作</span></span><br><span class="line">  <span class="comment">// $btn.on('click', function () &#123;</span></span><br><span class="line">  <span class="comment">//   //判断是否输入为空，空则不提交</span></span><br><span class="line">  <span class="comment">//   if ($inputbox.val().trim() === '') &#123;</span></span><br><span class="line">  <span class="comment">//     return false</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//新的验证操作</span></span><br><span class="line">  <span class="comment">//比click好的地方就是可以监听layer下拉框，如果点击提交是空也不行</span></span><br><span class="line">  $form.on(<span class="string">'submit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($inputbox.val().trim() === <span class="string">''</span>) &#123;</span><br><span class="line">      <span class="comment">//这是我自己拓展的，仿天猫的，酷</span></span><br><span class="line">      $inputbox.addClass(<span class="string">'background-glint'</span>)</span><br><span class="line">      $inputbox.off(<span class="string">'animationend'</span>).one(<span class="string">'animationend'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $inputbox.removeClass(<span class="string">'background-glint'</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//获取焦点，显示下拉</span></span><br><span class="line">  $inputbox.on(<span class="string">'focus'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $layer.show()</span><br><span class="line">  &#125;).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//阻止冒泡，还可以这样？</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//document绑定click事件，点击全局就隐藏菜单，用blur 加延迟也可以实现</span></span><br><span class="line">  $(<span class="built_in">document</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $layer.hide()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//绑定input事件，内容改变就获取值，不兼容IE9 以下</span></span><br><span class="line">  $inputbox.on(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="string">"https://suggest.taobao.com/sug?code=utf-8&amp;_ksTS=1553601277970_353&amp;callback=jsonp354&amp;k=1&amp;area=c2c&amp;bucketid=12&amp;q="</span>+ <span class="built_in">encodeURIComponent</span>($inputbox.val());</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">      <span class="comment">//这里的接口是请求，淘宝的数据，因为我们没数据</span></span><br><span class="line">      url: url,</span><br><span class="line">      <span class="comment">// timeout: 1, //超时</span></span><br><span class="line">      dataType: <span class="string">"jsonp"</span>, <span class="comment">//跨域</span></span><br><span class="line">    &#125;).done(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//成功回调</span></span><br><span class="line">      <span class="keyword">var</span> html = <span class="string">''</span>,</span><br><span class="line">          dataNum = data.result.length,</span><br><span class="line">          numMax = <span class="number">9</span>; <span class="comment">//自定义显示条目</span></span><br><span class="line">      <span class="keyword">if</span> (dataNum === <span class="number">0</span>) &#123; <span class="comment">//没有数据就直接退出</span></span><br><span class="line">        $layer.hide().html(<span class="string">''</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; dataNum; i++) &#123; <span class="comment">//循环遍历数据</span></span><br><span class="line">        <span class="keyword">if</span> (numMax &lt;= i) &#123; <span class="comment">//自定义显示条目</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        html += <span class="string">'&lt;li class="search-layer-item text-ellipsis"&gt;'</span>+data.result[i][<span class="number">0</span>]+<span class="string">'&lt;/li&gt;'</span></span><br><span class="line">      &#125;</span><br><span class="line">      $layer.html(html).show() <span class="comment">//拼接的字符串显示到DOM元素上</span></span><br><span class="line">    &#125;).fail(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      $layer.hide().html(<span class="string">''</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;).always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Why'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//因为用的是事件委托，可以不用写到会到里面</span></span><br><span class="line">  $layer.on(<span class="string">'click'</span>, <span class="string">'li'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $inputbox.val(removeHtmlTags($(<span class="keyword">this</span>).html()));</span><br><span class="line">    $inputbox.parent().submit()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 这个呢就是清除字符串中的`&lt;b&gt;`标签</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeHtmlTags</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/&lt;(?:[^&gt;'"]|"[^"]*"|'[^']*')*&gt;/g</span>, <span class="string">''</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(jQuery)</span><br></pre></td></tr></table></figure></p><h2 id="search-fun-js-不封装还顺的很，封装了感觉好麻烦"><a href="#search-fun-js-不封装还顺的很，封装了感觉好麻烦" class="headerlink" title="search-fun.js 不封装还顺的很，封装了感觉好麻烦"></a><code>search-fun.js</code> 不封装还顺的很，封装了感觉好麻烦</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//数据缓存</span></span><br><span class="line">  <span class="keyword">var</span> cache = &#123;</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    addData: <span class="function"><span class="keyword">function</span> (<span class="params">key, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.data[key]) &#123;</span><br><span class="line">        <span class="keyword">this</span>.data[key] = data;</span><br><span class="line">        <span class="keyword">this</span>.count++</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    readData: <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.data[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteDataByKye: <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123; <span class="comment">//通过键删</span></span><br><span class="line">      <span class="keyword">delete</span> <span class="keyword">this</span>.data[key];</span><br><span class="line">      <span class="keyword">this</span>.count--;</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteDataByOrder: <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123; <span class="comment">//通过顺序删除</span></span><br><span class="line">      <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= num) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">this</span>.deleteDataByKye(p)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Search</span>(<span class="params">$elem, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line">    <span class="keyword">this</span>.$elem = $elem;</span><br><span class="line">    <span class="keyword">this</span>.$form = <span class="keyword">this</span>.$elem.find(<span class="string">'.search-form'</span>);</span><br><span class="line">    <span class="keyword">this</span>.$input = <span class="keyword">this</span>.$elem.find(<span class="string">'.search-inputbox'</span>);</span><br><span class="line">    <span class="comment">// this.btn = $elem.find('.search-btn')</span></span><br><span class="line">    <span class="keyword">this</span>.$layer = <span class="keyword">this</span>.$elem.find(<span class="string">'.search-layer'</span>);</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">//submit 也可以，click也可以</span></span><br><span class="line">    <span class="comment">// this.$form.on('submit', $.proxy(this.submit, this))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交验证</span></span><br><span class="line">    <span class="keyword">this</span>.$elem.on(<span class="string">'click'</span>, <span class="string">'.search-btn'</span>,$.proxy(<span class="keyword">this</span>.submit, <span class="keyword">this</span>))</span><br><span class="line">    <span class="comment">//用户配置是否开启自动完成，我的天啊，这下面都是这个自动完成的代码，不要这功能为什么不单独写一个提交验证。。。</span></span><br><span class="line">    <span class="keyword">if</span>(options.autocomplete) &#123;</span><br><span class="line">      <span class="keyword">this</span>.autocomplete()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Search.DEFAULTS = &#123;</span><br><span class="line">    autocomplete: <span class="literal">false</span>,</span><br><span class="line">    url: <span class="string">'https://suggest.taobao.com/sug?code=utf-8&amp;_ksTS=1553601277970_353&amp;callback=jsonp354&amp;k=1&amp;area=c2c&amp;bucketid=12&amp;q='</span>,</span><br><span class="line">    css3: <span class="literal">true</span>,</span><br><span class="line">    js: <span class="literal">true</span>,</span><br><span class="line">    animate: <span class="string">'fade'</span></span><br><span class="line">  &#125;</span><br><span class="line">  Search.prototype = &#123;</span><br><span class="line">    autocomplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> time = <span class="literal">null</span>,</span><br><span class="line">          _this = <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">this</span>.$input</span><br><span class="line">        .on(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">//减少服务器压力，vue那个老师很常用这个，不过自动完成就会有延迟，个人感觉</span></span><br><span class="line">          clearTimeout(time);</span><br><span class="line">          <span class="comment">//获取延迟</span></span><br><span class="line">          time = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            _this.getData();</span><br><span class="line">          &#125;, <span class="number">200</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">'focus'</span>, $.proxy(<span class="keyword">this</span>.showLayer, <span class="keyword">this</span>)) <span class="comment">//获取焦点显示</span></span><br><span class="line">        .on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//阻止事件冒泡</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//点击全局隐藏自动完成下拉菜单</span></span><br><span class="line">      $(<span class="built_in">document</span>).on(<span class="string">'click'</span>, $.proxy(<span class="keyword">this</span>.hideLayer, <span class="keyword">this</span>))</span><br><span class="line">      <span class="comment">//初始化动画方法`index.js` case/js目录下的文件</span></span><br><span class="line">      <span class="keyword">this</span>.$layer.showHide(<span class="keyword">this</span>.options)</span><br><span class="line">    &#125;,</span><br><span class="line">    submit: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">//getInputVal() 这个方法是处理字符串的，去除前后空白，因为两处用到，所以封装</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.gitInputVal() === <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="comment">//这是我自己拓展的，仿天猫的，酷</span></span><br><span class="line">        <span class="keyword">this</span>.$input.addClass(<span class="string">'background-glint'</span>)</span><br><span class="line">        <span class="keyword">this</span>.$input.off(<span class="string">'animationend'</span>).one(<span class="string">'animationend'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          _this.$input.removeClass(<span class="string">'background-glint'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//click事件才要手动提交，submit事件如果还是手动提交，会重复执行很多次</span></span><br><span class="line">      <span class="keyword">this</span>.$form.submit()</span><br><span class="line">    &#125;,</span><br><span class="line">    getData: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">//转码，页面不是utf8，输入东西提交会乱码</span></span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">encodeURIComponent</span>(<span class="keyword">this</span>.gitInputVal());</span><br><span class="line">      <span class="comment">//如果没有输入内容，则直接，不能这么写，不然我的默认样式就没了,解决了。</span></span><br><span class="line">      <span class="comment">// if (url === '') &#123;</span></span><br><span class="line">      <span class="comment">//   return _this.$elem.trigger('errEvent');</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//解决上面的问题</span></span><br><span class="line">      <span class="keyword">if</span> (url === <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> _this.$elem.trigger(<span class="string">'errEvent'</span>, [_this.$layer]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果读到缓存数据，直接返回不执行后面的了</span></span><br><span class="line">      <span class="keyword">if</span> (cache.readData(url)) &#123;</span><br><span class="line">        <span class="comment">//读取缓存，并返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.$elem.trigger(<span class="string">'successEvent'</span>, [cache.readData(url), _this.$layer]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果有新的请求，就会停止以前的请求，来直接完成新的。这个ajax的abort()以前好像都没听过。我服了</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.jqXHR) <span class="keyword">this</span>.jqXHR.abort()</span><br><span class="line">      <span class="keyword">this</span>.jqXHR = $.ajax(&#123;</span><br><span class="line">        <span class="comment">//这里的接口是请求，淘宝的数据，因为我们没数据</span></span><br><span class="line">        url: <span class="keyword">this</span>.options.url + url,</span><br><span class="line">        <span class="comment">// timeout: 1, //超时</span></span><br><span class="line">        dataType: <span class="string">"jsonp"</span>, <span class="comment">//跨域</span></span><br><span class="line">      &#125;).done(<span class="function"><span class="keyword">function</span> (<span class="params">data, $layer</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//数据缓存，添加缓存</span></span><br><span class="line">        cache.addData(url, data)</span><br><span class="line">        <span class="comment">//抛出成功事件，向外传输数据要用数组的形式</span></span><br><span class="line">        _this.$elem.trigger(<span class="string">'successEvent'</span>, [data, _this.$layer]);</span><br><span class="line">      &#125;).fail(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        _this.$elem.trigger(<span class="string">'errEvent'</span>, [_this.$layer]);</span><br><span class="line">      &#125;).always(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//这个回调时不管是成功还是失败都会执行，所以这时候清空这个方法，这里清空了，上面的判断呢？这个还有待研究</span></span><br><span class="line">        _this.jqXHR = <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    showLayer: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// if(this.$layer.children().length === 0) &#123; return</span></span><br><span class="line">      <span class="comment">//   console.log('s');</span></span><br><span class="line">      <span class="comment">// &#125;;</span></span><br><span class="line">      <span class="comment">// `index.js` 的显示动画</span></span><br><span class="line">      <span class="keyword">this</span>.$layer.showHide(<span class="string">'show'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    hideLayer: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// `index.js` 的隐藏动画</span></span><br><span class="line">      <span class="keyword">this</span>.$layer.showHide(<span class="string">'hide'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    gitInputVal: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 处理input输入的字符串的方法</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$input.val().trim()</span><br><span class="line">    &#125;,</span><br><span class="line">    setInput: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//处理下拉框点击后字符串转换的问题，有些字符串自带html标签，这里要通过正则删除</span></span><br><span class="line">      <span class="keyword">this</span>.$input.val(removeHtmlTags(val))</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">removeHtmlTags</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str.replace(<span class="regexp">/&lt;(?:[^&gt;'"]|"[^"]*"|'[^']*')*&gt;/g</span>, <span class="string">''</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.extend(&#123;</span><br><span class="line">    <span class="comment">//这里就多了个接收参数</span></span><br><span class="line">    search: <span class="function"><span class="keyword">function</span>(<span class="params">option, $layer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> search = $(<span class="keyword">this</span>).data(<span class="string">'search'</span>),</span><br><span class="line">          $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">          options = $.extend(&#123;&#125;, Search.DEFAULTS, <span class="keyword">typeof</span> option === <span class="string">'object'</span> &amp;&amp; option);</span><br><span class="line">        <span class="keyword">if</span> (!search) &#123;</span><br><span class="line">          $($<span class="keyword">this</span>).data(<span class="string">'search'</span>, search = <span class="keyword">new</span> Search($<span class="keyword">this</span>, options))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// var mode = new Dropdown(this, option)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> search[option] === <span class="string">'function'</span>) &#123;</span><br><span class="line">          search[option]($layer)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)(jQuery)</span><br></pre></td></tr></table></figure><p>调用代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = <span class="string">''</span>,</span><br><span class="line">    htmlload = $(<span class="string">'.search-layer'</span>).html();</span><br><span class="line">$(<span class="string">'.search'</span>).search(&#123; <span class="comment">//初始化</span></span><br><span class="line">  autocomplete: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line">  .on(<span class="string">'successEvent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e, data, $layer</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//这个方法是处理获取的数据，便利后返回html元素标签结构</span></span><br><span class="line">    html = createHeaderLyaer(data, $layer)</span><br><span class="line">    <span class="comment">//如果有值则显示html，</span></span><br><span class="line">    <span class="keyword">if</span> (html) &#123;</span><br><span class="line">      $layer.html(html)</span><br><span class="line">      $(<span class="keyword">this</span>).search(<span class="string">'showLayer'</span>, $layer)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $layer.html(<span class="string">''</span>)</span><br><span class="line">      $(<span class="keyword">this</span>).search(<span class="string">'hideLayer'</span>, $layer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .on(<span class="string">'click'</span>, <span class="string">'li'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//每个li绑定点击事件，点击的时候就会提交数据，不用a标签，我一直以为用的是a标签。。</span></span><br><span class="line">    <span class="comment">//这个方法主要做的是把点击后的元素内容放到input的val值上面，还用这用正则处理了内容</span></span><br><span class="line">    $(<span class="string">'.search'</span>).search(<span class="string">'setInput'</span>, $(<span class="keyword">this</span>).html())</span><br><span class="line">    <span class="comment">// $('.search-form').submit()</span></span><br><span class="line">    <span class="comment">//提交验证，这里是可以通过验证的，所以是一个提交操作</span></span><br><span class="line">    $(<span class="string">'.search'</span>).search(<span class="string">'submit'</span>)</span><br><span class="line">  &#125;).on(<span class="string">'errEvent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e, $layer</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//这个是手动抛出一个事件，主要是错误的时候抛出，确实，如果是错误抛出，我这里逻辑还有问题，我没有把他用作错误处理，应该再写一个事件来处理这个事情，以为他再ajax出错的时候也调用了，和我的逻辑想错，这个问题这里暂不做处理</span></span><br><span class="line">    $layer.html(htmlload)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createHeaderLyaer</span>(<span class="params">data, $layer</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//成功回调</span></span><br><span class="line">    <span class="keyword">var</span> html = <span class="string">''</span>,</span><br><span class="line">        dataNum = data.result.length,</span><br><span class="line">        numMax = <span class="number">9</span>; <span class="comment">//自定义显示条目</span></span><br><span class="line">    <span class="keyword">if</span> (dataNum === <span class="number">0</span>) &#123; <span class="comment">//没有数据就直接退出</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; dataNum; i++) &#123; <span class="comment">//循环遍历数据</span></span><br><span class="line">      <span class="keyword">if</span> (numMax &lt;= i) &#123; <span class="comment">//自定义显示条目</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      html += <span class="string">'&lt;li class="search-layer-item text-ellipsis"&gt;'</span>+data.result[i][<span class="number">0</span>]+<span class="string">'&lt;/li&gt;'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h1 id="手动完成购物车，我服了。。"><a href="#手动完成购物车，我服了。。" class="headerlink" title="手动完成购物车，我服了。。"></a>手动完成购物车，我服了。。</h1><p>完成了，用的是前面下拉的动画组件</p><h1 id="focus区域结构"><a href="#focus区域结构" class="headerlink" title="focus区域结构"></a>focus区域结构</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">category   左侧</span><br><span class="line">  a.category-title</span><br><span class="line">    i</span><br><span class="line">  ul.category-list</span><br><span class="line">    li.doropdown</span><br><span class="line">      div.dropdown-toggle</span><br><span class="line">        a.dropdown-link</span><br><span class="line">          i</span><br><span class="line">    div.dropdown-layer</span><br><span class="line">      dl.category-details.clearfix</span><br><span class="line">        dt.category-details-title</span><br><span class="line">          a.category-details-title-link</span><br><span class="line">        dd.category-details-item</span><br><span class="line">          a.link</span><br><span class="line">carousel   幻灯片</span><br><span class="line">focus-sidebar</span><br></pre></td></tr></table></figure><h2 id="focus-html结构"><a href="#focus-html结构" class="headerlink" title="focus html结构"></a>focus html结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">div.focus-sidebar.fr</span><br><span class="line">  div.focus-news</span><br><span class="line">    div.focus-news-head</span><br><span class="line">      h2.focus-news-title.fl</span><br><span class="line">      a.link.fr</span><br><span class="line">    div.focus-news-body</span><br><span class="line">      p.text-ellipsis</span><br><span class="line">        a.link</span><br><span class="line">          strong</span><br><span class="line">  div.focus-service</span><br><span class="line">  div.focus-ad</span><br></pre></td></tr></table></figure><h2 id="便捷服务"><a href="#便捷服务" class="headerlink" title="便捷服务"></a>便捷服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">div.focus-service</span><br><span class="line">  a.fl.focus-service-item</span><br><span class="line">    i.iconfont.focus-service-icon</span><br><span class="line">    span.focus-service-text</span><br></pre></td></tr></table></figure><h2 id="幻灯片页面结构"><a href="#幻灯片页面结构" class="headerlink" title="幻灯片页面结构"></a>幻灯片页面结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">div.slider</span><br><span class="line">  div.slider-container</span><br><span class="line">    div.slide-item</span><br><span class="line">      a</span><br><span class="line">        img</span><br><span class="line">  ol.slider-indicator-wrap</span><br><span class="line">    li.fl.slider-indicator</span><br><span class="line">  a.slider-control-left</span><br><span class="line">  a.slider-control-right</span><br></pre></td></tr></table></figure><h1 id="幻灯片这里用了给技巧，左右滑动"><a href="#幻灯片这里用了给技巧，左右滑动" class="headerlink" title="幻灯片这里用了给技巧，左右滑动"></a>幻灯片这里用了给技巧，左右滑动</h1><p>第一种滑动是很简单的：<br>比如向左滑动，切换的时候把下一张图片放置到-100%的位置，因为是瞬间的，人眼是看不到的，然后开始上一个元素向右运动，当前元素进入，造成一个从左边出来的假象，右滑动一个道理，没写的时候脑子还真像不过来。。。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始位置，去除transition是因为这里的动画必须是瞬间的，所以必须清楚</span></span><br><span class="line"><span class="keyword">this</span>.$items.eq(index).removeClass(<span class="keyword">this</span>.transitionClass).css(<span class="string">'left'</span>, <span class="number">-1</span> * direction * <span class="keyword">this</span>.itemWidth)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画开始，</span></span><br><span class="line"><span class="keyword">var</span> self = <span class="keyword">this</span></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  self.$items.eq(self.curIndex).move(<span class="string">'to'</span>, direction * self.itemWidth)</span><br><span class="line">  <span class="comment">//这里添加是因为我们仅清除了 index的动画，curIndex没有清楚动画</span></span><br><span class="line">  self.$items.eq(index).addClass(self.transitionClass).move(<span class="string">'to'</span>, <span class="number">0</span>)</span><br><span class="line">  <span class="comment">//如果写到外面会有bug</span></span><br><span class="line">  self.curIndex = index</span><br><span class="line">&#125;, <span class="number">20</span>)</span><br></pre></td></tr></table></figure></p><h2 id="mongoose"><a href="#mongoose" class="headerlink" title="mongoose"></a>mongoose</h2><p>命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show dbs // 所有数据库</span><br><span class="line">use imooc // 连接该库，没有则创建</span><br><span class="line">show tables // 查询该库的 表/集合 </span><br><span class="line"></span><br><span class="line">db // 当前所在数据库</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;开发网站记录&quot;&gt;&lt;a href=&quot;#开发网站记录&quot; class=&quot;headerlink&quot; title=&quot;开发网站记录&quot;&gt;&lt;/a&gt;开发网站记录&lt;/h1&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>重学jQuery API</title>
    <link href="demoorbug.github.io/2019/03/16/%E9%87%8D%E5%AD%A6jQuery/"/>
    <id>demoorbug.github.io/2019/03/16/重学jQuery/</id>
    <published>2019-03-16T22:51:33.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<p>本来看jQuery源码的，发现不是现阶段看的东西，最好还是把jquery api查看一下<br><a id="more"></a></p><h1 id="api开始看起"><a href="#api开始看起" class="headerlink" title="api开始看起"></a>api开始看起</h1><h1 id="add"><a href="#add" class="headerlink" title=".add()"></a>.add()</h1><p>将匹配元素添加到集合中<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.j'</span>).add(<span class="string">'.name'</span>).css(&#123;<span class="string">'background'</span>: <span class="string">'red'</span>&#125;) <span class="comment">//会给匹配到的.j .name都添加背景色</span></span><br></pre></td></tr></table></figure></p><h1 id="addBack"><a href="#addBack" class="headerlink" title=".addBack()"></a>.addBack()</h1><p>这个就是将前面匹配的元素组合到一起<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.j'</span>).find(<span class="string">'p'</span>).addBack().addClass(<span class="string">'background'</span>);<span class="comment">//给匹配到的P元素添加class，匹配到的.j class也添加class</span></span><br></pre></td></tr></table></figure></p><h1 id="addClass"><a href="#addClass" class="headerlink" title=".addClass()"></a>.addClass()</h1><p>顾名思义添加class<br>可以接收一个字符串，或者一个回调函数，<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.j'</span>).addClass(<span class="function"><span class="keyword">function</span> (<span class="params">index, currentClass</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'item-'</span> + index</span><br><span class="line"><span class="comment">//currentClass就是当前元素的Class，这里面的this代表元素本身，chrome只能看到元素，firefox可以看到元素的属性和方法，如果用ES6的箭头函数则this代表window对象</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="after"><a href="#after" class="headerlink" title=".after()"></a>.after()</h1><p>给匹配元素集合中插入参数所指定的内容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.inner'</span>).after(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;div&gt;'</span> + <span class="keyword">this</span>.className + <span class="string">'&lt;/div&gt;'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//可以接收一个函数，或者直接传参，有函数操作起来多样性this和上面一样</span></span><br></pre></td></tr></table></figure></p><h1 id="ajaxComplete"><a href="#ajaxComplete" class="headerlink" title=".ajaxComplete()"></a>.ajaxComplete()</h1><p>请求完成时注册一个回调函数，和start很像<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ajaxComplete(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'s'</span>)</span><br><span class="line">  $( <span class="string">".log"</span> ).text( <span class="string">"Triggered ajaxComplete handler."</span> );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="ajaxError"><a href="#ajaxError" class="headerlink" title=".ajaxError()"></a>.ajaxError()</h2><p>Ajax请求失败，触发该回调函数</p><h2 id="ajaxSend"><a href="#ajaxSend" class="headerlink" title=".ajaxSend()"></a>.ajaxSend()</h2><p>ajax发送请求前执行</p><h2 id="ajaxStart"><a href="#ajaxStart" class="headerlink" title=".ajaxStart()"></a>.ajaxStart()</h2><p>ajax发送刚开始执行</p><h2 id="ajaxStop"><a href="#ajaxStop" class="headerlink" title=".ajaxStop()"></a>.ajaxStop()</h2><p>ajax发送完成后执行</p><h1 id="append"><a href="#append" class="headerlink" title="append()"></a>append()</h1><p>和after() 好像啊，一样的？<br>匹配到的元素后添加</p><h2 id="appendTo"><a href="#appendTo" class="headerlink" title="appendTo"></a>appendTo</h2><p>匹配到的元素前</p><h1 id="attr"><a href="#attr" class="headerlink" title=".attr()"></a>.attr()</h1><p>获取匹配元素的属性或设置属性的值</p><h1 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h1><p>模板<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hom"</span> <span class="attr">wot</span>=<span class="string">"cn"</span>&gt;</span></span><br><span class="line">  use name</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hom"</span> <span class="attr">wot</span>=<span class="string">"cn n"</span>&gt;</span></span><br><span class="line">  use name</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hom"</span> <span class="attr">wot</span>=<span class="string">"cnnnbbb-n"</span>&gt;</span></span><br><span class="line">  use name</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hom"</span> <span class="attr">wot</span>=<span class="string">"cn-youcan"</span>&gt;</span></span><br><span class="line">  use name</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="name-value"><a href="#name-value" class="headerlink" title="[name|=value]"></a>[name|=value]</h2><p>可以匹配到上面<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'div[wot|=cn]'</span></span><br><span class="line"><span class="comment">//可以匹配到cn-开头的</span></span><br></pre></td></tr></table></figure></p><h2 id="name-value-1"><a href="#name-value-1" class="headerlink" title="[name*=value]"></a>[name*=value]</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只要是包含cn的，都可以匹配到</span></span><br></pre></td></tr></table></figure><h2 id="name-value-2"><a href="#name-value-2" class="headerlink" title="[name$=value]"></a>[name$=value]</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value结尾的</span><br></pre></td></tr></table></figure><h2 id="name-value-3"><a href="#name-value-3" class="headerlink" title="[name~=value]"></a>[name~=value]</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以空格间隔的</span><br><span class="line">cn n</span><br></pre></td></tr></table></figure><h2 id="name-value-4"><a href="#name-value-4" class="headerlink" title="[name=value]"></a>[name=value]</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绝对匹配</span><br></pre></td></tr></table></figure><h2 id="name-value-5"><a href="#name-value-5" class="headerlink" title="[name$=value]"></a>[name$=value]</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="tab-开发"><a href="#tab-开发" class="headerlink" title="tab 开发"></a>tab 开发</h1><h2 id="extend"><a href="#extend" class="headerlink" title="$.extend()"></a>$.extend()</h2><p>可以使用深度拷贝，但是本节用法好像就是普通合并？<br>直接=赋值好像也可以？</p><h2 id="parseJSON"><a href="#parseJSON" class="headerlink" title="$.parseJSON()"></a>$.parseJSON()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接收一个json字符串，返回解析后的javascript对象</span><br></pre></td></tr></table></figure><h2 id="siblings"><a href="#siblings" class="headerlink" title=".siblings()"></a>.siblings()</h2><p>匹配元素的其他同级元素</p><h2 id="trigger"><a href="#trigger" class="headerlink" title=".trigger()"></a>.trigger()</h2><p>手动触发事件</p><p>有个事件冒泡bug，是这个解决的<br><a href="https://www.imooc.com/qadetail/213077" target="_blank" rel="noopener">阻止事件冒泡</a></p><h1 id="防抖处理"><a href="#防抖处理" class="headerlink" title="防抖处理"></a>防抖处理</h1><h2 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h2><p><strong>向量： Vab = Pb -Pa</strong><br><strong>二维向量叉乘公式：</strong><br>a(x1, y1) <em> b(x2,y2) = x1</em>y2 - x2*y1</p><p><strong>用叉乘法判断点在三角形内</strong></p><p>学习视频：<a href="https://study.163.com/course/courseMain.htm?courseId=465001" target="_blank" rel="noopener">逐行分析jQuery</a><br>jQuery学习版本：2.0.3</p><h2 id="第一节"><a href="#第一节" class="headerlink" title="第一节"></a>第一节</h2><p>匿名函数自执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a  = <span class="number">10</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(a)</span><br><span class="line">  &#125;</span><br><span class="line">  windows.$ = $ <span class="comment">//暴露出去</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p><h2 id="js继承机制"><a href="#js继承机制" class="headerlink" title="js继承机制"></a>js继承机制</h2><p>用构造函数生成的实例对象，有一个缺点，那就是无法共享属性和方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">  <span class="keyword">this</span>.sg = <span class="string">'犬科'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Dog(<span class="string">'大毛'</span>)</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="keyword">new</span> Dog(<span class="string">'二毛'</span>)</span><br><span class="line">s2.sg = <span class="string">'猫科'</span></span><br><span class="line"><span class="built_in">console</span>.log(s) <span class="comment">//犬科</span></span><br><span class="line"><span class="comment">//犬科的方法无法继承</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line">  Dog.prototype = &#123;</span><br><span class="line">    sg = <span class="string">'猫科'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Dog(<span class="string">'大毛'</span>)</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="keyword">new</span> Dog(<span class="string">'二毛'</span>)</span><br><span class="line">s2.sg = <span class="string">'猫科'</span></span><br><span class="line"><span class="built_in">console</span>.log(s) <span class="comment">//猫科</span></span><br><span class="line"><span class="comment">//写在原型上的就会被继承</span></span><br><span class="line"><span class="comment">//s2实现了继承</span></span><br></pre></td></tr></table></figure><h2 id="第四节"><a href="#第四节" class="headerlink" title="第四节"></a>第四节</h2><p>匿名函数自执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure></p><p>之所以传入window有两个原因:</p><ol><li>可以提快window的查找速度</li><li>压缩代码后，有利于代码压缩如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(function(e)&#123;&#125;)(window)</span><br></pre></td></tr></table></figure></li></ol><p>接收的window会被替换为e</p><p>接收undefined<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(function (window, undefined) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)(window)</span><br></pre></td></tr></table></figure></p><p>接收一个形参，undefined，防止被外部修改<br>因为undefined非关键字，非保留字，所以低版本浏览器bug可以修改，IE8一下浏览器都有这个bug<br>一下是修改undefined例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="number">15</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line">  <span class="comment">// 如果a没有值则为a赋值.  但因为undefined被重写了，所以这句根本执行不到。</span></span><br><span class="line">  <span class="built_in">console</span>.log(a, <span class="literal">undefined</span>);</span><br><span class="line">  <span class="keyword">if</span> (a === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      a = <span class="string">'b'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><p>参考文章: <a href="https://blog.csdn.net/qjx3936888/article/details/83858467" target="_blank" rel="noopener">为什么要传入 undefined</a></p><h2 id="第五节"><a href="#第五节" class="headerlink" title="第五节"></a>第五节</h2><p>jQuery设计原理<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jQuery</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> jQuery.prototype.init()</span><br><span class="line">&#125;</span><br><span class="line">  jQuery.prototype = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      &#125;,</span><br><span class="line">    css: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'nice'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">jQuery.prototype.init.prototype = jQuery.prototype</span><br><span class="line">jQuery().css()</span><br></pre></td></tr></table></figure></p><h2 id="第七节"><a href="#第七节" class="headerlink" title="第七节"></a>第七节</h2><ol><li>为什么要把constructor重新指向的原因：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Arr() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Arr.prototype = &#123;</span><br><span class="line">  name = &apos;hhh&apos;</span><br><span class="line">&#125;</span><br><span class="line">var a1 = new Arr()</span><br><span class="line">console.log(a1.constructor) //Object()</span><br></pre></td></tr></table></figure><p>因为这样写会把prototype赋值一个新的对象<br>而这样写就不会<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function Arr () &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Arr.prototype.name = &apos;hhh&apos;</span><br><span class="line">var a1 = new Arr()</span><br><span class="line">console.log(a1.constructor) //Arr()</span><br></pre></td></tr></table></figure></p><p>这样写就不会改变constructor<br>不过对象的方式比较方便，常用所以改下成下面的写法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Arr() &#123;&#125;</span><br><span class="line">Arr.prototype = &#123;</span><br><span class="line">  constructor: Arr,</span><br><span class="line">  name: &apos;hhh&apos;</span><br><span class="line">&#125;</span><br><span class="line">var a1 = new Arr()</span><br><span class="line">console.log(a1.constructor) //Arr()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本来看jQuery源码的，发现不是现阶段看的东西，最好还是把jquery api查看一下&lt;br&gt;
    
    </summary>
    
    
      <category term="jQuery" scheme="demoorbug.github.io/tags/jQuery/"/>
    
  </entry>
  
  <entry>
    <title>webpack 4配置</title>
    <link href="demoorbug.github.io/2019/03/08/webpack-4%E9%85%8D%E7%BD%AE/"/>
    <id>demoorbug.github.io/2019/03/08/webpack-4配置/</id>
    <published>2019-03-08T22:45:23.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="webpack-配置"><a href="#webpack-配置" class="headerlink" title="webpack 配置"></a>webpack 配置</h1><a id="more"></a><h1 id="更新后的配置，目前再用的，以前的废弃了"><a href="#更新后的配置，目前再用的，以前的废弃了" class="headerlink" title="更新后的配置，目前再用的，以前的废弃了"></a>更新后的配置，目前再用的，以前的废弃了</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> devMode = process.env.NODE_ENV !== <span class="string">'production'</span></span><br><span class="line"><span class="comment">// const devMode = true</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/pages/index/index.js'</span>,</span><br><span class="line">    <span class="comment">// main: './src/pages/page1/main.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/pages/index/index.html'</span>,</span><br><span class="line">      filename: <span class="string">'index.html'</span>,</span><br><span class="line">      inject: <span class="literal">true</span>,</span><br><span class="line">      hash: <span class="literal">true</span>,</span><br><span class="line">      chunks: [<span class="string">'vendor'</span>,<span class="string">'common'</span>,<span class="string">'runtime'</span>,<span class="string">'index'</span>],</span><br><span class="line">      minify: process.env.NODE_ENV !== <span class="string">"production"</span> ? <span class="literal">false</span> : &#123;</span><br><span class="line">          removeComments: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// collapseWhitespace: true,</span></span><br><span class="line">          removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line"><span class="comment">/*    new HtmlWebpackPlugin(&#123;</span></span><br><span class="line"><span class="comment">      template: './src/pages/page1/main.html',</span></span><br><span class="line"><span class="comment">      filename: 'main.html',</span></span><br><span class="line"><span class="comment">      inject: true,</span></span><br><span class="line"><span class="comment">      hash: true,</span></span><br><span class="line"><span class="comment">      chunks: ['vendor','common','runtime','main'],</span></span><br><span class="line"><span class="comment">      minify: process.env.NODE_ENV !== "production" ? false : &#123;</span></span><br><span class="line"><span class="comment">          removeComments: true,</span></span><br><span class="line"><span class="comment">          // collapseWhitespace: true,</span></span><br><span class="line"><span class="comment">          removeAttributeQuotes: true,</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">    &#125;),*/</span></span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      $: <span class="string">'jquery'</span>,</span><br><span class="line">      jQuery: <span class="string">'jquery'</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: devMode ? <span class="string">'js/[name].[hash:8].js'</span>: <span class="string">'js/[name].[chunkhash:8].js'</span>,</span><br><span class="line">    chunkFilename: devMode ? <span class="string">'js/[name].[hash:8].js'</span>: <span class="string">'js/[name].[chunkhash:8].js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="comment">// '@': resolve('src'),</span></span><br><span class="line">      <span class="string">'@'</span>: path.resolve(__dirname, <span class="string">'../src/'</span>),</span><br><span class="line">      <span class="string">'~node'</span>: path.resolve(__dirname, <span class="string">'../node_modules/'</span>),</span><br><span class="line">      <span class="string">'~css'</span>: path.resolve(__dirname, <span class="string">'../src/css/'</span>),</span><br><span class="line">      <span class="comment">// 'common': resolve('src/common')</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    runtimeChunk: <span class="string">'single'</span>,</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">          vendor: &#123; <span class="comment">// 抽离第三方插件</span></span><br><span class="line">              test: <span class="regexp">/node_modules/</span>, <span class="comment">// 指定是node_modules下的第三方包</span></span><br><span class="line">              chunks: <span class="string">'initial'</span>,</span><br><span class="line">              name: <span class="string">'vendor'</span>, <span class="comment">// 打包后的文件名，任意命名</span></span><br><span class="line">              <span class="comment">// 设置优先级，防止和自定义的公共代码提取时被覆盖，不进行打包</span></span><br><span class="line">              priority: <span class="number">10</span></span><br><span class="line">          &#125;,</span><br><span class="line">          utils: &#123; <span class="comment">// 抽离自己写的公共代码，common这个名字可以随意起</span></span><br><span class="line">              chunks: <span class="string">'initial'</span>,</span><br><span class="line">              name: <span class="string">'common'</span>, <span class="comment">// 任意命名</span></span><br><span class="line">              minSize: <span class="number">0</span>, <span class="comment">// 只要超出0字节就生成一个新包</span></span><br><span class="line">              minChunks: <span class="number">2</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(less|css)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">//因为只有style-loader有热更新，所以这么写</span></span><br><span class="line">            loader: devMode ? <span class="string">'style-loader'</span> : MiniCssExtractPlugin.loader,</span><br><span class="line">            options: devMode ? &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">            &#125; : &#123;</span><br><span class="line">              publicPath: <span class="string">'../'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              ident: <span class="string">'postcss'</span>,</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              plugins: [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">'postcss-preset-env'</span>)()</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(gif|png|jpe?g|svg)$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            <span class="comment">// loader: 'file-loader',</span></span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span>,</span><br><span class="line">              name: <span class="string">'[name].img.[hash:5].[ext]'</span>,</span><br><span class="line">              outputPath: <span class="string">'img'</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"image-webpack-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              mozjpeg: &#123;</span><br><span class="line">                progressive: <span class="literal">true</span>,</span><br><span class="line">                quality: <span class="number">65</span></span><br><span class="line">              &#125;,</span><br><span class="line">              optipng: &#123;</span><br><span class="line">                enabled: <span class="literal">false</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              pngquant: &#123;</span><br><span class="line">                quality: <span class="string">'65-90'</span>,</span><br><span class="line">                speed: <span class="number">4</span></span><br><span class="line">              &#125;,</span><br><span class="line">              gifsicle: &#123;</span><br><span class="line">                interlaced: <span class="literal">false</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf|svg)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'file-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              name: <span class="string">'css/font/[name].font.[hash:6].[ext]'</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">//raw-loader是修改html更新页面，而且必须这么写，不然两个一起用会出现bug，如果只用raw-loader页面就没办法处理Img了</span></span><br><span class="line">            loader: <span class="string">'html-loader?config=raw-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              attrs: [<span class="string">'img:src'</span>, <span class="string">'img:data-src'</span>],</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//这里也是踩坑了，必须webpack这么写，然后.babelrc 才会被处理</span></span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="babelrc"><a href="#babelrc" class="headerlink" title=".babelrc"></a>.babelrc</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">  <span class="attr">"plugins"</span>: [[<span class="string">"@babel/plugin-transform-runtime"</span>, &#123; <span class="attr">"corejs"</span>: <span class="number">2</span> &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="webpack-dev-js-主要就是更新了路径把，因为目录全部迁移到build了"><a href="#webpack-dev-js-主要就是更新了路径把，因为目录全部迁移到build了" class="headerlink" title="webpack.dev.js 主要就是更新了路径把，因为目录全部迁移到build了"></a>webpack.dev.js 主要就是更新了路径把，因为目录全部迁移到build了</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: path.resolve(__dirname, <span class="string">'../src/pages/assets'</span>),</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// compress: true,</span></span><br><span class="line">    <span class="comment">// overlay: true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="webpack-prod-js"><a href="#webpack-prod-js" class="headerlink" title="webpack.prod.js"></a>webpack.prod.js</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="comment">// const UglifyJsPlugin = require("uglifyjs-webpack-plugin");</span></span><br><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">'terser-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="comment">// const Purifycss = require('purifycss-webpack')</span></span><br><span class="line"><span class="keyword">const</span> PurgecssPlugin = <span class="built_in">require</span>(<span class="string">'purgecss-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob-all'</span>)</span><br><span class="line"><span class="keyword">const</span> copyWebpackPlugin = <span class="built_in">require</span>(<span class="string">"copy-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PATHS = &#123;</span><br><span class="line">  src: path.join(__dirname, <span class="string">'../src'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="comment">//这个可以支持es6语法，不过用babel打包后也可以支持？，没测试，当时是babel没设置好，出现了一点bug</span></span><br><span class="line">      <span class="keyword">new</span> TerserPlugin(),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;&#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist/*'</span>],&#123;</span><br><span class="line">      root: path.resolve(__dirname, <span class="string">'../'</span>), <span class="comment">//根目录</span></span><br><span class="line">      verbose: <span class="literal">true</span>, <span class="comment">//开启在控制台输出信息</span></span><br><span class="line">      dry: <span class="literal">false</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">"css/[name].[contenthash:8].css"</span>,</span><br><span class="line">      chunkFilename: <span class="string">"css/[name].[contenthash:8].css"</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">//拷贝静态文件，这个其实还要再改的，我没弄，不过这个改起来很方便</span></span><br><span class="line">    <span class="keyword">new</span> copyWebpackPlugin([&#123;</span><br><span class="line">        <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">"../src/assets"</span>),</span><br><span class="line">        to: <span class="string">'./assets'</span>,</span><br><span class="line">        <span class="comment">// ignore: ['.*']</span></span><br><span class="line">    &#125;]),</span><br><span class="line">    <span class="keyword">new</span> copyWebpackPlugin([&#123;</span><br><span class="line">        <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">"../src/pages/assets"</span>),</span><br><span class="line">        to: <span class="string">'./'</span>,</span><br><span class="line">        ignore: [<span class="string">'.*'</span>]</span><br><span class="line">    &#125;]),</span><br><span class="line">    <span class="comment">// new Purifycss(&#123;</span></span><br><span class="line">    <span class="comment">//   paths: glob.sync([</span></span><br><span class="line">    <span class="comment">//     path.join(__dirname, '../src/pages/*/*.html'),</span></span><br><span class="line">    <span class="comment">//     path.join(__dirname, '../src/pages/*/*.js')</span></span><br><span class="line">    <span class="comment">//   ]),</span></span><br><span class="line">    <span class="comment">//   purifyOptions: &#123;</span></span><br><span class="line">    <span class="comment">//     whitelist: ['slick.less','slick-theme.less']</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;),</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//css的去重，以前用的purifycss，好像不更新了，这个是新版，后面有个白名单，正则匹配，就是不管里面的class命名的代码</span></span><br><span class="line">    <span class="keyword">new</span> PurgecssPlugin(&#123;</span><br><span class="line">      paths: glob.sync(<span class="string">`<span class="subst">$&#123;PATHS.src&#125;</span>/pages/*/*`</span>,  &#123; <span class="attr">nodir</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">      <span class="comment">//白名单css，正则匹配css</span></span><br><span class="line">      whitelistPatterns: [<span class="regexp">/^(slick)/</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"shop"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"webpack.common.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"cross-env NODE_ENV=development webpack-dev-server --host 0.0.0.0 --config build/webpack.dev.js"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"cross-env NODE_ENV=production webpack --config build/webpack.prod.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"repository"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"git"</span>,</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"git+https://github.com/DemoorBug/shop.git"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"keywords"</span>: [],</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"bugs"</span>: &#123;</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"https://github.com/DemoorBug/shop/issues"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"homepage"</span>: <span class="string">"https://github.com/DemoorBug/shop#readme"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"@babel/core"</span>: <span class="string">"^7.3.4"</span>,</span><br><span class="line">    <span class="attr">"@babel/plugin-transform-runtime"</span>: <span class="string">"^7.3.4"</span>,</span><br><span class="line">    <span class="attr">"@babel/preset-env"</span>: <span class="string">"^7.3.4"</span>,</span><br><span class="line">    <span class="attr">"@babel/runtime"</span>: <span class="string">"^7.3.4"</span>,</span><br><span class="line">    <span class="attr">"@babel/runtime-corejs2"</span>: <span class="string">"^7.3.4"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"^8.0.5"</span>,</span><br><span class="line">    <span class="attr">"clean-webpack-plugin"</span>: <span class="string">"^1.0.1"</span>,</span><br><span class="line">    <span class="attr">"copy-webpack-plugin"</span>: <span class="string">"^5.0.0"</span>,</span><br><span class="line">    <span class="attr">"cross-env"</span>: <span class="string">"^5.2.0"</span>,</span><br><span class="line">    <span class="attr">"css-loader"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^5.15.1"</span>,</span><br><span class="line">    <span class="attr">"file-loader"</span>: <span class="string">"^3.0.1"</span>,</span><br><span class="line">    <span class="attr">"glob-all"</span>: <span class="string">"^3.1.0"</span>,</span><br><span class="line">    <span class="attr">"html-loader"</span>: <span class="string">"^0.5.5"</span>,</span><br><span class="line">    <span class="attr">"html-webpack-plugin"</span>: <span class="string">"^3.2.0"</span>,</span><br><span class="line">    <span class="attr">"image-webpack-loader"</span>: <span class="string">"^4.6.0"</span>,</span><br><span class="line">    <span class="attr">"imagemin"</span>: <span class="string">"^6.1.0"</span>,</span><br><span class="line">    <span class="attr">"imagemin-gifsicle"</span>: <span class="string">"^6.0.1"</span>,</span><br><span class="line">    <span class="attr">"imagemin-mozjpeg"</span>: <span class="string">"^8.0.0"</span>,</span><br><span class="line">    <span class="attr">"imagemin-optipng"</span>: <span class="string">"^6.0.0"</span>,</span><br><span class="line">    <span class="attr">"imagemin-pngquant"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="attr">"imagemin-svgo"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="attr">"imagemin-webp"</span>: <span class="string">"^5.0.0"</span>,</span><br><span class="line">    <span class="attr">"img-loader"</span>: <span class="string">"^3.0.1"</span>,</span><br><span class="line">    <span class="attr">"less"</span>: <span class="string">"^3.9.0"</span>,</span><br><span class="line">    <span class="attr">"less-loader"</span>: <span class="string">"^4.1.0"</span>,</span><br><span class="line">    <span class="attr">"mini-css-extract-plugin"</span>: <span class="string">"^0.5.0"</span>,</span><br><span class="line">    <span class="attr">"optimize-css-assets-webpack-plugin"</span>: <span class="string">"^5.0.1"</span>,</span><br><span class="line">    <span class="attr">"postcss-cssnext"</span>: <span class="string">"^3.1.0"</span>,</span><br><span class="line">    <span class="attr">"postcss-loader"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="attr">"postcss-preset-env"</span>: <span class="string">"^6.6.0"</span>,</span><br><span class="line">    <span class="attr">"purgecss-webpack-plugin"</span>: <span class="string">"^1.4.0"</span>,</span><br><span class="line">    <span class="attr">"purify-css"</span>: <span class="string">"^1.2.5"</span>,</span><br><span class="line">    <span class="attr">"purifycss-webpack"</span>: <span class="string">"^0.7.0"</span>,</span><br><span class="line">    <span class="attr">"raw-loader"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"style-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="attr">"terser-webpack-plugin"</span>: <span class="string">"^1.2.3"</span>,</span><br><span class="line">    <span class="attr">"uglifyjs-webpack-plugin"</span>: <span class="string">"^2.1.2"</span>,</span><br><span class="line">    <span class="attr">"url-loader"</span>: <span class="string">"^1.1.2"</span>,</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.29.6"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.2.3"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.2.1"</span>,</span><br><span class="line">    <span class="attr">"webpack-merge"</span>: <span class="string">"^4.2.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"bootstrap"</span>: <span class="string">"^3.4.1"</span>,</span><br><span class="line">    <span class="attr">"jquery"</span>: <span class="string">"^3.3.1"</span>,</span><br><span class="line">    <span class="attr">"lodash"</span>: <span class="string">"^4.17.11"</span>,</span><br><span class="line">    <span class="attr">"minireset.css"</span>: <span class="string">"0.0.4"</span>,</span><br><span class="line">    <span class="attr">"normalize.css"</span>: <span class="string">"^8.0.1"</span>,</span><br><span class="line">    <span class="attr">"slick-carousel"</span>: <span class="string">"^1.8.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"browserslist"</span>: [</span><br><span class="line">    <span class="string">"&gt; 1%"</span>,</span><br><span class="line">    <span class="string">"last 2 versions"</span>,</span><br><span class="line">    <span class="string">"not ie &lt;= 8"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="webpack-common-js-后面的都弃用"><a href="#webpack-common-js-后面的都弃用" class="headerlink" title="webpack.common.js 后面的都弃用"></a>webpack.common.js 后面的都弃用</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> devMode = process.env.NODE_ENV !== <span class="string">'production'</span></span><br><span class="line"><span class="comment">// const devMode = true</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">"mini-css-extract-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//入口文件依据目录随时添加</span></span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/pages/index/index.js'</span>,</span><br><span class="line">    main: <span class="string">'./src/pages/page1/main.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">//HtmlWebpackPlugin这个也是依据入口文件随时添加，我这样写很麻烦，要弄个自动化的</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/pages/index/index.html'</span>,</span><br><span class="line">      filename: <span class="string">'index.html'</span>,</span><br><span class="line">      inject: <span class="literal">true</span>,</span><br><span class="line">      hash: <span class="literal">true</span>,</span><br><span class="line">      chunks: [<span class="string">'vendor'</span>,<span class="string">'common'</span>,<span class="string">'runtime'</span>,<span class="string">'index'</span>],</span><br><span class="line">      minify: process.env.NODE_ENV !== <span class="string">"production"</span> ? <span class="literal">false</span> : &#123;</span><br><span class="line">          removeComments: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// collapseWhitespace: true,</span></span><br><span class="line">          removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./src/pages/page1/main.html'</span>,</span><br><span class="line">      filename: <span class="string">'main.html'</span>,</span><br><span class="line">      inject: <span class="literal">true</span>,</span><br><span class="line">      hash: <span class="literal">true</span>,</span><br><span class="line">      chunks: [<span class="string">'vendor'</span>,<span class="string">'common'</span>,<span class="string">'runtime'</span>,<span class="string">'main'</span>],</span><br><span class="line">      minify: process.env.NODE_ENV !== <span class="string">"production"</span> ? <span class="literal">false</span> : &#123;</span><br><span class="line">          removeComments: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// collapseWhitespace: true,</span></span><br><span class="line">          removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">  ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: devMode ? <span class="string">'js/[name].[hash:8].js'</span>: <span class="string">'js/[name].[chunkhash:8].js'</span>,</span><br><span class="line">    chunkFilename: devMode ? <span class="string">'js/[name].[hash:8].js'</span>: <span class="string">'js/[name].[chunkhash:8].js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    runtimeChunk: <span class="string">'single'</span>,</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">          vendor: &#123; <span class="comment">// 抽离第三方插件</span></span><br><span class="line">              test: <span class="regexp">/node_modules/</span>, <span class="comment">// 指定是node_modules下的第三方包</span></span><br><span class="line">              chunks: <span class="string">'initial'</span>,</span><br><span class="line">              name: <span class="string">'vendor'</span>, <span class="comment">// 打包后的文件名，任意命名    </span></span><br><span class="line">              <span class="comment">// 设置优先级，防止和自定义的公共代码提取时被覆盖，不进行打包</span></span><br><span class="line">              priority: <span class="number">10</span></span><br><span class="line">          &#125;,</span><br><span class="line">          utils: &#123; <span class="comment">// 抽离自己写的公共代码，common这个名字可以随意起</span></span><br><span class="line">              chunks: <span class="string">'initial'</span>,</span><br><span class="line">              name: <span class="string">'common'</span>, <span class="comment">// 任意命名</span></span><br><span class="line">              minSize: <span class="number">0</span>, <span class="comment">// 只要超出0字节就生成一个新包</span></span><br><span class="line">              minChunks: <span class="number">2</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: devMode ? <span class="string">'style-loader'</span> : MiniCssExtractPlugin.loader,</span><br><span class="line">            options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              <span class="comment">//单独给css里面的路径设置规则，防止和html里面的img路径冲突</span></span><br><span class="line">              publicPath: <span class="string">'../'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              ident: <span class="string">'postcss'</span>,</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              plugins: [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">'postcss-preset-env'</span>)()</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(gif|png|jpe?g|svg)$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span>,</span><br><span class="line">              name: <span class="string">'[name].img.[hash:5].[ext]'</span>,</span><br><span class="line">              outputPath: <span class="string">'img'</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"image-webpack-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              mozjpeg: &#123;</span><br><span class="line">                progressive: <span class="literal">true</span>,</span><br><span class="line">                quality: <span class="number">65</span></span><br><span class="line">              &#125;,</span><br><span class="line">              optipng: &#123;</span><br><span class="line">                enabled: <span class="literal">false</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              pngquant: &#123;</span><br><span class="line">                quality: <span class="string">'65-90'</span>,</span><br><span class="line">                speed: <span class="number">4</span></span><br><span class="line">              &#125;,</span><br><span class="line">              gifsicle: &#123;</span><br><span class="line">                interlaced: <span class="literal">false</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf|svg)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'file-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              name: <span class="string">'css/font/[name].font.[hash:6].[ext]'</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'html-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              attrs: [<span class="string">'img:src'</span>, <span class="string">'img:data-src'</span>],</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,  </span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="webpack-dev-js"><a href="#webpack-dev-js" class="headerlink" title="webpack.dev.js"></a>webpack.dev.js</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">'./dist'</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="webpack-prod-js-1"><a href="#webpack-prod-js-1" class="headerlink" title="webpack.prod.js"></a>webpack.prod.js</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">const merge = require(&apos;webpack-merge&apos;);</span><br><span class="line">const common = require(&apos;./webpack.common.js&apos;);</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line"></span><br><span class="line">const CleanWebpackPlugin = require(&apos;clean-webpack-plugin&apos;);</span><br><span class="line">const OptimizeCSSAssetsPlugin = require(&quot;optimize-css-assets-webpack-plugin&quot;);</span><br><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);</span><br><span class="line">const UglifyJsPlugin = require(&quot;uglifyjs-webpack-plugin&quot;);</span><br><span class="line">const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);</span><br><span class="line">const Purifycss = require(&apos;purifycss-webpack&apos;)</span><br><span class="line">const glob = require(&apos;glob-all&apos;)</span><br><span class="line">const copyWebpackPlugin = require(&quot;copy-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = merge(common, &#123;</span><br><span class="line">  mode: &apos;production&apos;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      new UglifyJsPlugin(&#123; //处理js压缩</span><br><span class="line">        cache: true,</span><br><span class="line">        parallel: true,</span><br><span class="line">        sourceMap: true // set to true if you want JS source maps</span><br><span class="line">      &#125;),</span><br><span class="line">      new OptimizeCSSAssetsPlugin(&#123;&#125;) //压缩css</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new CleanWebpackPlugin([&apos;dist/*&apos;]), //去除dist目录</span><br><span class="line">    new MiniCssExtractPlugin(&#123; //提取css</span><br><span class="line">      filename: &quot;css/[name].[contenthash:8].css&quot;,</span><br><span class="line">      chunkFilename: &quot;css/[name].[contenthash:8].css&quot;</span><br><span class="line">    &#125;),</span><br><span class="line">    new copyWebpackPlugin([&#123; //这个可以提取静态文件，以后还会增加</span><br><span class="line">        from: path.resolve(__dirname, &quot;../src/assets&quot;),</span><br><span class="line">        to: &apos;./assets&apos;,</span><br><span class="line">        ignore: [&apos;.*&apos;] //排除目录</span><br><span class="line">    &#125;]),</span><br><span class="line">    new Purifycss(&#123; //tree shaking css</span><br><span class="line">      paths: glob.sync([</span><br><span class="line">        path.join(__dirname, &apos;../src/*.html&apos;),</span><br><span class="line">        path.join(__dirname, &apos;../src/*.js&apos;)</span><br><span class="line">      ])</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;webpack-配置&quot;&gt;&lt;a href=&quot;#webpack-配置&quot; class=&quot;headerlink&quot; title=&quot;webpack 配置&quot;&gt;&lt;/a&gt;webpack 配置&lt;/h1&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>git</title>
    <link href="demoorbug.github.io/2019/03/03/git/"/>
    <id>demoorbug.github.io/2019/03/03/git/</id>
    <published>2019-03-03T12:39:56.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="新电脑创建后快速使用git"><a href="#新电脑创建后快速使用git" class="headerlink" title="新电脑创建后快速使用git"></a>新电脑创建后快速使用git</h1><p>博客怎么没了？<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~ //切换到根目录</span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"demoorbug@gmail.com"</span></span><br><span class="line"><span class="built_in">cd</span> .ssh</span><br><span class="line">cat id_rsa.pub // 将打印出来的复制到 github.com&gt;settings&gt;SSH and GPG Keys&gt;New SSH</span><br><span class="line">key</span><br><span class="line">git config --global user.name <span class="string">"DEBUG"</span></span><br><span class="line">git config --global user.email  <span class="string">"demoorbug@gmail.com"</span></span><br></pre></td></tr></table></figure></p><h1 id="本地项目替换线上项目"><a href="#本地项目替换线上项目" class="headerlink" title="本地项目替换线上项目"></a>本地项目替换线上项目</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//下载压缩包</span><br><span class="line">解压后进入，更改后</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">'New'</span></span><br><span class="line">git remote add origin git@github.com:DemoorBug/shop.git</span><br><span class="line">git pull</span><br><span class="line">git push -u origin master -f // -f force是强制的意思</span><br></pre></td></tr></table></figure><h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir shop //创建shop文件夹</span><br><span class="line"><span class="built_in">cd</span> shop</span><br><span class="line">git init //初始化项目</span><br><span class="line">touch README.md //创建初始化项目文件</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"shop"</span> //本次提交信息简介</span><br><span class="line">git remote add origin git@github.com:DemoorBug/shop.git</span><br><span class="line">git push -u origin master //-u代表了关联本地分支和线上分支的master分支，以后就可以直接git push了</span><br></pre></td></tr></table></figure><p>查看remote以及删除重新添加方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote -v  </span><br><span class="line">git remote remove &lt;name&gt;</span><br></pre></td></tr></table></figure></p><h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b index-redux //创建分支</span><br><span class="line">git push origin index-redux //推送到线上，没有就创建</span><br><span class="line">git checkout master</span><br><span class="line">git merge origin/index-redux // 合并分支</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>查看分支<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -a // 或</span><br><span class="line">git branch</span><br></pre></td></tr></table></figure></p><p>删除分支<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d index-redux // 删除本地分支</span><br><span class="line">git push origin --delect index-redux // 删除远程分支</span><br></pre></td></tr></table></figure></p><h1 id="撤销commit"><a href="#撤销commit" class="headerlink" title="撤销commit"></a>撤销commit</h1><p>这样就成功的撤销了你的commit<br>注意，仅仅是撤回commit操作，您写的代码仍然保留。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --soft HEAD^</span><br></pre></td></tr></table></figure></p><p>HEAD^的意思是上一个版本，也可以写成HEAD~1<br>如果你进行了2次commit，想都撤回，可以使用HEAD~2</p><p>options<br>–mixed<br>意思是：不删除工作空间改动代码，撤销commit，并且撤销git add . 操作<br>这个为默认参数,git reset –mixed HEAD^ 和 git reset HEAD^ 效果是一样的。</p><p>–soft<br>不删除工作空间改动代码，撤销commit，不撤销git add . </p><p>–hard<br>删除工作空间改动代码，撤销commit，撤销git add . </p><h2 id="如果是注释写错了可以"><a href="#如果是注释写错了可以" class="headerlink" title="如果是注释写错了可以"></a>如果是注释写错了可以</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend // 就会进入编辑模式</span><br></pre></td></tr></table></figure><h1 id="拉取线上代码"><a href="#拉取线上代码" class="headerlink" title="拉取线上代码"></a>拉取线上代码</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:DemoorBug/pubg-api.git // 项目地址</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;新电脑创建后快速使用git&quot;&gt;&lt;a href=&quot;#新电脑创建后快速使用git&quot; class=&quot;headerlink&quot; title=&quot;新电脑创建后快速使用git&quot;&gt;&lt;/a&gt;新电脑创建后快速使用git&lt;/h1&gt;&lt;p&gt;博客怎么没了？&lt;br&gt;&lt;figure class=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>商城网站开发记录</title>
    <link href="demoorbug.github.io/2019/03/03/%E5%95%86%E5%9F%8E%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"/>
    <id>demoorbug.github.io/2019/03/03/商城网站开发记录/</id>
    <published>2019-03-03T12:38:50.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="依照官方webpack-4配置"><a href="#依照官方webpack-4配置" class="headerlink" title="依照官方webpack 4配置"></a>依照官方webpack 4配置</h1><p><a href="https://webpack.js.org/guides/installation" target="_blank" rel="noopener">webpack官方</a></p><p>官方的文档很详细，看起来轻松多了<br>今天看到Production （生产）明天继续</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;依照官方webpack-4配置&quot;&gt;&lt;a href=&quot;#依照官方webpack-4配置&quot; class=&quot;headerlink&quot; title=&quot;依照官方webpack 4配置&quot;&gt;&lt;/a&gt;依照官方webpack 4配置&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://w
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>URL</title>
    <link href="demoorbug.github.io/2019/01/23/URL/"/>
    <id>demoorbug.github.io/2019/01/23/URL/</id>
    <published>2019-01-23T22:57:46.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="网址收集"><a href="#网址收集" class="headerlink" title="网址收集"></a>网址收集</h1><p><a href="http://www.bitbug.net" target="_blank" rel="noopener">.ico 在线转换 网址</a><br><a href="https://dillinger.io/" target="_blank" rel="noopener">mackdown在线编辑</a>  <a href="https://stackedit.io" target="_blank" rel="noopener">目前用的在线编辑</a><br><a href="http://browsehappy.com" target="_blank" rel="noopener">最新浏览器升级 </a><br><a href="https://www.seeseed.com/" target="_blank" rel="noopener">无穷无尽的设计可能</a></p><a id="more"></a><p><strong>图标压缩</strong><br><a href="http://owlcarousel2.github.io/OwlCarousel2/" target="_blank" rel="noopener">OwlCarousel2 轮播插件</a><br><a href="https://tinypng.com" target="_blank" rel="noopener">PNG JPG..压缩</a><br><a href="http://iconizr.com" target="_blank" rel="noopener">SVG图片压缩</a><br><strong>图标库</strong><br><a href="https://icomoon.io" target="_blank" rel="noopener">icomoon</a><br><a href="http://iconfont.cn" target="_blank" rel="noopener">iconfont</a><br><strong>HACK</strong><br><a href="http://browserhacks.com" target="_blank" rel="noopener">browserhacks</a><br><a href="http://caniuse.com/" target="_blank" rel="noopener">caniuse</a><br><a href="http://shouldiprefix.com" target="_blank" rel="noopener">shouldiprefix</a></p><p><a href="https://github.com/aFarkas/html5Shiv" target="_blank" rel="noopener">HTML5标签支持支持IE6-IE8</a><br><a href="https://github.com/scottjehl/Respond" target="_blank" rel="noopener">CSS3媒体查询兼任IE6-IE8</a><br><a href="https://modernizr.com" target="_blank" rel="noopener">主动性检测兼容问题  防御性编程</a><br><a href="https://javascript-minifier.com/" target="_blank" rel="noopener">在线压缩</a></p><p><a href="http://cubic-bezier.com" target="_blank" rel="noopener">贝塞尔曲线</a><br><a href="http://jsbin.com/" target="_blank" rel="noopener">线上编写代码测试，提问</a><br><a href="http://www.easyicon.net" target="_blank" rel="noopener">ICON图标下载</a><br><a href="http://danbooru.donmai.us" target="_blank" rel="noopener">江江推荐的二次元网站</a></p><p><strong>响应式框架</strong><br><a href="http://getbootstrap.com" target="_blank" rel="noopener">Bootstrap</a><br><a href="http://foundation.zurb.com" target="_blank" rel="noopener">Foundation</a> 结构语义化，移动设备优先，完全可以定制<br><a href="http://semantic-ui.com" target="_blank" rel="noopener">Semantic UI</a> 命名非常的语义化<br><a href="http://Purecss.io" target="_blank" rel="noopener">PureCss</a> 非常轻量级</p><p><strong>功能性网站</strong><br><a href="temp-mail.org">一个不用注册就可以接收邮件的网站</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;网址收集&quot;&gt;&lt;a href=&quot;#网址收集&quot; class=&quot;headerlink&quot; title=&quot;网址收集&quot;&gt;&lt;/a&gt;网址收集&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.bitbug.net&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;.ico 在线转换 网址&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://dillinger.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mackdown在线编辑&lt;/a&gt;  &lt;a href=&quot;https://stackedit.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;目前用的在线编辑&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://browsehappy.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;最新浏览器升级 &lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.seeseed.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;无穷无尽的设计可能&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>javascript</title>
    <link href="demoorbug.github.io/2019/01/13/javascript/"/>
    <id>demoorbug.github.io/2019/01/13/javascript/</id>
    <published>2019-01-13T08:55:59.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h1><p><strong>concat()</strong><br>用于连接两个或多个数组<br><strong>copyWithin()</strong> es6<br>复制元素到指定位置<br><code>array.copyWithin(复制到指定目标索引,[起始位置，[停止位置]])</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arrs = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">arrs.copyWithin(<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p><p><strong>entries()</strong> es6<br>给数组添加键值对,返回一个可迭代对象<br><code>没有参数</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arrs = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arrs.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>every()</strong><br>和some() 一直，不过有不同，some位置下面有写<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>,<span class="number">32</span>,<span class="number">43</span>,<span class="number">52</span>];</span><br><span class="line">ages.every(<span class="function">(<span class="params">age</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> age &gt; <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>如果全部满足条件就返回true，负责一个不满足就会终止返回false<br><strong>filter()</strong><br>过滤，可以直接使用<code>every</code>的案例，结果就是过滤后的值<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.filter(<span class="function">(<span class="params">age</span>) =&gt;</span> age &lt; <span class="number">31</span>) <span class="comment">//[30]</span></span><br></pre></td></tr></table></figure></p><p><strong>find()</strong> es6<br>接收函数，检测条件为true时，直接返回，接下来就不会继续执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">53</span>];</span><br><span class="line">ages.find(<span class="function">(<span class="params">age</span>) =&gt;</span> age == <span class="number">32</span>) <span class="comment">//32</span></span><br></pre></td></tr></table></figure></p><p><strong>findIndex()</strong> es6<br>返回索引，没有就是-1<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">53</span>];</span><br><span class="line">ages.findIndex(<span class="function">(<span class="params">a</span>) =&gt;</span> <span class="keyword">return</span> a == <span class="number">30</span>) <span class="comment">//结果返回索引0</span></span><br></pre></td></tr></table></figure></p><p><strong>fill()</strong><br>填充<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrs = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">arrs.fill(<span class="string">'i'</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure></p><p><strong>forEach()</strong><br>循环<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.forEach(<span class="function">(<span class="params">age, index</span>) =&gt;</span> <span class="built_in">console</span>.log(age, index))</span><br></pre></td></tr></table></figure></p><p><strong>from()</strong> es6<br>处理带有length属性的对象，或可迭代对象，返回数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from([<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>], (arr) =&gt; arr + <span class="number">1</span>) </span><br><span class="line"><span class="comment">//案例中数组用new Set([2, 1, 3, 5, 6])这种方式，Set还没看，不清楚</span></span><br></pre></td></tr></table></figure></p><p><strong>includes()</strong> es6<br>感觉像是find的简单用法？这个方法可以替代<code>indexOf()</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.includes(<span class="number">30</span>) <span class="comment">//true,这个是es6方法，比indexOf强大</span></span><br></pre></td></tr></table></figure></p><p><strong>indexOf()</strong><br>返回查询的值，没有就是-1，好处在于以前的浏览器兼容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.indexOf(<span class="number">30</span>) <span class="comment">//返回索引位置0，没有就是-1</span></span><br></pre></td></tr></table></figure></p><p><strong>isArray()</strong><br>判断对象是否为数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line"><span class="built_in">Array</span>.isArray(ages) <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p><p><strong>join()</strong><br>把数组转换为字符串，接收一个参数，通过什么符合组合<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.join(<span class="string">''</span>) <span class="comment">//30324352</span></span><br></pre></td></tr></table></figure></p><p><strong>keys()</strong> es6<br>将数组转换为可迭代对象(Iterator)，可以通过for…of处理<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> ages.keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i) <span class="comment">//0, 1, 2, 3返回索引</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>lastIndexOf()</strong><br>不常用，就是从最后一个开始检索字符串<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">indexOf() <span class="comment">//的反转用法</span></span><br></pre></td></tr></table></figure></p><p><strong>map()</strong><br>感觉和<code>from()</code>很类似<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.map(<span class="function">(<span class="params">age</span>) =&gt;</span> age + <span class="number">1</span>) <span class="comment">//[31, 32, 44, 53]</span></span><br></pre></td></tr></table></figure></p><p><strong>pop()</strong><br>删除数组最后一个元素，并返回删除了那个元素，改变原数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.pop() <span class="comment">//52</span></span><br></pre></td></tr></table></figure></p><p><strong>push()</strong><br>数组末尾添加元素<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.push(<span class="number">23</span>) <span class="comment">//返回数组length 5</span></span><br></pre></td></tr></table></figure></p><p><strong>reduce()</strong><br>他可以办到的forEach也可以，用这个逼格？还有<a href="https://www.jianshu.com/p/e375ba1cfc47" target="_blank" rel="noopener">高级用法</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.reduce(<span class="function">(<span class="params">total, age, index, arr</span>) =&gt;</span> total+age) <span class="comment">//结果为30+32+43+52总和</span></span><br></pre></td></tr></table></figure></p><p><strong>reduceRight()</strong><br>和<code>reduce</code>是一样的，不过是从末尾开始<br><strong>reverse()</strong><br>颠倒数组顺序<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>]; </span><br><span class="line">ages.reverse() <span class="comment">//修改原数组</span></span><br></pre></td></tr></table></figure></p><p><strong>shift()</strong><br>删除并返回数组的第一个元素，和<code>pop()</code>兄弟<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">30</span>, <span class="number">32</span>, <span class="number">43</span>, <span class="number">52</span>];</span><br><span class="line">ages.shift() <span class="comment">//返回删除的值30，改变原数组</span></span><br></pre></td></tr></table></figure></p><p><strong>slice()</strong><br>截取数组并返回新的数组，不改变原数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ages.slice(<span class="number">2</span>) <span class="comment">//从第二个值开始截取，</span></span><br></pre></td></tr></table></figure></p><p><strong>some()</strong><br>和<code>every()</code>区别在于，every有一个条件不符直接退出，some会查找到返回true为止，否则停止<br><strong>sort()</strong><br>可以让数组顺序依据字母顺序排序，默认升序，文档后面介绍很详细<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'b'</span>];</span><br><span class="line">ages.sort() <span class="comment">//还可以添加规则，数字的排序好像还要处理，字母的降序可以用reverse()</span></span><br></pre></td></tr></table></figure></p><p><strong>splice()</strong><br>添加或删除，改变原数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">ages.splice(<span class="number">2</span>, <span class="number">1</span>, <span class="string">'5'</span>,<span class="string">'1'</span>);   <span class="comment">//[1, 2, '5', '1', 4 , 5]</span></span><br></pre></td></tr></table></figure></p><p><strong>toString()</strong><br>将数组转换为字符串，返回结果<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ages = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">ages.toString(); <span class="comment">//1,2,3,4,5 join()更灵活</span></span><br></pre></td></tr></table></figure></p><p><strong>unshift()</strong><br>数组开头添加  是push的兄弟<br><strong>valueOf()</strong><br>返回原始数组，用于调试</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Array&quot;&gt;&lt;a href=&quot;#Array&quot; class=&quot;headerlink&quot; title=&quot;Array&quot;&gt;&lt;/a&gt;Array&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;concat()&lt;/strong&gt;&lt;br&gt;用于连接两个或多个数组&lt;br&gt;&lt;strong&gt;copyWi
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>webpack</title>
    <link href="demoorbug.github.io/2019/01/06/webpack/"/>
    <id>demoorbug.github.io/2019/01/06/webpack/</id>
    <published>2019-01-06T20:29:16.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener">webpack版本更迭</a><br><a href="https://webpack.js.org/vote" target="_blank" rel="noopener">社区投票</a><br><a href="https://webpack.docschina.org/concepts/" target="_blank" rel="noopener">官方文档</a><br><a id="more"></a></p><h1 id="模块化开发"><a href="#模块化开发" class="headerlink" title="模块化开发"></a>模块化开发</h1><p>方爷,图虫</p><h2 id="js模块化"><a href="#js模块化" class="headerlink" title="js模块化"></a>js模块化</h2><h3 id="1-命名空间"><a href="#1-命名空间" class="headerlink" title="1. 命名空间"></a>1. 命名空间</h3><p>库名.类别名.方法名<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> NameSpace = &#123;&#125;</span><br><span class="line">NameSpace.type = NameSpace.type || &#123;&#125;</span><br><span class="line"></span><br><span class="line">NameSpace.type.method = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="2-COMMONJS"><a href="#2-COMMONJS" class="headerlink" title="2. COMMONJS"></a>2. COMMONJS</h3><p>诞生于node社区，只能在服务器端使用<br>一个文件为一个模块<br>通过module.exports 暴露模块接口<br>通过require就可以引入模块</p><p>因为commonjs运行在服务端，他的require是同步执行的<br>同步执行<a href="">http://wiki.commonjs.org/wiki/Modules/1.1.1</a></p><h3 id="3-AMD-CMD-UMD"><a href="#3-AMD-CMD-UMD" class="headerlink" title="3. AMD/CMD/UMD"></a>3. AMD/CMD/UMD</h3><p><strong>AMD</strong><br>全称Async Module Definition<br>使用define定义模块<br>使用require加载模块<br>比较著名的库RequireJs<br>依赖前置，提前执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">define(</span><br><span class="line">  <span class="comment">//模块名</span></span><br><span class="line">  <span class="string">"alpha"</span>,</span><br><span class="line">  <span class="comment">//依赖</span></span><br><span class="line">  [<span class="string">"require"</span>, <span class="string">"exports"</span>, <span class="string">"beta"</span>],</span><br><span class="line">  <span class="comment">//模块输出</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">require, exports, beta</span>) </span>&#123;</span><br><span class="line">    exports.verb = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> bata.verb();</span><br><span class="line">      <span class="comment">//Or:</span></span><br><span class="line">      <span class="comment">//Create missing node module:'beta'</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">"beta"</span>).verb()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><hr><p><strong>CMD</strong><br>通用模块定义Common Module Definition<br>一个文件一个模块<br>使用define定义模块<br>使用require加载模块<br>产物SeaJs<br>尽可能懒执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有模块都通过define定义</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</span><br><span class="line">  <span class="keyword">var</span> Spinning = <span class="built_in">require</span>(<span class="string">'./spinning'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//通过exports对外提供接口</span></span><br><span class="line">  exports.doSomething = ...</span><br><span class="line">  <span class="comment">//或者通过module.exports 提供整个接口</span></span><br><span class="line">  <span class="built_in">module</span>.exports = ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><hr><p><strong>UMD</strong><br>Universal Module Definition<br>通用解决方案<br>三个步骤<br>  判断是否支持AMD<br>  判断是否支持CommonJs<br>  如果都没有使用全局变量</p><h3 id="4-es-module"><a href="#4-es-module" class="headerlink" title="4. es module"></a>4. es module</h3><p>EcmaScript Module<br>一个文件一个模块<br>export / import<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; name <span class="keyword">as</span> myNamed, named &#125; <span class="keyword">from</span> <span class="string">'src/mylib'</span></span><br></pre></td></tr></table></figure></p><p>这样的写法和这个貌似是一样的<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="attr">name</span> : myNamed, named &#125; <span class="keyword">from</span> <span class="string">'src/mylib'</span></span><br></pre></td></tr></table></figure></p><p>拿到全部方法，mylib可以使用他<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mylib <span class="keyword">from</span> <span class="string">'src/mylib'</span></span><br></pre></td></tr></table></figure></p><p>只是加载进来，没有任何引用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'src/mylib'</span></span><br></pre></td></tr></table></figure></p><hr><p><strong>export, export default</strong></p><ul><li>export, export default 均可到处常量，函数，文件，模块等</li><li>export 一个文件可以有多个，</li><li>export default一个文件只能有一个</li><li>通过export方式导出，在导入时要加{},export default 则不用</li><li>export 能直接导出变量表达式，export default则不行<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main.js</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mapNict = <span class="string">'map'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'name'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'defalut'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>导入步骤<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.js</span><br><span class="line"><span class="keyword">import</span> &#123; mapNict, name &#125; <span class="keyword">from</span> <span class="string">'./main.js'</span></span><br><span class="line"><span class="keyword">import</span> m <span class="keyword">from</span> <span class="string">'./main.js'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mapNict); <span class="comment">//map</span></span><br><span class="line">name() <span class="comment">//name</span></span><br><span class="line"></span><br><span class="line">m.name() <span class="comment">//default</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> myname <span class="keyword">from</span> <span class="string">'./main.js'</span></span><br><span class="line"></span><br><span class="line">myname.default.name() <span class="comment">//default</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myname.mapNict) <span class="comment">//map</span></span><br><span class="line"></span><br><span class="line">myname.name() <span class="comment">//name</span></span><br></pre></td></tr></table></figure></p><h3 id="5-Webpack支持"><a href="#5-Webpack支持" class="headerlink" title="5. Webpack支持"></a>5. Webpack支持</h3><ul><li>AMD(RequireJs) //只需要一些了解</li><li>ES Modules(推荐的) //主流</li><li>CommonJs //主流</li></ul><hr><h2 id="Css模块化"><a href="#Css模块化" class="headerlink" title="Css模块化"></a>Css模块化</h2><p>这点没看，以后有需要回来看吧，感觉没什么用</p><h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><h2 id="1-Entry"><a href="#1-Entry" class="headerlink" title="1. Entry"></a><strong>1. Entry</strong></h2><ul><li>代码的入口</li><li>打包的入口</li><li>单个或多个<br>可以直接是一个文件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./index.js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>还可以是一个数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: [<span class="string">'index.js'</span>, <span class="string">'vendor.js'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>还可以是一个对象<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'index.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="2-Output"><a href="#2-Output" class="headerlink" title="2. Output"></a>2. Output</h2><ul><li>输出</li><li>打包成的文件(bundle)</li><li>一个或多个</li><li>自定义规则</li><li>融合CDN<br>一个<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filname: <span class="string">'index.min.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>多个<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'index.js'</span>,</span><br><span class="line">    vendor: <span class="string">'vendor.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filname: <span class="string">'[name].min.[hash:5].js'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//自定义规则[name]表示entry的name</span></span><br><span class="line">  <span class="comment">//[hash:5] webpack打包过程中出现的md5码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="3-loaders"><a href="#3-loaders" class="headerlink" title="3. loaders"></a>3. loaders</h2><p>靠loaders处理其他类型的文件<br>处理文件<br>转化为模块<br>处理css的loader<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: <span class="string">'css-loader'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>常用loader<br>编译相关<br>babel-loader、ts-loader<br>样式相关<br>style-loader、css-loader、less-loader、postcss-loader<br>文件相关<br>file-loader、url-loader</p><hr><h2 id="4-plugins"><a href="#4-plugins" class="headerlink" title="4. plugins"></a>4. plugins</h2><p>压缩代码，混淆，代码分割<br>参与打包整个过程<br>打包优化和压缩<br>配置编译时的变量<br>极其灵活<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin() <span class="comment">//压缩混淆</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">常用Plugins</span></span><br><span class="line"><span class="string">优化相关</span></span><br><span class="line"><span class="string">CommonsChunkPlugin </span></span><br><span class="line"><span class="string">UglifyjsWebpackPlugin  //压缩混淆</span></span><br><span class="line"><span class="string">功能相关</span></span><br><span class="line"><span class="string">ExtractTextWebpackPlugin //打包成单独css文件</span></span><br><span class="line"><span class="string">HtmlWebpackPlugin //帮助生成html</span></span><br><span class="line"><span class="string">hotModuleReplacementPlugin //模块热更新</span></span><br><span class="line"><span class="string">CopyWebpackPlugin //拷贝文件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">名词：</span></span><br><span class="line"><span class="string">Chunk 代码块。</span></span><br><span class="line"><span class="string">Bundle 打包过以后的</span></span><br><span class="line"><span class="string">Module 模块</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 编译ES6/7</span></span><br><span class="line"><span class="string">## **1. Babel**</span></span><br><span class="line"><span class="string">使用Babel</span></span><br><span class="line"><span class="string">安装最新版</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line">npm install babel-loader@<span class="number">8.0</span><span class="number">.0</span>-beta<span class="number">.0</span> @babel/core</span><br></pre></td></tr></table></figure></p><p>普通版本<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-loader babel-core</span><br></pre></td></tr></table></figure></p><h2 id="2-Babel-presets-针对语法"><a href="#2-Babel-presets-针对语法" class="headerlink" title="2. Babel-presets(针对语法)"></a>2. Babel-presets(针对语法)</h2><p>es2015<br>es2016<br>es2017<br>env 一个汇总，包含15-17，以及最近的<br>自定义的<br>babel-preset-react  //和React相关的<br>babel-preset-stage 0-3 //还没有发布的</p><p>安装的是最新的loader就可以使用这一句<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/preset-env --save-dev</span><br></pre></td></tr></table></figure></p><p>安装的是普通版本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-preset-env --save-dev</span><br></pre></td></tr></table></figure><p>targets 可以指定那些语法编译，那些语法不编译<br>targets.browsers 指定浏览器，还可以指定nodejs版本<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">targets.browsers: <span class="string">'last 2 versions'</span> <span class="comment">//指定浏览器最后的两个版本</span></span><br><span class="line">targets.browsers: <span class="string">'&gt; 1%'</span> 大于全球占有率<span class="number">1</span>的浏览器都可以支持</span><br></pre></td></tr></table></figure></p><p>数据从github的browserslist项目获得<br>Can I use</p><h2 id="3-Babel-Polyfill-针对函数和方法"><a href="#3-Babel-Polyfill-针对函数和方法" class="headerlink" title="3. Babel Polyfill(针对函数和方法)"></a>3. Babel Polyfill(针对函数和方法)</h2><p>Generator<br>set<br>Map<br>Array.from<br>Array.prototype.includes<br>全局垫片，会对全局污染<br>为开发应用准备，写一个网站<br>写vue就不能用Polyfill<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-polyfill --save</span><br></pre></td></tr></table></figure></p><p>import “babel-polyfill”</p><p>—js<br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry : &#123;</span><br><span class="line">    app: <span class="string">'./app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output : &#123;</span><br><span class="line">    filename: <span class="string">'[name].[hash:8].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [</span><br><span class="line">              [<span class="string">'@babel/preset-env'</span>, &#123;</span><br><span class="line">                targets: &#123;</span><br><span class="line">                  browsers: [<span class="string">'&gt; 1%'</span>, <span class="string">'last 2 versions'</span>]</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;]</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        exclude: <span class="string">'/node_modules'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="4-Babel-Runtime-Transform-针对函数和方法"><a href="#4-Babel-Runtime-Transform-针对函数和方法" class="headerlink" title="4. Babel Runtime Transform(针对函数和方法)"></a>4. Babel Runtime Transform(针对函数和方法)</h2><p>局部垫片<br>为开发框架准备<br>不会污染全局<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-plugin-transform-runtime --save-dev</span><br><span class="line">npm install babel-runtime --save</span><br></pre></td></tr></table></figure></p><p>不知道@babel这种安装方式是为什么？<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-transform-runtime --save-dev</span><br><span class="line">npm install @babel/runtime --save</span><br></pre></td></tr></table></figure></p><p>这种方法无法实现，不知道为什么，打包后只有2.6k大小<br>找到解决方法了，增加{ “corejs”: 2 }<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [[<span class="string">"@babel/env"</span>, &#123;</span><br><span class="line">    <span class="string">"targets"</span>: &#123;</span><br><span class="line">      <span class="string">"browsers"</span> : [<span class="string">"last 2 versions"</span>] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]],</span><br><span class="line">  <span class="string">"plugins"</span>: [[<span class="string">"@babel/plugin-transform-runtime"</span>, &#123; <span class="string">"corejs"</span>: <span class="number">2</span> &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="提取公用代码"><a href="#提取公用代码" class="headerlink" title="提取公用代码"></a>提取公用代码</h1><p><strong>1. 减少代码冗余</strong></p><ol start="2"><li><p>提高加载速度</p></li><li><p>CommonsChunkPlugin 插件提取公用代码。内置插件</p></li></ol><p>webpack.optimize.CommonsChunkPlugin</p><ol start="4"><li>配置<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> weback.optimize.CommonsChunkPlugin(option)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">options配置是什么样的呢：</span></span><br><span class="line"><span class="string">- options.name or options.names</span></span><br><span class="line"><span class="string">  - name names 表示Chunk的名称</span></span><br><span class="line"><span class="string">- options.filename 打包之后的名称</span></span><br><span class="line"><span class="string">- options.minChunks </span></span><br><span class="line"><span class="string">  - 可以是一个数字也可以是一个函数还可以是一个特殊的值Infinity</span></span><br><span class="line"><span class="string">  - 当他是数字的时候，表示为你要提取代码的出现次数最小是多少</span></span><br><span class="line"><span class="string">  - Infinity 这个值的时候他不会把任何代码打包进去</span></span><br><span class="line"><span class="string">  - 还可以是一个函数，可以自定义你的逻辑</span></span><br><span class="line"><span class="string">- options.chunks 提取代码范围，需要在那几个代码中去提取</span></span><br><span class="line"><span class="string">- options.children 是不是在entry的子模块中或者你的所有模块中</span></span><br><span class="line"><span class="string">- options.deepChildren 是不是在entry的子模块中或者你的所有模块中</span></span><br><span class="line"><span class="string">- options.async 会创建一个异步的工作代码流</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">需要把webpack安装到本地，因为这个插件是webpack自带的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    <span class="string">'pageA'</span>: <span class="string">'./src/pageA'</span>,</span><br><span class="line">    <span class="string">'pageB'</span>: <span class="string">'./src/pageB'</span>,</span><br><span class="line">    <span class="string">'vendor'</span>: <span class="string">'lodash'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].chunk.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;  <span class="comment">//打包自己写的公用代码</span></span><br><span class="line">      name: <span class="string">'common'</span>,</span><br><span class="line">      minChunks: <span class="number">2</span>,</span><br><span class="line">      chunks: [<span class="string">'pageA'</span>,<span class="string">'pageB'</span>] <span class="comment">//有bug，这样可以解决</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;  <span class="comment">//打包lodash</span></span><br><span class="line">      names: [<span class="string">'vendor'</span>, <span class="string">'manifest'</span>], <span class="comment">//vendor打包的是lodash,manifest打包的是webpack公用代码</span></span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="代码分割和懒加载"><a href="#代码分割和懒加载" class="headerlink" title="代码分割和懒加载"></a>代码分割和懒加载</h1><p>可以通过两种方式懒加载</p><h2 id="1-webpack-methods"><a href="#1-webpack-methods" class="headerlink" title="1. webpack methods"></a><strong>1. webpack</strong> methods</h2><ul><li>require.ensure([],callback, [errorCallback], chunkName)<ul><li>[] : dependencies 加载进来并不会执行</li><li>callback</li><li>errorCallback 可以省略的第三个参数</li><li>chunkName</li></ul></li><li>require.include([])只接受一个参数，但是不执行<ul><li>当你的子模块都依赖一个第三方模块，就可以把第三方模块放到父模块里面</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>.include(<span class="string">'./moduleA.js'</span>)  <span class="comment">//提取公共代码，subPageA和subPageB都引用了moduleA.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>.ensure([<span class="string">'./subPageA'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">//打包subPageA</span></span><br><span class="line">  <span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'./subPageA'</span>)</span><br><span class="line">&#125;, <span class="string">'subPageA'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>.ensure([<span class="string">'./subPageB'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//打包subPageB</span></span><br><span class="line">  <span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'./subPageB'</span>)</span><br><span class="line">&#125;, <span class="string">'subPageB'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>.ensure([<span class="string">'lodash'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//打包lodash</span></span><br><span class="line">  <span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</span><br><span class="line">  _.join([<span class="string">'1'</span>, <span class="string">'2'</span>], <span class="string">'3'</span>)</span><br><span class="line">&#125;, <span class="string">'vendor'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'pageA'</span></span><br></pre></td></tr></table></figure><h2 id="2-ES-2015-Loader-spec"><a href="#2-ES-2015-Loader-spec" class="headerlink" title="2. ES 2015 Loader spec"></a>2. ES 2015 Loader spec</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'subpageA' */</span><span class="string">'./subPageA'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">subPageA</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(subPageA)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* webpackChunkName: 'subpageA' */</span>是webpack支持的魔法函数</span><br></pre></td></tr></table></figure><p>pageA.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'subpageA' */</span><span class="string">'./subPageA'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">subPageA</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(subPageA)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'subpageB' */</span><span class="string">'./subPageB'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">subPageA</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(subPageB)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'pageA'</span></span><br></pre></td></tr></table></figure></p><h2 id="3-如果我们想把异步加载进来模块的代码进行提取，除了require-include-‘-moduleA-js’-，还可以用webpack-config-js完成"><a href="#3-如果我们想把异步加载进来模块的代码进行提取，除了require-include-‘-moduleA-js’-，还可以用webpack-config-js完成" class="headerlink" title="3. 如果我们想把异步加载进来模块的代码进行提取，除了require.include(‘./moduleA.js’) ，还可以用webpack.config.js完成"></a>3. 如果我们想把异步加载进来模块的代码进行提取，除了require.include(‘./moduleA.js’) ，还可以用webpack.config.js完成</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    <span class="string">'pageA'</span>: <span class="string">'./src/pageA'</span>,</span><br><span class="line">    <span class="string">'pageB'</span>: <span class="string">'./src/pageB'</span>,</span><br><span class="line">    <span class="string">'vendor'</span>: <span class="string">'lodash'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].chunk.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins : [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;  <span class="comment">//打包lodash</span></span><br><span class="line">      <span class="keyword">async</span>: <span class="string">'async-common'</span>,  <span class="comment">//处理异步加载进来的代码</span></span><br><span class="line">      children: <span class="literal">true</span>, <span class="comment">//entry模块的子模块</span></span><br><span class="line">      minChunks: <span class="number">2</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;  <span class="comment">//打包lodash</span></span><br><span class="line">      names: [<span class="string">'vendor'</span>, <span class="string">'manifest'</span>],</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">  <span class="comment">// plugins: [</span></span><br><span class="line">  <span class="comment">//   new webpack.optimize.CommonsChunkPlugin(&#123;  //打包自己写的公用代码</span></span><br><span class="line">  <span class="comment">//     name: 'common',</span></span><br><span class="line">  <span class="comment">//     minChunks: 2,</span></span><br><span class="line">  <span class="comment">//     chunks: ['pageA','pageB'] //有bug，这样可以解决</span></span><br><span class="line">  <span class="comment">//   &#125;),</span></span><br><span class="line">  <span class="comment">//   new webpack.optimize.CommonsChunkPlugin(&#123;  //打包lodash</span></span><br><span class="line">  <span class="comment">//     names: ['vendor', 'manifest'],</span></span><br><span class="line">  <span class="comment">//     minChunks: Infinity</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="处理css"><a href="#处理css" class="headerlink" title="处理css"></a>处理css</h1><h2 id="1-style-loader"><a href="#1-style-loader" class="headerlink" title="1. style-loader"></a><strong>1. style</strong>-loader</h2><p>创建标签，如何把css放到html中</p><p>style-loader<br>style-loader/url<br>style-loader/useable</p><p>style-loader<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span> <span class="comment">//这种常用</span></span><br><span class="line">            <span class="comment">//loader: 'style-loader/url'  //这种方法比较小众，大家了解就好了</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span> <span class="comment">//这种常用</span></span><br><span class="line">            <span class="comment">//loader: 'file-loader' //这种方法比较小众，大家了解就好了，这里还要安装file-loader</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>style-loader/useable<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'style-loader/useable'</span> </span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span> </span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>app.js</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import base from <span class="string">'./css/base.css'</span></span><br><span class="line"> </span><br><span class="line">base.use() //引入</span><br><span class="line">base.unuse() //删除</span><br></pre></td></tr></table></figure><hr><p>配置选项</p><ul><li>options<ul><li>insertAt(插入位置)</li><li>insertInto(插入到dom)</li><li>singleton(是否使用一个style标签)</li><li>transform (转化，浏览器环境下，插入页面前)<br>webpack.config.js<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.css/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'style-loader'</span>, </span><br><span class="line">          options: &#123;</span><br><span class="line">            insertInto: <span class="string">'#app'</span>,</span><br><span class="line">            singleton: <span class="literal">true</span>,</span><br><span class="line">            transform: <span class="string">'./css.transform.js'</span>  </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'css-loader'</span> </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>css.transform.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function (css) &#123;</span><br><span class="line">  console.log(css)</span><br><span class="line">  return css</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-css-loader"><a href="#2-css-loader" class="headerlink" title="2. css-loader"></a>2. css-loader</h2><p>如何让js一个import引入css<br>怎么使用呢，去官方看，老师教的那个minimze已经弃用了<br>中文官网还是很久之前的文档，所以这里是英文的<br><a href="https://webpack.js.org/loaders/css-loader/#localidentname" target="_blank" rel="noopener">css-loader</a><br>配置选项</p><ul><li>options<ul><li>alias (解析的别名)</li><li>importLoader (@import)</li><li>Minimze(是否压缩)</li><li>modules (启用css-modules)</li></ul></li></ul><h2 id="3-css-modules-css模块化"><a href="#3-css-modules-css模块化" class="headerlink" title="3. css-modules css模块化"></a>3. css-modules css模块化</h2><ul><li>:local 可以给定一个本地的样式</li><li>:global 可以给定一个全局的样式</li><li>compose 可以继承一段样式</li><li>compose … from path 从某一个文件引入样式</li></ul><ol start="4"><li>less cass 3-12节<br>很简单只需要安装所需要的loader<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install less-loader less --save-dev</span><br><span class="line">npm install sass-loader node-sass --save-dev</span><br></pre></td></tr></table></figure></li></ol><p>编译less<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="提取css"><a href="#提取css" class="headerlink" title="提取css"></a>提取css</h1><p><strong>1. extract</strong>-loader</p><h2 id="2-ExtractTextWebpackPlugin-主流"><a href="#2-ExtractTextWebpackPlugin-主流" class="headerlink" title="2. ExtractTextWebpackPlugin 主流"></a>2. ExtractTextWebpackPlugin 主流</h2><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install extract-text-webpack-plugin</span><br></pre></td></tr></table></figure></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">          fallback: &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'css-loader'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'less-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'[name].min.css'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>提取出来的文件要自己引入到页面</p><h1 id="PostCSS"><a href="#PostCSS" class="headerlink" title="PostCSS"></a>PostCSS</h1><p>安装 ：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postcss</span><br><span class="line">postcss-loader</span><br><span class="line">Atuoprefixer <span class="comment">//帮助你写各个浏览器之间的前缀</span></span><br><span class="line">postcss-cssnano  <span class="comment">//帮助我们压缩css</span></span><br><span class="line">postcss-cssnext  <span class="comment">//使用最新的css语法：CSS Variables, custom selectors, calc()</span></span><br></pre></td></tr></table></figure></p><p>npm:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss postcss-loader autoprefixer cssnano postcss-cssnext</span><br></pre></td></tr></table></figure></p><p>本节的代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">          fallback: &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'css-loader'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'postcss-loader'</span>, <span class="comment">//引入的位置必须是css-loader之后，less预处理语音之前</span></span><br><span class="line">              options: &#123;</span><br><span class="line">                ident: <span class="string">'postcss'</span>, <span class="comment">//表明后面的插件是给postcss使用的</span></span><br><span class="line">                plugins: [</span><br><span class="line">                  <span class="comment">// require('autoprefixer')(),</span></span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)()  <span class="comment">//这个里面包含了autoprefixer</span></span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'less-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'[name].min[hash:5].css'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="browserslist"><a href="#browserslist" class="headerlink" title="browserslist:"></a>browserslist:</h2><p>所有插件共用<br>package.json<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"browserslist"</span>: [</span><br><span class="line">  <span class="string">"&gt;= 1%"</span>,</span><br><span class="line">  <span class="string">"last 2 versions"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>.browserslistrc</p><hr><p>postcss-import<br>postcss-url<br>postcss-assets<br>后面会讲到</p><h1 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h1><p>Webpack.optimize.uglifyJs<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin()</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></p><p>lodash 要借助别的插件才可以完成Tree Shaking<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-plugin-lodash --save-dev</span><br><span class="line">npm install babel-loader babel-core babel-preset-env</span><br></pre></td></tr></table></figure></p><p>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'env'</span>],</span><br><span class="line">            plugins: [<span class="string">'lodash'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>新建了个ces文件夹，明天里面搞</p><p>找到问题了，如果用babel 6就要安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader@7 babel-core babel-preset-env css-loader@1 //css-loader是上节用的</span><br></pre></td></tr></table></figure></p><p>安装babel 7<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader @babel/core @babel/preset-env css-loader //新版本方便</span><br></pre></td></tr></table></figure></p><p>本节代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'env'</span>],</span><br><span class="line">            plugins: [<span class="string">'lodash'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;  </span><br><span class="line">      names: [<span class="string">'manifest'</span>], <span class="comment">//manifest打包的是webpack公用代码</span></span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin() <span class="comment">//Tree Shaking，Webpack.optimize.uglifyJs</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="CSS-Tree-Shaking"><a href="#CSS-Tree-Shaking" class="headerlink" title="CSS Tree Shaking"></a>CSS Tree Shaking</h1><h2 id="Purify-CSS"><a href="#Purify-CSS" class="headerlink" title="Purify CSS"></a>Purify CSS</h2><p>很多打包工具都可以用，比如gulp<br>针对webpack，purifycss-webpack </p><ul><li>options<ul><li>paths: glob.sync([])</li><li><code>npm install glob-all --save-dev</code> //处理多路径</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install purifycss-webpack glob-all</span><br></pre></td></tr></table></figure><p>新版本还要安装purify-css<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install purify-css</span><br></pre></td></tr></table></figure></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> Purifycss = <span class="built_in">require</span>(<span class="string">'purifycss-webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> glob = <span class="built_in">require</span>(<span class="string">'glob-all'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">          fallback: &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'css-loader'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'postcss-loader'</span>, <span class="comment">//引入的位置必须是css-loader之后，less预处理语音之前</span></span><br><span class="line">              options: &#123;</span><br><span class="line">                ident: <span class="string">'postcss'</span>, <span class="comment">//表明后面的插件是给postcss使用的</span></span><br><span class="line">                plugins: [</span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(),</span><br><span class="line">                  <span class="comment">// require('postcss-cssnext')()  //这个里面包含了autoprefixer</span></span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'less-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'env'</span>],</span><br><span class="line">            plugins: [<span class="string">'lodash'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        exclude: <span class="string">'/node_modules'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'[name].min[hash:5].css'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> Purifycss(&#123;</span><br><span class="line">      paths: glob.sync([</span><br><span class="line">        path.join(__dirname, <span class="string">'./*.html'</span>) <span class="comment">//本节代码</span></span><br><span class="line">      ])</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h1><h2 id="1-图片处理"><a href="#1-图片处理" class="headerlink" title="1. 图片处理"></a>1. 图片处理</h2><p>css中引入的图片<br>file-loader</p><p>自动合成雪碧图，减少http请求<br>postcss-sprites</p><p>压缩图片<br>img-loader<br>小图片可以使用Base64编码<br>url-loader</p><p>字体文件</p><p>第三方js库 CDN地址</p><h2 id="首先安装前面所提到的模块"><a href="#首先安装前面所提到的模块" class="headerlink" title="首先安装前面所提到的模块"></a>首先安装前面所提到的模块</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install file-loader url-loader img-loader postcss-sprites</span><br><span class="line">//放到一起安装会出错?有毒,多安装两遍就好了，postcss-sprites单独安装</span><br></pre></td></tr></table></figure><p>新版本还要安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin imagemin-mozjpeg</span><br></pre></td></tr></table></figure></p><p>研究了一小时的bug，原来是我的图片有问题，哔了狗，500px下的图片。。。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'imagemin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">          fallback: &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'css-loader'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'less-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(jpe?g|png|gif|svg)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">/*&#123; // file-loader 把图片打包</span></span><br><span class="line"><span class="comment">            loader: 'file-loader',</span></span><br><span class="line"><span class="comment">            options: &#123;</span></span><br><span class="line"><span class="comment">              name: '[name].img.[hash:5].[ext]',</span></span><br><span class="line"><span class="comment">              outputPath: 'assets',</span></span><br><span class="line"><span class="comment">              publicPath: 'assets'</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          &#125;*/</span></span><br><span class="line">          &#123; <span class="comment">//可以将图片转换为bash64编码格式，厉害了，而且配置项和file-loader一样</span></span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10000</span>,</span><br><span class="line">              name: <span class="string">'[name].img.[hash:5].[ext]'</span>,</span><br><span class="line">              outputPath: <span class="string">'assets'</span>,</span><br><span class="line">              publicPath: <span class="string">'assets'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, </span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"img-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              plugins: [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">"imagemin-mozjpeg"</span>)(&#123;</span><br><span class="line">                  quality: <span class="number">30</span> <span class="comment">// the quality of zip</span></span><br><span class="line">                &#125;)</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'[name].min.css'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要另外安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i imagemin-webp imagemin-svgo imagemin-mozjpeg imagemin-pngquant imagemin-optipng imagemin-gifsicle imagemin cwebp-bin</span><br></pre></td></tr></table></figure></p><p>其中webp打包的时候报过一个错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR in ./src/css/base.less</span><br><span class="line">Module build failed: ModuleBuildError: Module build failed: Error: spawn /mnt/f/webpack/4-1/node_modules/cwebp-bin/vendor/cwebp ENOENT</span><br></pre></td></tr></table></figure></p><p>安装cwebp-bin解决<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cwebp-bin</span><br></pre></td></tr></table></figure></p><p>使用images-webapack-loader</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  loader: <span class="string">"image-webpack-loader"</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    mozjpeg: &#123;</span><br><span class="line">      quality: <span class="number">30</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// optipng.enabled: false will disable optipng</span></span><br><span class="line">    optipng: &#123;</span><br><span class="line">      enabled: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    pngquant: &#123;</span><br><span class="line">      quality: <span class="string">'65-90'</span>,</span><br><span class="line">      speed: <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    gifsicle: &#123;</span><br><span class="line">      interlaced: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    webp: &#123; <span class="comment">// 转换为webp格式文件</span></span><br><span class="line">      quality: <span class="number">60</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没搞懂webp是干什么的<br>好像webp没什么用啊，头疼</p><blockquote><p>2019年3月8日02:15:55 说一下搭建webpack 4 中使用image-webpack-loader遇到的坑：安装这个插件的时候我退出了一下导致很多类似于上面的*-bin文件没有安装，而且卸载这个插件重新安装也不会装这些东西，不知道是什么坑,解决办法就是去别的目录重新执行此命令看少装了什么，重新npm i 安装即可</p></blockquote><h2 id="imagemin-pngquant-压缩png图片"><a href="#imagemin-pngquant-压缩png图片" class="headerlink" title="imagemin-pngquant 压缩png图片"></a>imagemin-pngquant 压缩png图片</h2><p>嗯，bug出现的问题是npm安装的时候我退出了，要安装个什么pngquant-bin,前面那个webp-bin也是我自己退出了，毕竟以前没遇到过这种问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pngquant-bin</span><br></pre></td></tr></table></figure></p><p>还有就是压缩图片还要用上file-loader,url-loader</p><h2 id="postcss-sprites-雪碧图"><a href="#postcss-sprites-雪碧图" class="headerlink" title="postcss-sprites 雪碧图"></a>postcss-sprites 雪碧图</h2><p>这个是postcss的一个雪碧图插件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    ident: <span class="string">'postcss'</span>,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="built_in">require</span>(<span class="string">'postcss-sprites'</span>)(), <span class="comment">//雪碧图</span></span><br><span class="line">      <span class="comment">//Atuoprefixer 帮助你写各个浏览器之间的前缀</span></span><br><span class="line">      <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)()  <span class="comment">//使用最新的css语法，这个里面包含了autoprefixer</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="本节代码："><a href="#本节代码：" class="headerlink" title="本节代码："></a>本节代码：</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> ExtractTextWebpackPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'imagemin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'./dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class="line">          fallback: &#123;</span><br><span class="line">            loader: <span class="string">'style-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              singleton: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          use: [</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'css-loader'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                ident: <span class="string">'postcss'</span>,</span><br><span class="line">                plugins: [</span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">'postcss-sprites'</span>)(),</span><br><span class="line">                  <span class="comment">// require('postcss-sprites')(),</span></span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)()</span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              loader: <span class="string">'less-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(gif|png|jpe?g|svg)$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">/*&#123; // file-loader 把图片打包</span></span><br><span class="line"><span class="comment">            loader: 'file-loader',</span></span><br><span class="line"><span class="comment">            options: &#123;</span></span><br><span class="line"><span class="comment">              name: '[name].img.[hash:5].[ext]',</span></span><br><span class="line"><span class="comment">              outputPath: 'assets',</span></span><br><span class="line"><span class="comment">              publicPath: 'assets'</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          &#125;*/</span></span><br><span class="line">          &#123; <span class="comment">//可以将图片转换为bash64编码格式，厉害了，而且配置项和file-loader一样</span></span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">100</span>,</span><br><span class="line">              name: <span class="string">'[name].img.[hash:5].[ext]'</span>,</span><br><span class="line">              outputPath: <span class="string">'assets'</span>,</span><br><span class="line">              publicPath: <span class="string">'assets'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, </span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"img-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              <span class="comment">/*plugins: [</span></span><br><span class="line"><span class="comment">                // require("imagemin-mozjpeg")(&#123;  //压缩jpg</span></span><br><span class="line"><span class="comment">                //   quality: 60 // the quality of zip</span></span><br><span class="line"><span class="comment">                // &#125;),</span></span><br><span class="line"><span class="comment">                // require("imagemin-webp")(&#123;  //压缩为webp</span></span><br><span class="line"><span class="comment">                //   quality: 80 // the quality of zip</span></span><br><span class="line"><span class="comment">                // &#125;)</span></span><br><span class="line"><span class="comment">              ]*/</span></span><br><span class="line">                plugins: [</span><br><span class="line">                  <span class="built_in">require</span>(<span class="string">"imagemin-pngquant"</span>)(&#123;</span><br><span class="line">                    quality: [<span class="number">0.6</span>, <span class="number">0.7</span>]</span><br><span class="line">                  &#125;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextWebpackPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'[name].min.css'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="字体文件"><a href="#字体文件" class="headerlink" title="字体文件"></a>字体文件</h1><p><code>file-loader</code> 这个或 <code>url-loader</code> 都可以<br>很简单，新加配置项<br>这个就是这部分添加的，完整文件参考上面<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(eot|svg|ttf|woff?)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'url-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        limit: <span class="number">1000</span>,</span><br><span class="line">        name: <span class="string">'[name].font.[hash:6].[ext]'</span>,</span><br><span class="line">        outputPath: <span class="string">'assets'</span>,</span><br><span class="line">        publicPath: <span class="string">'assets'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="第三方库"><a href="#第三方库" class="headerlink" title="第三方库"></a>第三方库</h1><p><code>webpack.providePlugin</code><br><code>imports-loader</code><br><code>window</code><br>全局注入<code>npm</code>模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plugins: &#123;</span><br><span class="line">  new webpack.ProvidePlugin(&#123;</span><br><span class="line">    $: &apos;jquery&apos; //这里的模块就可以全局注入，</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果npm没有安装这个模块，但是本地有，就可以这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      alias: &#123;</span><br><span class="line">        jquery$: path.resolve(__dirname, &apos;src/jquery.min.js&apos;)</span><br><span class="line">        //这个$不知道干啥的</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="webpack-处理-html文件"><a href="#webpack-处理-html文件" class="headerlink" title="webpack 处理 html文件"></a>webpack 处理 html文件</h1><h2 id="自动生成HTML-场景优化"><a href="#自动生成HTML-场景优化" class="headerlink" title="自动生成HTML , 场景优化"></a>自动生成HTML , 场景优化</h2><p><code>HtmlWebpackPlugin</code> 插件简介</p><ul><li><code>options</code><ul><li><code>template</code> 这个项目的模板文件所在位置，我们的html就在根目录</li><li><code>filename</code> 指定输出目录，目录，文件名，都可以</li><li><code>minify</code> 是否压缩生成html文件</li><li><code>chunks</code> 指定entry的chunk，不然的话多页面应用就会把所有的加进来</li><li><code>inject</code> 这个默认是true，改为false就是手动插入</li></ul></li></ul><p>安装 HtmlWebpackPlugin<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure></p><p>webpack.config.json 文件写入<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>) <span class="comment">//头部引入</span></span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'index.html'</span>, <span class="comment">//目录，文件名，都可以</span></span><br><span class="line">    template: <span class="string">'./index.html'</span>, <span class="comment">//这个项目的模板文件所在位置，我们的html就在根目录</span></span><br><span class="line">    <span class="comment">//inject: false ,//这个默认是true，改为false就是手动插入</span></span><br><span class="line">    chunks: [<span class="string">'app'</span>], <span class="comment">//指定entry的chunk，不然的话多页面应用就会把所有的加进来</span></span><br><span class="line">    minify: &#123; <span class="comment">//借助了第三方实现html-minify</span></span><br><span class="line">    collapseWhitespace: <span class="literal">true</span> <span class="comment">//去除空格</span></span><br><span class="line">  &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>//顺便还要去除，output中的路径，因为index文件到同级目录了，所以就不用增加这段代码了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  ~~publicPath: <span class="string">'./dist/'</span>,~~</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h1 id="HTML中引入的图片"><a href="#HTML中引入的图片" class="headerlink" title="HTML中引入的图片"></a>HTML中引入的图片</h1><ul><li><code>html-loader</code></li><li><code>options</code> 选项<ul><li>attrs: [img: src] img表示html标签，右边表示属性</li></ul></li></ul><p>安装<code>html-loader</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-loader</span><br></pre></td></tr></table></figure></p><p>index.html：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">data-src</span>=<span class="string">""</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>webpack.config.json:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'html-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            attrs: [<span class="string">'img:src'</span>, <span class="string">'img:data-src'</span>]<span class="comment">//默认是img:src,如果有其他需求可以增加</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125; </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>更改，删除的地方<br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  publicPath: <span class="string">'/'</span> <span class="comment">//修改为根路径</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//其他的publicPath全部删除即可，这一个就ok了，以前因为没有打包index.html所以才很麻烦</span></span><br></pre></td></tr></table></figure></p><p>即使没有html-loader,还可以用require的方式引入图片<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">'$&#123;require("./src/assets/imgs/2.jpg)"&#125;'</span> <span class="attr">alt</span>=<span class="string">"图片2"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="配合优化-提前载入webpack加载代码，减少http请求"><a href="#配合优化-提前载入webpack加载代码，减少http请求" class="headerlink" title="配合优化(提前载入webpack加载代码，减少http请求)"></a>配合优化(提前载入webpack加载代码，减少http请求)</h1><p><code>inline-manifest-webpack-plugin</code> 把webpack生成的代码插入页面，和html-loader配合的时候会有bug，所以就学习第二种</p><p><code>html-webpack-inline-chunk-plugin</code> 通过这个插件可以选择各种各样的chunk，然后插入到页面中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-inline-chunk-plugin --save-dev</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader @babel/core @babel/preset-env --dev</span><br></pre></td></tr></table></figure><p>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">      &#123; <span class="comment">//位置是最顶部，不知道放到后面会有影响不</span></span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>, </span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>],</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">var</span> HtmlInlinkChunkPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-inline-chunk-plugin'</span>)</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'manifest'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlInlinkChunkPlugin(&#123;</span><br><span class="line">      inlineChunks: [<span class="string">'manifest'</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><h1 id="5-1-搭建开发环境"><a href="#5-1-搭建开发环境" class="headerlink" title="5-1 搭建开发环境"></a>5-1 搭建开发环境</h1><p> <strong>webpack watch mode</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webpack -watch</span><br><span class="line">webpack -w</span><br></pre></td></tr></table></figure></p><p>安装一个自动清除目录的工具<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin</span><br></pre></td></tr></table></figure></p><p>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist'</span>]) <span class="comment">//这里是要清除的目录</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>使用<code>webpack -w</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack -w --progress --display-reasons --color</span><br></pre></td></tr></table></figure></p><ul><li>progress 运行的过程</li></ul><h2 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a><strong>webpack-dev-server</strong></h2><p><strong>官方提供的开发服务器</strong></p><ul><li>live reloading 项目变化帮你刷新浏览器</li><li>打包文件？NO<ul><li>是在运行的内存中，所以还是需要自己打包</li></ul></li><li>路径重定向<ul><li>没有理解</li></ul></li><li>https 支持</li><li>浏览器中显示编译错误，很有用</li><li>接口代理</li><li>模块热更新<ul><li>不刷新浏览器的情况下，更新代码，这个厉害了</li></ul></li></ul><p><strong>配置</strong></p><ul><li>devServer <ul><li>inline</li><li>contentBase </li><li>port</li><li>historyApiFallback</li><li>https</li><li>proxy</li><li>hot 模块热更新，还要写额外代码</li><li>openpage 指定最先打开的页面</li><li>lazy 启动的时候不会打包任何东西，只有访问的时候才会打包</li><li>overlay 遮罩，错误提示</li></ul></li></ul><p><strong>开始使用</strong></p><p>安装<code>webpack-dev-server</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server@2 //3以上需要webpack@4支持，所以这里要降级</span><br></pre></td></tr></table></figure></p><p>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port : <span class="number">9001</span> <span class="comment">//指定端口</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>package.json<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts" : &#123;</span><br><span class="line">  "start:dev": "webpack-dev-server --open"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>命令行执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run start:dev</span><br></pre></td></tr></table></figure></p><p>不配置package.json，可以这样<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./node_modules/.bin/webpack-dev-server</span><br></pre></td></tr></table></figure></p><p><strong>原来package.json script里面找模块是从node_modules中查找的，这是npm的查找规则决定的</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    <span class="comment">// inline: false, //目前用不到</span></span><br><span class="line">    <span class="comment">// historyApiFallback: true, //嗯，目前用不到，用到再说</span></span><br><span class="line">    port: <span class="number">9001</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Proxy-代理远程接口请求"><a href="#Proxy-代理远程接口请求" class="headerlink" title="Proxy 代理远程接口请求"></a><strong>Proxy</strong> 代理远程接口请求</h2><p>自己集成了http-proxy-middleware</p><ul><li>options<ul><li>target 指定代理地址</li><li>changeOrigin 改变源，到你的url</li><li>headers 增加http请求头，</li><li>logLevel 帮助调试，显示代理情况</li><li>pathRewrite 帮助重定向</li></ul></li></ul><p><strong>使用</strong><br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/comments'</span> : &#123; <span class="comment">//匹配地址，凡是遇到/comments的都会被转为下面的路径</span></span><br><span class="line">      target: <span class="string">'https://m.weibo.com'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span> </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      $: <span class="string">'jquery'</span> <span class="comment">//这里的模块就可以全局注入</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>app.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">'/comments/hotflow'</span>, &#123; <span class="comment">//微博评论接口，这里$.get自然是jquery了</span></span><br><span class="line">  id : <span class="number">4331316696337556</span>,</span><br><span class="line">  mid : <span class="number">4331316696337556</span>,</span><br><span class="line">  max_id_type : <span class="number">0</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data.data.data) <span class="comment">//到这里就可以结束了，下面的只是插入页面</span></span><br><span class="line">  <span class="keyword">var</span> msg = data.data.data</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; msg.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg[i].text)</span><br><span class="line">    $(<span class="string">'.pl'</span>).append(<span class="string">"&lt;div&gt;"</span> + msg[i].text + <span class="string">"&lt;div/&gt;"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><strong>其他配置项</strong><br>headers</p><p>app.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">'/msg/index'</span>, &#123;</span><br><span class="line">  format: <span class="string">'cards'</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>以上写法，微博会有验证，无法通过，可以用proxy发送头信息<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/'</span> : &#123; <span class="comment">//匹配地址，凡是遇到/comments的都会被转为下面的路径</span></span><br><span class="line">      target: <span class="string">'https://m.weibo.com'</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span> ,</span><br><span class="line">      headers: &#123; <span class="comment">//发送头信息，这里的cookie是微博的验证</span></span><br><span class="line">        <span class="string">'Cookie'</span>: <span class="string">'ALF=1550807798; SCF=Ajv5Mdqcv9zNmq8TEe8b9Jd5bIERX_ZZAEkFyb_x_x5DdNtQFxGLsekcUUeJ5LOavTb_ruqz1FbarpstC8U9w8o.; SUB=_2A25xQ4KVDeRhGeVJ41IW8i7Kwj-IHXVSzy7drDV6PUJbktAKLU7lkW1NT8d4sQ6RoEu17F8RbjIXYg74GYrrPENl; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WFe-YDR22UIh60JG0EfcL8h5JpX5K-hUgL.FoeN1h5Neo5c1Ke2dJLoIEYLxKnL1heLB.BLxKMLB-eL1K2LxK-LBo5LBo8bUCH81FHWSb-ReCH8SC-4eEHWx5tt; SUHB=0LcilU3V_eaMdU; SSOLoginState=1548219077; MLOGIN=1; _T_WM=60e134ae82c5c5d1a5652f6a212d78f0; WEIBOCN_FROM=1110003030; XSRF-TOKEN=4d3335; M_WEIBOCN_PARAMS=luicode%3D10000011%26lfid%3D100505102803%26uicode%3D10000011%26fid%3D102803'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>pathRewrite<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/'</span> : &#123;  <span class="comment">//直接匹配/</span></span><br><span class="line">        target: <span class="string">'https://m.weibo.com'</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span> ,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">      <span class="string">'^/comments'</span> : <span class="string">'/api/comments'</span> <span class="comment">//把/comments的地址都替换，不过我的这个案例没用使用，和前面app.js例子会出问题</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Module-Hot-Reloading"><a href="#Module-Hot-Reloading" class="headerlink" title="Module Hot Reloading"></a><strong>Module Hot Reloading</strong></h2><p><strong>模块热更新</strong><br>保持应用的数据状态<br>节省调试时间<br>样式调试更快</p><p><strong>devServer,已经集成，直接使用</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>除此之外还要使用<br><code>webpack.HotModuleReplacementPlugin</code><br>想清晰看到模块的相对路径可以使用<br><code>webpack.NamedModulesPlugin</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  <span class="keyword">new</span> webpack.NamedModulesPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>如果js需要热加载，就要自己去写规则，vue，angular这种框架的loader都写好了，自己写页面感觉没必要</p><ul><li>module.hot</li><li>module.hot.accept</li><li>module.hot.decline</li></ul><p>app.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;  <span class="comment">//简单的用法，引入其他模块还要增加代码</span></span><br><span class="line">  <span class="built_in">module</span>.hot.accept()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="express-webpack-dev-middleware"><a href="#express-webpack-dev-middleware" class="headerlink" title="express+webpack-dev-middleware"></a><strong>express+webpack-dev-middleware</strong></h2><h1 id="Source-Map调试"><a href="#Source-Map调试" class="headerlink" title="Source Map调试"></a>Source Map调试</h1><p>主要就是帮你定位代码的位置，比如打包后就变成一行，启用Devtool就可以定位到要调试代码的位置<br>插件(更加灵活):<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webpack.SouceMapDevToolPlugin</span><br><span class="line">webpack.EvalSourceMapDevToolPlugin</span><br></pre></td></tr></table></figure></p><p><strong>Devtool</strong><br>Development(开发环境使用)</p><ul><li>options<ul><li>eval</li><li>eval-source-map</li><li>cheap-eval-source-map</li><li>cheap-module-eval-source-map</li></ul></li></ul><p>Production(生产环境下)</p><ul><li>options<ul><li>source-map</li><li>hidden-source-map</li><li>nosource-source-map</li></ul></li></ul><p>每个选项的生成时间都不同</p><p><strong>css使用source-map注意</strong><br>除了开启source-map之外，每个css-loader都要启用<code>options.sourceMap = true</code></p><p><strong>使用source-map</strong><br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//devtool: 'eval', 这个速度最快但是看到的文件不够清晰，会带有webpack自己的代码</span></span><br><span class="line">  <span class="comment">//devtool: 'source-map', //这个虽然耗时，不过还行</span></span><br><span class="line">  devtool: <span class="string">'cheap-module-source-map'</span> <span class="comment">//感觉这个和source-map区别不大，估计还没遇到问题把</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果开启最小化代码<code>new webpack.optimize.UglifyJsPlugin()</code>就会出现问题，课程是暂时注释</p><p>css用到的loader都要开启sourceMap<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  loader: <span class="string">'css-loader'</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    sourceMap: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>有个style-loader的bug，就是开启<code>singleton: true</code> 开启sourceMap还是不行，新版style-loader已经修复，我没有这个问题</p><h1 id="Eslint-检查代码格式"><a href="#Eslint-检查代码格式" class="headerlink" title="Eslint 检查代码格式"></a>Eslint 检查代码格式</h1><p>所需要的插件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eslint</span><br><span class="line">eslint-loader</span><br><span class="line">eslint-plugin-html  处理html里面的script</span><br><span class="line">eslint-friendly-formatter  友好的看到输出错误</span><br></pre></td></tr></table></figure></p><p>配置<br>webpack config<br>.eslintrc.*<br>package.json 中的 eslintConfig<br>使用那种方式验证eslint<br><a href="https://standardjs.com/" target="_blank" rel="noopener">JavaScript Standard Style</a><br>需要的插件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eslint-config-standard</span><br><span class="line">eslint-plugin-promise</span><br><span class="line">eslint-plugin-standard</span><br><span class="line">eslint-plugin-<span class="keyword">import</span></span><br><span class="line">eslint-plugin-node</span><br></pre></td></tr></table></figure></p><p>如果不使用这个插件可以去github搜<code>eslint-config-xxx</code></p><ul><li>eslint-loader使用注意<ul><li>options.failOnWarning 设为true，如果有错误就不会通过编译</li><li>options.failOnError 定义验证错误不会通过编译</li><li>options.formatter </li><li>options.outputReport</li></ul></li><li>devServer.overlay 开启后就可以在浏览器中看到错误</li></ul><p><strong>开始使用</strong><br>安装需要的模块<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint eslint-loader eslint-plugin-html eslint-friendly-formatter --save-dev</span><br></pre></td></tr></table></figure></p><p>增加配置代码<br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          <span class="comment">//include: [path.resolve(__dirname, 'src')],</span></span><br><span class="line">          <span class="comment">//exclude: [path.resolve(__dirname, 'src/lib')]</span></span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; <span class="comment">//必须添加到babel-loader之后</span></span><br><span class="line">          loader: <span class="string">'eslint-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            formatter: <span class="built_in">require</span>(<span class="string">'eslint-friendly-formatter'</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>.eslintrc.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>, <span class="comment">//表面自己是根目录</span></span><br><span class="line">  extends: <span class="string">'standard'</span>, <span class="comment">//使用standard的标准</span></span><br><span class="line">  plugins: [],</span><br><span class="line">  env: &#123; <span class="comment">//环境</span></span><br><span class="line">    browser: <span class="literal">true</span>, <span class="comment">//浏览器环境</span></span><br><span class="line">    node: <span class="literal">true</span> <span class="comment">//node环境</span></span><br><span class="line">  &#125;,</span><br><span class="line">  globals: &#123;</span><br><span class="line">    $: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123; <span class="comment">//可以覆盖standard的标准，自定义自己的规则</span></span><br><span class="line">    <span class="comment">//indent: ['error', 4] //将缩进自定义为4个空格 </span></span><br><span class="line">    <span class="comment">//'eol-last': ['error', 'never'] //结尾需要换行取消</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>安装<code>standard</code>所需模块<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint-config-standard eslint-plugin-promise eslint-plugin-node eslint-plugin-import eslint-plugin-standard --save-dev</span><br></pre></td></tr></table></figure></p><p>个人觉得这个显示到html页面上的错误有点难看，不知道vue-cli使用的是什么</p><h1 id="开发环境和生产环境"><a href="#开发环境和生产环境" class="headerlink" title="开发环境和生产环境"></a>开发环境和生产环境</h1><p>需求分析：<br><strong>开发环境</strong><br>模块热更新<br>sourceMap<br>接口代理<br>代码规范检查<br><strong>生产环境</strong><br>提取公用代码<br>压缩混淆<br>文件压缩或Base64 编码<br>去除无用的代码</p><p><strong>共同点</strong><br>同样的入口<br>同样的代码处理(loader处理) 所有loader<br>同样的解析配置 开发和打包的一致性</p><p><strong>如何区分呢</strong><br>就是webpack-merge</p><p>webpack.dev.conf.js  //开发环境<br>webpack.prod.conf.js  //生产环境<br>webpack.common.conf.js  //共同点</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/webpack/webpack/releases&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;webpack版本更迭&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://webpack.js.org/vote&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;社区投票&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://webpack.docschina.org/concepts/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="webpack" scheme="demoorbug.github.io/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>ss</title>
    <link href="demoorbug.github.io/2018/12/22/ss/"/>
    <id>demoorbug.github.io/2018/12/22/ss/</id>
    <published>2018-12-22T22:08:33.000Z</published>
    <updated>2021-05-07T18:17:13.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="bbr-kcptun-ss-搭建（ubuntu14）"><a href="#bbr-kcptun-ss-搭建（ubuntu14）" class="headerlink" title="bbr+kcptun+ss 搭建（ubuntu14）"></a>bbr+kcptun+ss 搭建（ubuntu14）</h1><p>kcptun 待验证</p><h2 id="1-bbr-开启可以有效提高网速"><a href="#1-bbr-开启可以有效提高网速" class="headerlink" title="1. bbr 开启可以有效提高网速"></a>1. bbr 开启可以有效提高网速</h2><p><code>sudo apt-get update</code>  //更新源<br><code>sudo apt-get upgrade</code>  //升级系统</p><h2 id="2-开启bbr"><a href="#2-开启bbr" class="headerlink" title="2. 开启bbr"></a>2. 开启bbr</h2><ul><li>下载内核<ul><li><code>wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.14.12/linux-image-4.14.12-041412-generic_4.14.12-041412.201801051649_amd64.deb</code></li></ul></li><li>内核安装<br>-<code>dpkg -i linux-image-4.*.deb</code></li><li>查看内核版本<br><code>dpkg -l | grep linux-image</code></li><li>删除旧内核,除4.<code>*</code>版本外全部删除即可<ul><li><code>apt-get purge 旧内核</code></li></ul></li><li>更新grub系统引导文件并重启<ul><li><code>update-grub</code></li></ul></li><li>重启服务器<ul><li><code>reboot</code></li></ul></li></ul><h2 id="3-开机后开启bbr"><a href="#3-开机后开启bbr" class="headerlink" title="3. 开机后开启bbr"></a>3. 开机后开启bbr</h2><ul><li>查看内核 ≥ 4.9<ul><li>uname -r</li></ul></li><li>执行<ul><li><code>echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf</code></li><li><code>echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt; /etc/sysctl.conf</code></li></ul></li><li>保存生效<ul><li><code>sysctl -p</code></li></ul></li><li>执行<ul><li><code>sysctl net.ipv4.tcp_available_congestion_control</code></li><li><code>sysctl net.ipv4.tcp_congestion_control</code></li><li>如果结果都有bbr，证明内核已开启bbr</li></ul></li><li>执行<ul><li><code>lsmod | grep bbr</code></li><li>看到 tcp_bbr 模块即说明 bbr 已启动</li></ul></li></ul><p>还可以继续安装kcptun，不过上面的足以日常使用，不喜欢折腾的就不用搞</p><h2 id="4-搭建ss"><a href="#4-搭建ss" class="headerlink" title="4. 搭建ss"></a>4. 搭建ss</h2><ul><li>安装<ul><li><code>apt install python3-pip</code></li><li><code>pip3 install setuptools</code></li><li><code>pip3 install distribute</code></li><li><code>pip3 install shadowsocks</code></li></ul></li><li>添加ss配置文件<ul><li>vi /etc/shadowsocks.json<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;server&quot;:&quot;替换为你服务器ip地址&quot;,  </span><br><span class="line">&quot;server_port&quot;:端口,</span><br><span class="line">&quot;local_port&quot;:1080,</span><br><span class="line">&quot;password&quot;:&quot;密码&quot;,</span><br><span class="line">&quot;timeout&quot;:600,</span><br><span class="line">&quot;method&quot;:&quot;aes-256-cfb&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>将里面的内容为中文的部分替换为相应的值</p><ul><li>开启ss服务<ul><li><code>ssserver -c /etc/shadowsocks.json -d start</code></li></ul></li></ul><p><strong>到这里就可以结束了，后续的我自己没搞定，参考</strong></p><h2 id="5-kcptun配置"><a href="#5-kcptun配置" class="headerlink" title="5. kcptun配置"></a>5. kcptun配置</h2><ul><li>安装kcptun<ul><li><code>mkdir kcptun</code></li><li><code>cd kcptun</code></li><li><code>wget https://github.com/xtaci/kcptun/releases/download/v20170904/kcptun-linux-amd64-20170904.tar.gz</code></li><li><code>tar zxvf kcptun-linux-amd64-20170904.tar.gz</code></li><li><code>rm -f kcptun-linux-amd64-20170904.tar.gz</code></li></ul></li></ul><h2 id="6-开启-kcptun-服务"><a href="#6-开启-kcptun-服务" class="headerlink" title="6. 开启 kcptun 服务"></a>6. 开启 kcptun 服务</h2><ul><li><code>./server_linux_amd64 -t &quot;服务器ip:shadowsocks设置的端口&quot; -l &quot;:4001&quot; --key 密码 --log 4001.log &amp;</code><ul><li>&amp; 表示后台运行</li></ul></li></ul><h2 id="7-本地配置"><a href="#7-本地配置" class="headerlink" title="7. 本地配置"></a>7. 本地配置</h2><ul><li>下载相对应的客户端文件。（如上面server安装的是v20170904的kcptun，client就下载对应版本的）<ul><li><a href="https://github.com/xtaci/kcptun/releases?after=v20171129" target="_blank" rel="noopener">下载地址</a></li></ul></li><li><p>新建文件client.json</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;localaddr&quot;: &quot;:1082&quot;, //避免与本机占用的端口冲突即可</span><br><span class="line"></span><br><span class="line">&quot;remoteaddr&quot;: &quot;your server ip : kcptun 端口号&quot;, //对于上述配置是 x.x.x.x:4001</span><br><span class="line"></span><br><span class="line">&quot;key&quot;: &quot;kcptun密码&quot;, //server上kcptun设置的密码</span><br><span class="line"></span><br><span class="line">&quot;crypt&quot;: &quot;aes&quot;,</span><br><span class="line"></span><br><span class="line">&quot;mode&quot;: &quot;fast2&quot;,</span><br><span class="line"></span><br><span class="line">&quot;conn&quot;: 1,</span><br><span class="line"></span><br><span class="line">&quot;mtu&quot;: 1350,</span><br><span class="line"></span><br><span class="line">&quot;sndwnd&quot;: 512,</span><br><span class="line"></span><br><span class="line">&quot;rcvwnd&quot;: 512,</span><br><span class="line"></span><br><span class="line">&quot;nocomp&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建start.bat内容如下</p><ul><li><code>client_windows_amd64.exe -c client.json</code></li><li>将kcptun的文件client_windows_amd64.exe和新建的文件放到同一目录之下</li></ul></li></ul><h2 id="之前使用的方法"><a href="#之前使用的方法" class="headerlink" title="之前使用的方法"></a>之前使用的方法</h2><p>这种是一键安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget xiaofd.github.io/ruisu.sh &amp;&amp; bash ruisu.sh</span><br></pre></td></tr></table></figure></p><p>更换内核：</p><ol><li>查看内核<ul><li><code>uname -r</code></li></ul></li><li>安装新内核<ul><li><code>sudo apt-get install linux-image-extra-3.13.0-24-generic</code></li></ul></li><li>卸载其他内核<ul><li>查看系统现有内核<ul><li><code>dpkg -l|grep linux-image</code></li></ul></li><li>卸载列出的其他内核<ul><li><code>sudo apt-get purge linux-image-3.16.0-36-generic linux-image-extra-3.16.0-36-generic</code></li></ul></li></ul></li><li>更新grub系统引导文件并重启<ul><li><code>sudo update-grub</code></li><li><code>sudo reboot</code></li></ul></li></ol><p>速锐操作命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">service serverSpeeder start #启动</span><br><span class="line">service serverSpeeder stop #停止</span><br><span class="line">service serverSpeeder reload #重新加载配置</span><br><span class="line">service serverSpeeder restart #重启</span><br><span class="line">service serverSpeeder status #状态</span><br><span class="line">service serverSpeeder stats #统计</span><br><span class="line">service serverSpeeder renewLic #更新许可文件</span><br><span class="line">service serverSpeeder update #更新</span><br><span class="line">chattr -i /serverspeeder/etc/apx* &amp;&amp; /serverspeeder/bin/serverSpeeder.sh uninstall -f #卸载</span><br></pre></td></tr></table></figure></p><p>shadowsocks启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -c /etc/shadowsocks.json -d start</span><br><span class="line"></span><br><span class="line">后台运行：ssserver -c /etc/shadowsocks.json -d start</span><br><span class="line"></span><br><span class="line">后台停止：ssserver -c /etc/shadowsocks.json -d stop</span><br><span class="line"></span><br><span class="line">前台运行：ssserver -c /etc/shadowsocks/config.json</span><br></pre></td></tr></table></figure></p><!-- {"server":"","server_port":31241,"local_port":1080,"password":"@a1004041672A.@","timeout":600,"method":"aes-256-cfb"}./server_linux_amd64 -t ":31241" -l ":4001" --key "@a1004041672A.@" --log 4001.log --><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>ubuntu 16出现的问题</p><h2 id="Command-“python-setup-py-egg-info”-failed-with-error-code-问题"><a href="#Command-“python-setup-py-egg-info”-failed-with-error-code-问题" class="headerlink" title="Command “python setup.py egg_info” failed with error code 问题"></a>Command “python setup.py egg_info” failed with error code 问题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install setuptools</span><br><span class="line">pip install distribute</span><br></pre></td></tr></table></figure><p>我用这条命令之前还用了很多命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt-get remove python*</span><br><span class="line"></span><br><span class="line">apt-get install python python-pip</span><br><span class="line">// 如果pip用不了，则可以这样用</span><br><span class="line">python -m pip install 软件名</span><br><span class="line">// 或</span><br><span class="line">python -m pip install --upgrade --force pip // 这条命令好像式升级来着</span><br></pre></td></tr></table></figure></p><h2 id="pip升级后Import-Error-cannot-import-name-main解决方案"><a href="#pip升级后Import-Error-cannot-import-name-main解决方案" class="headerlink" title="pip升级后Import Error:cannot import name main解决方案"></a>pip升级后Import Error:cannot import name main解决方案</h2><p>方法1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/bin/pip3</span><br></pre></td></tr></table></figure></p><p>将原来的<br><code>from pip import main</code> 改为 <code>from pip._internal import main</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;bbr-kcptun-ss-搭建（ubuntu14）&quot;&gt;&lt;a href=&quot;#bbr-kcptun-ss-搭建（ubuntu14）&quot; class=&quot;headerlink&quot; title=&quot;bbr+kcptun+ss 搭建（ubuntu14）&quot;&gt;&lt;/a&gt;bbr+kcpt
      
    
    </summary>
    
      <category term="ss" scheme="demoorbug.github.io/categories/ss/"/>
    
    
      <category term="ubuntu" scheme="demoorbug.github.io/tags/ubuntu/"/>
    
      <category term="ss" scheme="demoorbug.github.io/tags/ss/"/>
    
      <category term="速锐" scheme="demoorbug.github.io/tags/%E9%80%9F%E9%94%90/"/>
    
  </entry>
  
  <entry>
    <title>vuesenior</title>
    <link href="demoorbug.github.io/2018/12/13/vuesenior/"/>
    <id>demoorbug.github.io/2018/12/13/vuesenior/</id>
    <published>2018-12-13T22:57:37.000Z</published>
    <updated>2021-05-07T18:17:13.741Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vue全家桶-SSR-Koa2全栈开发美团网"><a href="#vue全家桶-SSR-Koa2全栈开发美团网" class="headerlink" title="vue全家桶+SSR+Koa2全栈开发美团网"></a>vue全家桶+SSR+Koa2全栈开发美团网</h2><p>项目地址：<a href="https://github.com/DemoorBug/vuesenion" target="_blank" rel="noopener">vue全家桶+SSR+Koa2全栈开发美团网</a></p><h2 id="安装vue-cli"><a href="#安装vue-cli" class="headerlink" title="安装vue-cli"></a>安装vue-cli</h2><p>vue脚手架创建项目环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br><span class="line">vue -V</span><br><span class="line">vue create 项目名称</span><br></pre></td></tr></table></figure></p><p>查看项目remote<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br><span class="line">git remote remove &lt;name&gt;</span><br></pre></td></tr></table></figure></p><p>git 本地创建目录命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">线上创建项目</span><br><span class="line">mkdir 项目名称</span><br><span class="line"><span class="built_in">cd</span> 项目名称</span><br><span class="line">git init </span><br><span class="line">vi README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"上传简介"</span></span><br><span class="line">git remote add origin git@github.com:DemoorBug/vuesenior.git</span><br><span class="line"></span><br><span class="line">git push -u origin master      -u代表了关联本地分支和线上分支的master分支，以后就可以直接git push了</span><br></pre></td></tr></table></figure></p><h2 id="Koa2学习"><a href="#Koa2学习" class="headerlink" title="Koa2学习"></a>Koa2学习</h2><p>首先要装一个脚手架，我以前学node的时候老师用的express，今年这个koa2最火<br>koa-generator<br>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g koa-generator</span><br></pre></td></tr></table></figure></p><p>创建项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">koa2 project 默认是用这个引擎安装的</span><br><span class="line">想用e js引擎</span><br><span class="line">koa2 -e project</span><br></pre></td></tr></table></figure></p><p>运行项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd project</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure></p><h2 id="async和await语法"><a href="#async和await语法" class="headerlink" title="async和await语法"></a>async和await语法</h2><p>这就是prmis，的一个写法，很简单</p><h2 id="koa2中间件"><a href="#koa2中间件" class="headerlink" title="koa2中间件"></a>koa2中间件</h2><p>中间件一直是我没搞懂的</p><p><a href="https://koa.bootcss.com" target="_blank" rel="noopener">koa2_api</a></p><p>大致理解就是一个环，先进来，在出去都可以执行到我，<br>比如执行顺序是这样的:<br>m1<br>m2<br>m3<br>出去的执行顺序是这样的:<br>m3<br>m2<br>m1</p><p>所以谁前谁后执行无所谓，出去的时候还会自我检查，我的优先级会被提高</p><p>中间件代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pv</span> (<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">  global.console.log(<span class="string">'pv'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    pv(ctx)</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">    global.console.log(<span class="string">'pv end'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="koa路由"><a href="#koa路由" class="headerlink" title="koa路由"></a>koa路由</h2><h4 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h4><p>ctx.cookies.set(‘pvd’, Math.random())<br>ctx.cookies.get(‘pvd’)</p><h2 id="mongoose"><a href="#mongoose" class="headerlink" title="mongoose"></a>mongoose</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span>   搜索命令的命令。搜索命令所在路径及别名</span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> mongod</span><br></pre></td></tr></table></figure><p><a href="https://mongoose.shujuwajue.com/" target="_blank" rel="noopener">mongoose中文文档</a></p><h4 id="研究了一下windows下的mongodb启动，这里总结一下"><a href="#研究了一下windows下的mongodb启动，这里总结一下" class="headerlink" title="研究了一下windows下的mongodb启动，这里总结一下"></a>研究了一下windows下的mongodb启动，这里总结一下</h4><p>键入的命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath <span class="string">"f:\mo\data"</span> --logpath <span class="string">"f:\mo\log\db.log"</span> --install --serviceName <span class="string">"mongodb"</span> --logappend --directoryperdb</span><br></pre></td></tr></table></figure></p><p>这里面的启动名字是mongodb<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start mongodb</span><br></pre></td></tr></table></figure></p><p>我看有些人的教程直接是<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.\mongod --dbpath=<span class="string">"E:\MongoDB\data"</span></span><br><span class="line">net start MongoDB</span><br></pre></td></tr></table></figure></p><p>但是我不可以这样写,会报错，这里的MongoDB，是默认名字吗？有待证实</p><p>搞明白了，MongoDB是默认名字，net start 也是windows独有的</p><p>关闭服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br><span class="line">use admin</span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure></p><p>发送post请求<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">"name=haimeimei&amp;age=27"</span> http://localhost:3000/users/addPerson</span><br></pre></td></tr></table></figure></p><ul><li>-d post请求</li></ul><p>读数据<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> Person.findOne(&#123;</span><br><span class="line">    name: ctx.request.body.name</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></p><p>写数据要创建实例<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Person(&#123;</span><br><span class="line">  name: ctx.request.body.name,</span><br><span class="line">  age: ctx.request.body.age</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>更新数据<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> Person.where(&#123;</span><br><span class="line">  name: ctx.request.body.name</span><br><span class="line">  &#125;).update(&#123;</span><br><span class="line">    age: ctx.request.bdoy.age</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></p><p>删除数据<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> Person.where(&#123;</span><br><span class="line">  name: ctx.request.body.name</span><br><span class="line">  &#125;).remove()</span><br></pre></td></tr></table></figure></p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p><a href="http://www.runoob.com/redis/redis-install.html" target="_blank" rel="noopener">安装教程</a><br>服务端用session来保持用户状态，浏览器用cookie保存session，服务器把session种植到cookie中然后下次访问的时候cookie就会带着session过来，进而达到身份认证的过程</p><p>安装中间件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i koa-generic-session koa-redis</span><br></pre></td></tr></table></figure></p><p>操作Redis方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line"></span><br><span class="line">keys *</span><br><span class="line">get key</span><br></pre></td></tr></table></figure></p><p>Redis可以直接存储数据，不用配合session也行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Redis = <span class="built_in">require</span>(<span class="string">'koa-redis'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Store = <span class="keyword">new</span> Redis().client</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/fix'</span>,<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> st = <span class="keyword">await</span> Store.hset(<span class="string">'fix'</span>, <span class="string">'name'</span>, <span class="built_in">Math</span>.random())</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    code: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>Redis 查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br><span class="line">hget fix name</span><br></pre></td></tr></table></figure></p><h2 id="Nuxt-js-是做vue-ssr的一个框架"><a href="#Nuxt-js-是做vue-ssr的一个框架" class="headerlink" title="Nuxt.js 是做vue ssr的一个框架"></a>Nuxt.js 是做vue ssr的一个框架</h2><ol><li>是基于vue2这个框架做的</li><li>包含了vue Router<ul><li>vue本身不带路由，是通过插件的方式支持，Nuxt.js整合了这些</li><li>Nuxt.js将Router的配置设置的很简单，甚至你可以不配置就可以用</li></ul></li><li>可以支持vuex<ul><li>vuex是一个跨组件的管理工具</li></ul></li><li>支持Vue Server Renderer<ul><li>ssr,整合</li></ul></li><li>支持vue-meta<ul><li>html meta管理</li></ul></li></ol><p>Nuxt生命周期</p><ol><li>Incoming Request l浏览器发出请求</li><li>检查有没有 nuxtServerInit 如果有的话就执行这个函数store action</li><li>middleware 中间件是跟路由相关，可以实现你想要的功能，都可以在这里完成</li><li>validate() 配合高级动态路由去做一些验证，比如说是不是允许跳到这个页面来，如果没有得到我的校验，就跳走之类的，</li><li>asyncData() &amp; fetch() 获取数据<ul><li>asyncData() 是用来获取渲染vue组件的</li><li>fetch() 通常是用来修改vuex的</li></ul></li><li>Render 最后一步就是渲染</li></ol><p>Navigate <nuxt-link> 如果要是有这个的话，会发起一个非(色沃)的路由他会重新循环3-6的内容，<br>如果<nuxt-link>发起的是一个新的路由，这个时候就从第一部开始循环1-6</nuxt-link></nuxt-link></p><p>Nuxt.js安装<br><a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener">Nuxt.js安装</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init nuxt-community/koa-template .</span><br></pre></td></tr></table></figure></p><p>今天研究了半天的bug，这玩意安装不成功呀<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery@latest 更新到最新版本</span><br></pre></td></tr></table></figure></p><p>Nuxt.js官方安装，以前不支持koa，现在官方就可以自己支持<br><a href="https://zh.nuxtjs.org" target="_blank" rel="noopener">Nuxt官网</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-nuxt-app</span><br></pre></td></tr></table></figure><p>安装的时候会有选项，可以选koa，不过这个koa是不支持import写法</p><h4 id="创建即配置，异步获取"><a href="#创建即配置，异步获取" class="headerlink" title="创建即配置，异步获取"></a>创建即配置，异步获取</h4><p>创建及配置<br>vue里面是用mounted()方法发出ajax请求，但是这个不会在服务器端执行，只在浏览器端执行，<br>而asyncData()可以在服务端渲染，这样得到的数据更利于seo</p><p>Nuxtjs里面使用模板是要用到layout<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  layout: &apos;search&apos;,</span><br><span class="line">  data () &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>SSR的作用，就是页面闪动的时候，ssr就可以做到</strong></p><h2 id="环境准备与项目安装-6-2-6-1略过"><a href="#环境准备与项目安装-6-2-6-1略过" class="headerlink" title="环境准备与项目安装 6-2   6-1略过"></a>环境准备与项目安装 6-2   6-1略过</h2><p>用babel编译文件，这样就可以用import写法了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package.json 的dev后面增加babel编译</span><br><span class="line">--<span class="built_in">exec</span> babel-node</span><br><span class="line"></span><br><span class="line">.babelrc 增加babel配置文件</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"es2015"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">npm install babel-preset-es2015</span><br></pre></td></tr></table></figure></p><p>支持sass编译<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i sass-loader node-sass --save-dev</span><br></pre></td></tr></table></figure></p><p>我也是醉了，安装sass后，<code>lang=&quot;scss&quot;</code> 写成这样的，差点被坑了</p><p>nuxt.config.js<br>build,添加这个，增加缓存，不知道什么鬼<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache: ture</span><br></pre></td></tr></table></figure></p><p>这个东西在我的代码里，会导致element-ui 字体文件请求不到，会报错<br>暂时只能将这个代码去除了</p><h2 id="首页开发"><a href="#首页开发" class="headerlink" title="首页开发"></a>首页开发</h2><p>真正做业务的时候要先想再做需求分析：</p><p>模板设计   复用</p><p>组件设计   如何拆分组件</p><p>数据结构设计  </p><p>接口设计</p><p>今天遇到了一个bug，就是@import引入css文件报错，最后就是我也不知道为什么引入header.scss这个文件就会报错，测试了一下午，原因就是写新代码没有创建新分支，所以导致了这种问题，不然直接切换分支，好像也不行，好像又可以，以后先要创建分支再写代码了，bug所在位置，components/public/header/topBar.vue: @import “@/assets/css/public/header.sass”;<br>我再去测试一下是文件内容错误还是命名错误还是误认为是文件夹了，因为里面有个header文件夹</p><p>mdzz，后缀也是scss，而且header.scss内容也有问题，我TM也是醉了，搞我呢，一下午白忙</p><h2 id="开发搜索模块"><a href="#开发搜索模块" class="headerlink" title="开发搜索模块"></a>开发搜索模块</h2><p>搜索这个模块，原理特简单<br>判断是否获取焦点，是否有内容即可完成搜索框<br>return 是否焦点 &amp;&amp; 是否有内容 //常规搜索<br>return 是否焦点 &amp;&amp; !是否有内容  //热门搜索<br>还有要注意的是，没有焦点后搜索框就会瞬间消失，a链接就点不上了，所以要给个延迟<br>数据：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    isFocus: <span class="literal">false</span>,</span><br><span class="line">    search: <span class="string">''</span>,</span><br><span class="line">    hotPlace: [<span class="string">'热门搜索'</span>, <span class="string">'nice'</span>],</span><br><span class="line">    searchDate: [<span class="string">'哈哈2哈哈1'</span>, <span class="string">'也没2有那么1'</span>, <span class="string">'搜索2吗1'</span>, <span class="string">'北京1烤鸭'</span>, <span class="string">'偶是1'</span>],</span><br><span class="line">    searchList: [],</span><br><span class="line">    show: <span class="literal">true</span>,</span><br><span class="line">    number: <span class="number">0</span>,</span><br><span class="line">    what: <span class="literal">false</span>,</span><br><span class="line">    hidone: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>搜索框热门搜索出现逻辑代码:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  isHotPlace () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.isFocus &amp;&amp; !<span class="keyword">this</span>.search</span><br><span class="line">  &#125;,</span><br><span class="line">  isSearchList () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.isFocus &amp;&amp; <span class="keyword">this</span>.search</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  focus () &#123;</span><br><span class="line">    <span class="keyword">this</span>.isFocus = <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  blur () &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.isFocus = <span class="literal">false</span></span><br><span class="line">    &#125;,<span class="number">200</span>)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><p>搜索框代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  search () &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.search) &#123;</span><br><span class="line">      <span class="keyword">this</span>.searchList = []</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.what) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> result = []</span><br><span class="line">    <span class="keyword">this</span>.searchDate.forEach(<span class="function">(<span class="params">value, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value.indexOf(<span class="keyword">this</span>.search) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">        result.push(value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">/*和这层代码没关系*/</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.searchList.length; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs[i][<span class="number">0</span>].className = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.number = <span class="number">0</span></span><br><span class="line">    <span class="comment">/*-------------*/</span></span><br><span class="line">    <span class="keyword">this</span>.searchList = result</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>搜索框的down 和 up事件操控逻辑<br>写了很多冗余代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">numberSerace () &#123;</span><br><span class="line">    <span class="comment">// 点击键盘down执行事件，写的很乱，不过功能还可以</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.search) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">this</span>.what = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>.hidone = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.number &gt;= <span class="keyword">this</span>.searchList.length) &#123;</span><br><span class="line">      <span class="keyword">this</span>.number = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.searchList.length; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs[i][<span class="number">0</span>].className = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.$refs[<span class="keyword">this</span>.number][<span class="number">0</span>].className = <span class="string">"msg"</span></span><br><span class="line">    <span class="keyword">this</span>.search = <span class="keyword">this</span>.searchList[<span class="keyword">this</span>.number]</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.what = <span class="literal">false</span></span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.number++</span><br><span class="line">  &#125;,</span><br><span class="line">  upSerace () &#123;</span><br><span class="line">    <span class="comment">//点击键盘up执行事件</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.search) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.what = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.hidone) &#123;</span><br><span class="line">      <span class="keyword">this</span>.number--</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.hidone = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.number--</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.number &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.number = <span class="keyword">this</span>.searchList.length<span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.searchList.length; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs[i][<span class="number">0</span>].className = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.$refs[<span class="keyword">this</span>.number][<span class="number">0</span>].className = <span class="string">"msg"</span></span><br><span class="line">    <span class="keyword">this</span>.search = <span class="keyword">this</span>.searchList[<span class="keyword">this</span>.number]</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.what = <span class="literal">false</span></span><br><span class="line">    &#125;, <span class="number">200</span>)</span><br></pre></td></tr></table></figure></p><p>搜索框全代码地址：<br><a href="https://github.com/DemoorBug/vuesenior/blob/master/components/public/header/searchBar.vue" target="_blank" rel="noopener">github地址</a></p><h2 id="7-8左侧边栏实现原理"><a href="#7-8左侧边栏实现原理" class="headerlink" title="7-8左侧边栏实现原理"></a>7-8左侧边栏实现原理</h2><p>首先是结构布局<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>全部分类<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>图标标签i<span class="tag">&lt;/<span class="name">i</span>&gt;</span>美食<span class="tag">&lt;<span class="name">span</span>&gt;</span>&gt;箭头标签<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span> 这个div就是用来存放弹出内容的，是实时渲染，就是获得数据然后渲染，方便到爆</span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span>&gt;</span> 这个标签控制循环，不然外面就要套一层，冗余</span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>方法部分的实现原理分析：</p><ul><li>this.menu.filter((item) =&gt; item.type==this.kind)[0].child<ul><li>比对this.kind来获取想应数据，filter是什么？</li></ul></li><li>this.kind = e.target.querySelector(‘i’).className<ul><li>获取当前鼠标对应的元素，赋值给this.kind<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  this._timer = setTimeout(() =&gt; &#123;</span><br><span class="line">    this.kind= ''</span><br><span class="line">  &#125;, 150)</span><br><span class="line">这块代码延迟，可以在鼠标进入右侧边栏的时候有个反应时间，来让右侧响应标签取消这个定时器，从而达到可以防止鼠标到弹出框，弹出框就消失的问题</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>本节源码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"m-menu"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"nav"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">mouseleave</span>=<span class="string">"mouseleave"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dt</span>&gt;</span>全部分类<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"(item, index) of menu"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">mouseenter</span>=<span class="string">"enter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">"item.type"</span>/&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"arrow"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-if</span>=<span class="string">"kind"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"detail"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">mouseleave</span>=<span class="string">"Eenter"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">mouseenter</span>=<span class="string">"Emousele"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">"(item, index) of curdetail"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">"v of item.child"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">"v"</span>&gt;</span>&#123;&#123; v &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      kind: <span class="string">''</span>,</span></span><br><span class="line"><span class="undefined">      menu: [&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'food'</span>,</span></span><br><span class="line"><span class="javascript">        name: <span class="string">'美食'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'美食'</span>,</span></span><br><span class="line"><span class="javascript">          child: [<span class="string">'代金券'</span>,<span class="string">'饮品'</span>,<span class="string">'火锅'</span>,<span class="string">'自助餐'</span>]</span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'takeout'</span>,</span></span><br><span class="line"><span class="javascript">        name: <span class="string">'外卖'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'外卖'</span>,</span></span><br><span class="line"><span class="javascript">          child: [<span class="string">'美团'</span>,<span class="string">'饿了么'</span>,<span class="string">'百度外卖'</span>,<span class="string">'自助餐'</span>]</span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;]</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  computed: &#123;</span></span><br><span class="line"><span class="undefined">    curdetail () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">this</span>.menu.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item.type==<span class="keyword">this</span>.kind)[<span class="number">0</span>].child</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    mouseleave () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>._timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.kind= <span class="string">''</span></span></span><br><span class="line"><span class="undefined">      &#125;, 150)</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    enter (e) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e.target)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.kind = e.target.querySelector(<span class="string">'i'</span>).className</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    Emousele () &#123;</span></span><br><span class="line"><span class="javascript">      clearTimeout(<span class="keyword">this</span>._timer)</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    Eenter () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.kind = <span class="string">''</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>自己写的另一个列表源码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"m-istyle"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span> @<span class="attr">mouseover</span>=<span class="string">"moue"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dt</span>&gt;</span>有格调<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"&#123;active:kind==='all'&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">kind</span>=<span class="string">"all"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">keyword</span>=<span class="string">"景点"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"&#123;active:kind==='part'&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">kind</span>=<span class="string">"part"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">keyword</span>=<span class="string">"美食"</span>&gt;</span>约会聚餐<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"&#123;active:kind==='spa'&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">kind</span>=<span class="string">"spa"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">keyword</span>=<span class="string">"丽人"</span>&gt;</span>丽人SPA<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"&#123;active:kind==='movie'&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">kind</span>=<span class="string">"movie"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">keyword</span>=<span class="string">"电影"</span>&gt;</span>电影演出<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"&#123;active:kind==='travel'&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">kind</span>=<span class="string">"travel"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">keyword</span>=<span class="string">"旅游"</span>&gt;</span>品质出游<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"ibody"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"(item, index) of curdetail"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"height: auto"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">"item.img"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"cbody"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"pos"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-for</span>=<span class="string">"(item, index) of item.pos"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"price"</span>&gt;</span>￥<span class="tag">&lt;<span class="name">em</span>&gt;</span>&#123;&#123; item.price &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/起<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      kind: <span class="string">'all'</span>,</span></span><br><span class="line"><span class="undefined">      artistic: [&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'all'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'木北造型（崇文门新世界店）'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p1.meituan.net/wedding/8d26f93de654d433b17774e60a1fc5bd1028431.jpg@240w_180h_1e_1c_1l|watermark=1&amp;&amp;r=2&amp;p=9&amp;x=2&amp;y=2&amp;relative=1&amp;o=20|368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'亲子场景酒店'</span>,<span class="string">'发票推荐'</span>,<span class="string">'亲子酒店点评'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'685'</span></span></span><br><span class="line"><span class="undefined">        &#125;, &#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'北京新侨诺富特饭店'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p1.meituan.net/dnaimgdark/42487acaeaa40e3a97b41443f75566142443096.jpg@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'亲子场景酒店'</span>,<span class="string">'亲子酒店'</span>,<span class="string">'房量充足'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'536'</span></span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'part'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'分米鸡 DM Chicken（合景·摩方店）'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p1.meituan.net/msmerchant/a361a5683dcfc8db85d61f15639f9bfd61437.jpg@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'分米鸡10DM套餐1份，有赠品'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'308'</span></span></span><br><span class="line"><span class="undefined">        &#125;, &#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'COSTA COFFEE（东方新天地店）'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p0.meituan.net/merchantpic/b5bc200ff96056aa58e2441c37b0097d58192.jpg@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'巧克力酥卷小美式，建议单人使用'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'18'</span></span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'spa'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'魅贝克美发沙龙（崇文门新世界店）'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p0.meituan.net/wedding/15570fc8c02870c37c21d4d250489cf9212844.jpg@240w_180h_1e_1c_1l|watermark=1&amp;&amp;r=2&amp;p=9&amp;x=2&amp;y=2&amp;relative=1&amp;o=20|368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'魅贝克美发沙龙（崇文门新世界店）'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'282'</span></span></span><br><span class="line"><span class="undefined">        &#125;, &#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'TONI&amp;GUY（东方广场店）'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p0.meituan.net/wedding/bdfdfa650660bc9c4b06c6a95f50492132697.jpg@240w_180h_1e_1c_1l|watermark=1&amp;&amp;r=2&amp;p=9&amp;x=2&amp;y=2&amp;relative=1&amp;o=20|368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'TONI&amp;GUY（东方广场店）'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'896'</span></span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'movie'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'金泉港IMAX国际影城'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p0.meituan.net/poi/c2b482474377fc31a8311f46055f40b0442616.png@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'免押金,可停车,有情侣座,儿童票,有WIFI,IMAX厅,杜比全景声厅,4DX厅'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'43'</span></span></span><br><span class="line"><span class="undefined">        &#125;, &#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'中影国际影城(丰台千禧街店)'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p1.meituan.net/deal/__29661209__6853522.jpg@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'免押金,可停车,有情侣座,儿童票,可刷卡,休息区,中国巨幕厅,60帧厅'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'19.9'</span></span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'travel'</span>,</span></span><br><span class="line"><span class="undefined">        child: [&#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'新鲜酒店'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p1.meituan.net/tdchotel/3a2020cce42f452cb089eb274b67d6d18153330.jpg@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'新客超值优惠'</span>,<span class="string">'酒店套餐'</span>,<span class="string">'亲子酒店'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'358'</span></span></span><br><span class="line"><span class="undefined">        &#125;, &#123;</span></span><br><span class="line"><span class="javascript">          title: <span class="string">'北京商旅智选北京INN公寓'</span>,</span></span><br><span class="line"><span class="javascript">          img: <span class="string">'//p1.meituan.net/tdchotel/7d2e528c129d1376224df99dac1d3b382809929.jpg@368w_208h_1e_1c'</span>,</span></span><br><span class="line"><span class="javascript">          pos: [<span class="string">'新客超值优惠'</span>,<span class="string">'酒店套餐'</span>,<span class="string">'亲子酒店'</span>],</span></span><br><span class="line"><span class="javascript">          price: <span class="string">'404'</span></span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">      &#125;]</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  computed: &#123;</span></span><br><span class="line"><span class="undefined">    curdetail () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">this</span>.artistic.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item.type==<span class="keyword">this</span>.kind)[<span class="number">0</span>].child</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    moue (e) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> dom = e.target</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> tag = dom.tagName.toLowerCase()</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (tag == <span class="string">'dd'</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.kind = dom.getAttribute(<span class="string">'kind'</span>)</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    @<span class="keyword">import</span> <span class="string">"@/assets/css/index/artistic.scss"</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="8-1注册"><a href="#8-1注册" class="headerlink" title="8-1注册"></a>8-1注册</h2><p>这章就是介绍接口的设计，很重要把，对于后台来说</p><table><thead><tr><th>user表</th><th>areas表</th><th>menu表</th><th>city表</th></tr></thead><tbody><tr><td>username</td><td></td><td></td><td></td></tr><tr><td>pasword</td><td></td><td></td><td></td></tr><tr><td>email</td><td></td><td></td></tr></tbody></table><p>接口<br>/users/signup<br>/users/signin<br>/users/verify<br>/users/exit<br>/users/getUser</p><p>这一章涵盖太多不知道的东西了，必须要搞明白，为什么这么写，实现的是什么功能，再开始继续，把每一个代码都记录下来，不管是百度还是什么</p><p>nodemailer  控制邮箱的一个应用<br>npm install nodemailer</p><p><a href="https://blog.csdn.net/qq_36801710/article/details/79528013" target="_blank" rel="noopener">axios教程</a><br>创建一个axios实例<br>axios.create({<br>  baseURL:<br>})</p><p>passport 权限认证中间件，本地用户登陆，第三方登陆<br><a href="https://segmentfault.com/a/1190000011557953" target="_blank" rel="noopener">passport教程</a></p><p>这个老师写了一大堆错误，简直逻辑不同，根本无法用，然后老师一笔带过，简直就是误人子弟<br>我自己解决了所有遇到的问题<br>这节可以去看代码的编写，很简单<br>接口代码实现笔记：<br><a href="https://github.com/DemoorBug/vuesenior/tree/master/server/interface/users.js" target="_blank" rel="noopener">users.js本节项目地址</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">import Router from 'koa-router'                 //路由</span><br><span class="line">import Redis from 'koa-redis'                   //redis数据库，主要是提交验证码的时候写入验证码数据</span><br><span class="line">import nodeMailer from 'nodemailer'             //发邮件的app</span><br><span class="line">import User from '../dbs/models/users.js'       //mongoose</span><br><span class="line">import Passport from './utils/passport.js'      //自动登陆？</span><br><span class="line">import Email from '../dbs/config.js'            //配置文件</span><br><span class="line">import axios from './utils/axios.js'            //跨平台请求</span><br><span class="line"></span><br><span class="line">let router = new Router(&#123;                       //这个页面放到/users下</span><br><span class="line">  prefix: '/users'</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">let Store = new Redis().client</span><br><span class="line"></span><br><span class="line">router.post('/signup', async (ctx) =&gt; &#123;  //注册</span><br><span class="line">  const &#123;</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">    email,</span><br><span class="line">    code</span><br><span class="line">  &#125; = ctx.request.body    //解构赋值</span><br><span class="line"></span><br><span class="line">  if (code) &#123;    //判断是否输入code</span><br><span class="line">    const saveCode = await Store.hget(`nodeMailer:$&#123;username&#125;`,'code')</span><br><span class="line">    const saveExpire = await Store.hget(`nodeMailer:$&#123;username&#125;`,'expire')</span><br><span class="line">    if (code === saveCode) &#123; //判断是否和redis数据库的code生成的验证码一致</span><br><span class="line">      if (new Date().getTime-saveExpire&gt;0) &#123; //判断是否和redis数据库时间过期</span><br><span class="line">        ctx.body = &#123;</span><br><span class="line">          code: -1,</span><br><span class="line">          msg: '验证码过期，请重新尝试'</span><br><span class="line">        &#125;</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;   //saveCode 错误执行</span><br><span class="line">      ctx.body = &#123;</span><br><span class="line">        code: -1,</span><br><span class="line">        msg: '请填写正确的验证码 '</span><br><span class="line">      &#125;</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;  //不存在code</span><br><span class="line">    ctx.body= &#123;</span><br><span class="line">      code: -1,</span><br><span class="line">      msg: '请填写验证码'</span><br><span class="line">    &#125;</span><br><span class="line">    return false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let user = await User.find(&#123;  //查询mongodb数据库</span><br><span class="line">    username</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  if (user.length) &#123;  //如果有用户，提示报错</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      code: -1,</span><br><span class="line">      msg: '已被注册'</span><br><span class="line">    &#125;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let nuser = await User.create(&#123;   //写入mongodb数据库，这里是创建一个实例</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">    email</span><br><span class="line">  &#125;)</span><br><span class="line">  if (nuser) &#123;  //写入成功执行</span><br><span class="line">    let res = await axios.post('/users/signin', &#123;username, password&#125;)</span><br><span class="line">    //自动登陆？大概吧</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 0) &#123; </span><br><span class="line">      ctx.body = &#123;</span><br><span class="line">        code: 0,</span><br><span class="line">        msg: '注册成功',</span><br><span class="line">        user: res.data.user</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ctx.body = &#123;</span><br><span class="line">        code: -1,</span><br><span class="line">        msg: 'error'</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      code: -1,</span><br><span class="line">      msg: '注册失败'</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post('/signin', async (ctx, next) =&gt; &#123;  //自动登陆？</span><br><span class="line">  return Passport.authenticate('local', function(err, user, info, status) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">      ctx.body = &#123;</span><br><span class="line">        code: -1,</span><br><span class="line">        msg: err</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if (user) &#123;</span><br><span class="line">        ctx.body = &#123;</span><br><span class="line">          code: 0,</span><br><span class="line">          msg: '登录成功',</span><br><span class="line">          user</span><br><span class="line">        &#125;</span><br><span class="line">        return ctx.login(user)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ctx.body = &#123;</span><br><span class="line">          code: 1,</span><br><span class="line">          msg: info</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(ctx, next)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post('/verify', async (ctx, next) =&gt; &#123; //验证码接口</span><br><span class="line">  let username = ctx.request.body.username   //用户名</span><br><span class="line">  const saveExpire = await Store.hget(`nodeMailer:$&#123;username&#125;`,'expire')</span><br><span class="line">  if (saveExpire &amp;&amp; new Date().getTime-saveExpire<span class="tag">&lt;<span class="name">0)</span> &#123;</span></span><br><span class="line"><span class="tag">    <span class="attr">ctx.body</span> = <span class="string">&#123;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">code:</span> <span class="attr">-1</span>,</span></span><br><span class="line"><span class="tag">      <span class="attr">msg:</span> '验证请求过于频繁，<span class="attr">1</span>分钟一次'</span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag">    <span class="attr">return</span> <span class="attr">false</span></span></span><br><span class="line"><span class="tag">  &#125;</span></span><br><span class="line"><span class="tag">  <span class="attr">let</span> <span class="attr">transporter</span> = <span class="string">nodeMailer.createTransport(&#123;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">host:</span> <span class="attr">Email.smtp.host</span>,</span></span><br><span class="line"><span class="tag">    <span class="attr">port:</span> <span class="attr">587</span>,</span></span><br><span class="line"><span class="tag">    <span class="attr">secure:</span> <span class="attr">false</span>,</span></span><br><span class="line"><span class="tag">    <span class="attr">auth:</span> &#123;</span></span><br><span class="line"><span class="tag">      <span class="attr">user:</span> <span class="attr">Email.smtp.user</span>,</span></span><br><span class="line"><span class="tag">      <span class="attr">pass:</span> <span class="attr">Email.smtp.pass</span></span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag">  &#125;)</span></span><br><span class="line"><span class="tag">  <span class="attr">let</span> <span class="attr">ko</span> = <span class="string">&#123;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">code:</span> <span class="attr">Email.smtp.code</span>(),</span></span><br><span class="line"><span class="tag">    <span class="attr">expire:</span> <span class="attr">Email.smtp.expire</span>(),</span></span><br><span class="line"><span class="tag">    <span class="attr">email:</span> <span class="attr">ctx.request.body.email</span>,</span></span><br><span class="line"><span class="tag">    <span class="attr">user:</span> <span class="attr">ctx.request.body.username</span></span></span><br><span class="line"><span class="tag">  &#125;</span></span><br><span class="line"><span class="tag">  <span class="attr">let</span> <span class="attr">mailOptions</span> = <span class="string">&#123;</span></span></span><br><span class="line">    from: `"您的邮件"&lt;$&#123;Email.smtp.user&#125;&gt;`,</span><br><span class="line">    to: ko.email,</span><br><span class="line">    subject: '《demoorbug》注册码',</span><br><span class="line">    html: `您的验证码是$&#123;ko.code&#125;`</span><br><span class="line">  &#125;</span><br><span class="line">  await transporter.sendMail(mailOptions, (error, info) =&gt; &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">      return console.log('error')</span><br><span class="line">    &#125; else &#123; //写入redis数据库</span><br><span class="line">      Store.hmset(`nodeMailer:$&#123;ko.user&#125;`, 'code', ko.code, 'expire', ko.expire, 'email', ko.email)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    code: 0,</span><br><span class="line">    msg: '验证码已发送，可能会有延迟，有效期1分钟'</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get('/exit', async (ctx, next) =&gt; &#123;</span><br><span class="line">  await ctx.logout()</span><br><span class="line">  if (!ctx.isAuthenticated()) &#123;</span><br><span class="line">    code: 0</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    ctx: -1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get('/getUser', async (ctx) =&gt; &#123;</span><br><span class="line">  if(ctx.isAuthenticated()) &#123;</span><br><span class="line">    const &#123;username, email&#125; = ctx.session.passport.user</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      user: username,</span><br><span class="line">      email</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      user: '',</span><br><span class="line">      email: ''</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default router</span><br></pre></td></tr></table></figure></p><p>目前就学习到/verify接口，前面的接口bug都已经解决，这段还没有解决，因为我感觉是有问题的代码，后面可以深入一下这个地方，多注意下，有问题就回来解决:</p><p>register.vue 的验证码函数和提交函数的编写<br><a href="https://github.com/DemoorBug/vuesenior/tree/master/pages/register.vue" target="_blank" rel="noopener">register.vue文件地址</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;  //验证码函数</span><br><span class="line">  sendMsg () &#123;  </span><br><span class="line">    let namePass  </span><br><span class="line">    let emailPass</span><br><span class="line">    if(this.timerid) &#123;</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">    this.$refs['ruleForm'].validateField('name', (valid) =&gt; &#123; //validateField这是饿了么组件自带的方法，应该是。查询name是否有值，没有值，则valid返回提示的值，比如name不输入提示"请输入昵称"</span><br><span class="line">      namePass = valid</span><br><span class="line">    &#125;)</span><br><span class="line">    this.statusMsg = '' //验证码的双向绑定数据</span><br><span class="line">    if(namePass) &#123;  //</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">    this.$refs['ruleForm'].validateField('email', (valid) =&gt; &#123; //和上面同理</span><br><span class="line">      emailPass = valid</span><br><span class="line">    &#125;)  </span><br><span class="line">    if (!namePass &amp;&amp; !emailPass) &#123; //如果都填写了，则不会赋值就为空所以是false,要取反</span><br><span class="line">      this.$axios.post('/users/verify', &#123; //可以直接用$axios是因为nuxtjs内置了</span><br><span class="line">        username: encodeURIComponent(this.ruleForm.name),  用户名转换为字符串</span><br><span class="line">        email: this.ruleForm.email </span><br><span class="line">      &#125;).then((&#123;status, data&#125;) =&gt; &#123;  //回调函数，解构赋值</span><br><span class="line">        if (status === 200 &amp;&amp; data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">          let count = 60;   </span><br><span class="line">          console.log('1')</span><br><span class="line">          this.statusMsg = `验证码已发送,剩余$&#123;count--&#125;秒`</span><br><span class="line">          this.timerid = setInterval(() =&gt; &#123;  //定时器刷新</span><br><span class="line">            this.statusMsg = `验证码已发送,剩余$&#123;count--&#125;秒`</span><br><span class="line">            if (count === 0) &#123;</span><br><span class="line">              this.statusMsg = ''</span><br><span class="line">              clearInterval(this.timerid)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, 1000)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.statusMsg = data.msg</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  register () &#123;</span><br><span class="line">    this.$refs['ruleForm'].validate((valid) =&gt; &#123;  //饿了么组件自带的方法,全部验证通过valid = true</span><br><span class="line">      if (valid) &#123;</span><br><span class="line">        this.$axios.post('/users/signup', &#123;</span><br><span class="line">          username: window.encodeURIComponent(this.ruleForm.name),</span><br><span class="line">          password: CryptoJs.MD5(this.ruleForm.pwd).toString(),</span><br><span class="line">          email: this.ruleForm.email,</span><br><span class="line">          code: this.ruleForm.code</span><br><span class="line">        &#125;).then((&#123;status, data&#125;) =&gt; &#123;</span><br><span class="line">          if (status ===200) &#123;</span><br><span class="line">            if (data &amp;&amp; data.code ===0) &#123;</span><br><span class="line">              // this.error = data.msg</span><br><span class="line">              location.href = '/login'</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">            this.error = data.msg</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.error = `服务器出错，错误码: $&#123;status&#125;`</span><br><span class="line">          &#125;</span><br><span class="line">          setTimeout(() =&gt; &#123;</span><br><span class="line">            this.error = ''</span><br><span class="line">          &#125;, 1500)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>index 的一些修改备注<br><a href="https://github.com/DemoorBug/vuesenior/blob/master/server/index.js" target="_blank" rel="noopener">index.js地址</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import mongoose from 'mongoose'              //mongoose</span><br><span class="line">import bodyParser from 'koa-bodyparser'      //unkown</span><br><span class="line">import session from 'koa-generic-session'    //session</span><br><span class="line">import Redis from 'koa-redis'                //redis</span><br><span class="line">import json from 'koa-json'                  //格式化json</span><br><span class="line">import dbConfig from './dbs/config'</span><br><span class="line">import passport from './interface/utils/passport.js'  </span><br><span class="line">import users from './interface/users'</span><br><span class="line"></span><br><span class="line">app.keys= ['debug', 'keyskeys']    //unkown</span><br><span class="line">app.proxy = true                   //unkown</span><br><span class="line">app.use(session(&#123;                  //session</span><br><span class="line">  key: 'debug',</span><br><span class="line">  prefix: 'debug:uid',</span><br><span class="line">  store: new Redis()</span><br><span class="line">&#125;))</span><br><span class="line">app.use(bodyParser(&#123;                </span><br><span class="line">  extendTypes: ['json', 'form', 'text']</span><br><span class="line">&#125;))</span><br><span class="line">app.use(json())             //格式化diamagnetic</span><br><span class="line"></span><br><span class="line">mongoose.connect(dbConfig.dbs, &#123;    //mongodb地址？应该是</span><br><span class="line">  useNewUrlParser: true</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(passport.initialize())       //unkown</span><br><span class="line">app.use(passport.session())          //unkown</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(users.routes()).use(users.allowedMethods())  //将我们写好的路由引入</span><br></pre></td></tr></table></figure><h2 id="接口设计-需求分析"><a href="#接口设计-需求分析" class="headerlink" title="接口设计(需求分析)"></a>接口设计(需求分析)</h2><p>/geo/getPosition<br>/geo/province<br>/geo/province/:id<br>/geo/city<br>/geo/hotCity     /geo/menu</p><p>查询接口<br>/search/top<br>/search/resultsByKeywords<br>/search/hotPlace<br>/search/products<br>/search/product/:id</p><p><code>mongoimport -d dbs -c test pois.dat</code><br>dbs对应database<br>test对应Collections<br>pois.dat 对应数据源</p><p>签名：没有签名获取不到数据<br><a href="http://cp-tools.cn/sign" target="_blank" rel="noopener">http://cp-tools.cn/sign</a><br>c6a3d36c8d43371e21550e1420f0d19e<br><a href="https://www.imooc.com/u/3164558/bbs" target="_blank" rel="noopener">https://www.imooc.com/u/3164558/bbs</a><br>从这个人获取到了UID。。</p><p>怎么说呢，还行吧，不过是用wsl(windows的子系统ubuntu)提交会出问题，有些东西提交了两遍</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> geo <span class="keyword">from</span> <span class="string">'./modules/geo'</span></span><br><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">'./modules/home'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    geo,</span><br><span class="line">    home</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> nuxtServerInit(&#123;commit&#125;, &#123;req, app&#125;) &#123;</span><br><span class="line">      <span class="comment">//nuxtServerInit这个是nuxtjs提供的生命周期钩子</span></span><br><span class="line">      <span class="keyword">const</span> &#123;status, <span class="attr">data</span>: &#123;province, city&#125;&#125; = <span class="keyword">await</span> app.$axios.get(<span class="string">'/geo/getPosition'</span>)</span><br><span class="line">      commit(<span class="string">'geo/setPosition'</span>, status ===<span class="number">200</span> ? &#123;city, province&#125;: &#123;<span class="attr">city</span>: <span class="string">''</span>, <span class="attr">province</span>: <span class="string">''</span>&#125;)</span><br><span class="line">      <span class="keyword">const</span> &#123;<span class="attr">status</span>: status2, <span class="attr">data</span>: &#123;menu&#125;&#125; = <span class="keyword">await</span> app.$axios.get(<span class="string">'/geo/menu'</span>)</span><br><span class="line">      commit(<span class="string">'home/setMenu'</span>, status2 === <span class="number">200</span> ? menu : [])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>放弃，只是带我抄了一遍代码，基本没什么学的，垃圾</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;vue全家桶-SSR-Koa2全栈开发美团网&quot;&gt;&lt;a href=&quot;#vue全家桶-SSR-Koa2全栈开发美团网&quot; class=&quot;headerlink&quot; title=&quot;vue全家桶+SSR+Koa2全栈开发美团网&quot;&gt;&lt;/a&gt;vue全家桶+SSR+Koa2全栈开发美
      
    
    </summary>
    
      <category term="vue" scheme="demoorbug.github.io/categories/vue/"/>
    
    
      <category term="vue" scheme="demoorbug.github.io/tags/vue/"/>
    
      <category term="SSR" scheme="demoorbug.github.io/tags/SSR/"/>
    
      <category term="Koa2" scheme="demoorbug.github.io/tags/Koa2/"/>
    
  </entry>
  
</feed>
